<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GVC Badge Lookup</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #12121a;
            --bg-hover: #1a1a25;
            --border: #2a2a3a;
            --text-primary: #ffffff;
            --text-secondary: #888899;
            --accent-cyan: #00d4ff;
            --accent-green: #00ff88;
            --accent-pink: #ff44aa;
            --accent-purple: #a855f7;
            --accent-orange: #ff9500;
            --accent-gold: #ffd700;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1025 50%, #0f1020 100%);
            color: var(--text-primary);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Floating NFT decorations - dynamic */
        .floating-nfts-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 0;
        }
        
        .floating-nft {
            position: absolute;
            width: 90px;
            height: 90px;
            border-radius: 12px;
            opacity: 0.5;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            animation: float 6s ease-in-out infinite;
        }
        
        .floating-nft:nth-child(odd) { animation-delay: -3s; }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(var(--rotate, 0deg)); }
            50% { transform: translateY(-10px) rotate(var(--rotate, 0deg)); }
        }
        
        .floating-nft img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }
        
        /* Left side positions (up to 8) */
        .floating-nft.left-0 { top: 3%; left: 1%; --rotate: -8deg; }
        .floating-nft.left-1 { top: 14%; left: 2.5%; --rotate: 5deg; }
        .floating-nft.left-2 { top: 25%; left: 1.5%; --rotate: -3deg; }
        .floating-nft.left-3 { top: 36%; left: 3%; --rotate: 7deg; }
        .floating-nft.left-4 { top: 47%; left: 1%; --rotate: -6deg; }
        .floating-nft.left-5 { top: 58%; left: 2.5%; --rotate: 4deg; }
        .floating-nft.left-6 { top: 69%; left: 1.5%; --rotate: -5deg; }
        .floating-nft.left-7 { top: 80%; left: 3%; --rotate: 3deg; }
        
        /* Right side positions (up to 8) */
        .floating-nft.right-0 { top: 3%; right: 1%; --rotate: 8deg; }
        .floating-nft.right-1 { top: 14%; right: 2.5%; --rotate: -5deg; }
        .floating-nft.right-2 { top: 25%; right: 1.5%; --rotate: 3deg; }
        .floating-nft.right-3 { top: 36%; right: 3%; --rotate: -7deg; }
        .floating-nft.right-4 { top: 47%; right: 1%; --rotate: 6deg; }
        .floating-nft.right-5 { top: 58%; right: 2.5%; --rotate: -4deg; }
        .floating-nft.right-6 { top: 69%; right: 1.5%; --rotate: 5deg; }
        .floating-nft.right-7 { top: 80%; right: 3%; --rotate: -3deg; }
        
        @media (max-width: 1400px) {
            .floating-nfts-container { display: none; }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
            position: relative;
            z-index: 1;
        }
        
        /* Header */
        .header {
            text-align: center;
            padding: 48px 0;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
        
        /* Search Section */
        .search-section {
            max-width: 600px;
            margin: 0 auto 48px;
        }
        
        .search-box {
            display: flex;
            gap: 12px;
        }
        
        .search-box input {
            flex: 1;
            padding: 16px 20px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 16px;
            font-family: 'JetBrains Mono', monospace;
            transition: border-color 0.2s;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: var(--accent-cyan);
        }
        
        .search-box input::placeholder {
            color: var(--text-secondary);
            font-family: 'Inter', sans-serif;
        }
        
        .search-box button {
            padding: 16px 32px;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            border: none;
            border-radius: 12px;
            color: #000;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .search-box button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 212, 255, 0.3);
        }
        
        .search-hint {
            text-align: center;
            margin-top: 12px;
            color: var(--text-secondary);
            font-size: 13px;
        }
        
        /* Results Section */
        .results {
            display: none;
        }
        
        .results.active {
            display: block;
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: transform 0.2s, border-color 0.2s;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 160px;
        }
        
        .stat-card.clickable {
            cursor: pointer;
        }
        
        .stat-card.clickable:hover {
            transform: translateY(-2px);
            border-color: var(--accent-cyan);
        }
        
        .stat-card .value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            line-height: 1;
        }
        
        .stat-card .label {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .stat-card.cyan .value { color: var(--accent-cyan); }
        .stat-card.green .value { color: var(--accent-green); }
        .stat-card.pink .value { color: var(--accent-pink); }
        .stat-card.gold .value { color: var(--accent-gold); }
        
        /* Rarest badge card with image */
        .stat-card.rarest {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px;
            min-height: 160px;
        }
        
        .rarest-nft-img {
            width: 80px;
            height: 80px;
            border-radius: 10px;
            object-fit: cover;
            border: 3px solid var(--accent-gold);
            box-shadow: 0 4px 16px rgba(255, 215, 0, 0.4);
        }
        
        .rarest-badge-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--accent-gold);
            text-align: center;
            line-height: 1.2;
        }
        
        .stat-card.rarest .label {
            font-size: 12px;
            margin-bottom: 2px;
        }
        
        /* Completion Bar */
        .completion-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 32px;
        }
        
        .completion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .completion-header h3 {
            font-size: 16px;
            font-weight: 600;
        }
        
        .completion-header span {
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent-cyan);
        }
        
        .progress-bar {
            height: 12px;
            background: var(--bg-dark);
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-purple));
            border-radius: 6px;
            transition: width 0.5s ease;
        }
        
        /* Badge Tabs */
        .tabs-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .tabs {
            display: flex;
            gap: 8px;
        }
        
        /* Sort Controls */
        .sort-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .sort-label {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .sort-btn {
            padding: 6px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .sort-btn:hover {
            border-color: var(--accent-cyan);
            color: var(--text-primary);
        }
        
        .sort-btn.active {
            background: var(--accent-cyan);
            color: #000;
            border-color: var(--accent-cyan);
        }
        
        .sort-btn .arrow {
            margin-left: 4px;
            font-size: 10px;
        }
        
        /* Share Buttons */
        .share-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        
        .share-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .share-btn:hover {
            transform: translateY(-2px);
        }
        
        .share-btn.owned {
            background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
            color: #000;
        }
        
        .share-btn.hunting {
            background: linear-gradient(135deg, var(--accent-pink), var(--accent-purple));
            color: #fff;
        }
        
        .share-btn.compare {
            background: linear-gradient(135deg, var(--accent-gold), #ff8c00);
            color: #000;
        }
        
        .tab {
            padding: 12px 24px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .tab:hover {
            border-color: var(--accent-cyan);
            color: var(--text-primary);
        }
        
        .tab.active {
            background: var(--bg-hover);
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
        }
        
        .tab.missing {
            border-color: var(--accent-pink);
        }
        
        .tab.missing.active {
            color: var(--accent-pink);
            border-color: var(--accent-pink);
        }
        
        /* Badge Grid */
        .badge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px;
        }
        
        .badge-item {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s;
            flex-wrap: wrap;
        }
        
        .badge-item:hover {
            border-color: var(--accent-cyan);
            transform: translateX(4px);
        }
        
        .badge-item.missing {
            opacity: 0.7;
        }
        
        .badge-item.missing:hover {
            border-color: var(--accent-pink);
        }
        
        .badge-item-img {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
            flex-shrink: 0;
        }
        
        .badge-item-content {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-width: 0;
        }
        
        .badge-name {
            font-weight: 500;
            font-size: 15px;
        }
        
        .badge-count {
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            color: var(--text-secondary);
            flex-shrink: 0;
        }
        
        .badge-item.missing .badge-count {
            color: var(--accent-pink);
        }
        
        /* Combo badge progress bar */
        .combo-progress {
            width: 100%;
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .combo-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-purple));
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        
        /* Special badge note */
        .badge-note {
            width: 100%;
            font-size: 11px;
            color: var(--accent-orange);
            margin-top: 6px;
            font-style: italic;
        }
        
        /* Bounty Hunter checkbox */
        .bounty-checkbox-container {
            width: 100%;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .bounty-checkbox-container input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--accent-cyan);
        }
        
        .bounty-checkbox-container label {
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
        }
        
        /* NFT Preview Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 24px;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            max-width: 900px;
            width: 100%;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
        }
        
        .modal-header h2 {
            font-size: 18px;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 4px 8px;
        }
        
        .modal-close:hover {
            color: var(--text-primary);
        }
        
        .modal-body {
            padding: 24px;
            overflow-y: auto;
        }
        
        .nft-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
        }
        
        .nft-card {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }
        
        .nft-card:hover {
            transform: scale(1.05);
            border-color: var(--accent-cyan);
        }
        
        .nft-card img {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            display: block;
        }
        
        .nft-card .nft-id {
            padding: 8px;
            text-align: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: var(--text-secondary);
            background: var(--bg-card);
        }
        
        /* NFT Gallery Grid */
        .nft-gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 16px;
        }
        
        .nft-gallery-card {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }
        
        .nft-gallery-card:hover {
            transform: scale(1.03);
            border-color: var(--accent-cyan);
        }
        
        .nft-gallery-card img {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            display: block;
        }
        
        .nft-gallery-info {
            padding: 10px;
            background: var(--bg-card);
        }
        
        .nft-gallery-id {
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            color: var(--text-primary);
            margin-bottom: 6px;
        }
        
        .nft-gallery-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            justify-content: center;
        }
        
        .nft-badge-tag {
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 4px;
            background: var(--bg-hover);
            color: var(--accent-cyan);
            white-space: nowrap;
        }
        
        /* Share Modal Styles */
        .share-modal {
            max-width: 700px;
        }
        
        .share-preview {
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1025 50%, #0f1020 100%);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 16px;
        }
        
        .share-preview-header {
            text-align: center;
            margin-bottom: 16px;
        }
        
        .share-preview-header h3 {
            font-size: 18px;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .share-preview-stats {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-bottom: 16px;
        }
        
        .share-stat {
            text-align: center;
        }
        
        .share-stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 24px;
            font-weight: 700;
        }
        
        .share-stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .share-badges-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            justify-content: center;
        }
        
        .share-badge-tag {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 4px;
            background: var(--bg-card);
        }
        
        .share-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .share-action-btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: transform 0.2s;
        }
        
        .share-action-btn:hover {
            transform: translateY(-2px);
        }
        
        .share-action-btn.copy {
            background: var(--accent-cyan);
            color: #000;
        }
        
        .share-action-btn.copy-img {
            background: var(--accent-purple);
            color: #fff;
        }
        
        .share-action-btn.twitter {
            background: #1DA1F2;
            color: #fff;
        }
        
        .share-action-btn.download {
            background: var(--accent-green);
            color: #000;
        }
        
        /* Share customization section */
        .share-customize {
            margin-bottom: 20px;
        }
        
        .share-customize h4 {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }
        
        .share-nft-picker {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 8px;
            margin-bottom: 16px;
        }
        
        .share-nft-option {
            flex-shrink: 0;
            width: 60px;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid var(--border);
            transition: all 0.2s;
        }
        
        .share-nft-option:hover {
            border-color: var(--accent-cyan);
        }
        
        .share-nft-option {
            flex-shrink: 0;
            width: 60px;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid var(--border);
            transition: all 0.2s;
            position: relative;
        }
        
        .share-nft-option:hover {
            border-color: var(--accent-cyan);
        }
        
        .share-nft-option.selected {
            border-color: var(--accent-gold);
            box-shadow: 0 0 12px rgba(255, 215, 0, 0.4);
        }
        
        .share-nft-option.rare {
            border-color: var(--accent-purple);
        }
        
        .share-nft-option.rare::after {
            content: '★';
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--accent-purple);
            color: #fff;
            font-size: 8px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .share-nft-option img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .share-badge-picker {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            max-height: 150px;
            overflow-y: auto;
            padding: 4px;
        }
        
        .share-badge-option {
            font-size: 11px;
            padding: 6px 10px;
            border-radius: 6px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .share-badge-option:hover {
            border-color: var(--accent-cyan);
        }
        
        .share-badge-option.selected {
            border-color: var(--accent-green);
            background: rgba(0, 255, 136, 0.1);
        }
        
        .share-selected-count {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 8px;
        }
        
        /* Share image preview */
        .share-image-preview {
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1025 50%, #0f1020 100%);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border);
        }
        
        .share-hero-nft {
            width: 120px;
            height: 120px;
            border-radius: 12px;
            object-fit: cover;
            border: 3px solid var(--accent-gold);
            margin-bottom: 12px;
        }
        
        .share-image-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .share-image-stats {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }
        
        .share-image-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            justify-content: center;
        }
        
        .share-image-footer {
            margin-top: 12px;
            font-size: 12px;
            color: var(--accent-cyan);
        }
        
        /* Loading State */
        .loading {
            text-align: center;
            padding: 48px;
            color: var(--text-secondary);
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent-cyan);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Error State */
        .error {
            text-align: center;
            padding: 48px;
            color: var(--accent-pink);
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 48px 0 24px;
            color: var(--text-secondary);
            font-size: 13px;
        }
        
        .footer a {
            color: var(--accent-cyan);
            text-decoration: none;
        }
        
        .footer-credit {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .footer-credit a {
            color: var(--accent-purple);
            font-weight: 600;
            transition: color 0.2s;
        }
        
        .footer-credit a:hover {
            color: var(--accent-cyan);
        }
        
        .footer-credit .x-icon {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }
        
        /* Compare Wallet Styles */
        .compare-modal {
            max-width: 900px;
        }
        
        .compare-input-section {
            margin-bottom: 20px;
        }
        
        .compare-input-row {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .compare-input-row input {
            flex: 1;
            padding: 12px 16px;
            background: var(--bg-hover);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .compare-input-row input:focus {
            outline: none;
            border-color: var(--accent-gold);
        }
        
        .compare-input-row button {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--accent-gold), #ff8c00);
            border: none;
            border-radius: 8px;
            color: #000;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            white-space: nowrap;
        }
        
        .compare-input-row button:hover {
            transform: translateY(-2px);
        }
        
        .compare-results {
            display: none;
        }
        
        .compare-results.active {
            display: block;
        }
        
        .compare-header {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
            padding: 16px;
            background: var(--bg-hover);
            border-radius: 12px;
        }
        
        .compare-wallet {
            text-align: center;
        }
        
        .compare-wallet-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        .compare-wallet-address {
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            font-weight: 600;
        }
        
        .compare-wallet.you .compare-wallet-address {
            color: var(--accent-cyan);
        }
        
        .compare-wallet.them .compare-wallet-address {
            color: var(--accent-gold);
        }
        
        .compare-vs {
            font-size: 24px;
            color: var(--text-secondary);
        }
        
        .compare-section {
            margin-bottom: 24px;
        }
        
        .compare-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            cursor: pointer;
            padding: 12px 16px;
            background: var(--bg-card);
            border-radius: 8px;
            border: 1px solid var(--border);
            transition: border-color 0.2s;
        }
        
        .compare-section-header:hover {
            border-color: var(--accent-cyan);
        }
        
        .compare-section-title {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .compare-section-title.they-have {
            color: var(--accent-pink);
        }
        
        .compare-section-title.you-have {
            color: var(--accent-green);
        }
        
        .compare-section-title.shared {
            color: var(--accent-purple);
        }
        
        .compare-section-count {
            background: var(--bg-hover);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 14px;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .compare-section-toggle {
            color: var(--text-secondary);
            font-size: 12px;
        }
        
        .compare-section-content {
            display: none;
            padding-top: 12px;
        }
        
        .compare-section-content.expanded {
            display: block;
        }
        
        .compare-badge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px;
        }
        
        .compare-badge-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .compare-badge-nfts {
            display: flex;
            gap: 4px;
            flex-shrink: 0;
        }
        
        .compare-badge-nft {
            width: 48px;
            height: 48px;
            border-radius: 6px;
            object-fit: cover;
            border: 2px solid var(--border);
        }
        
        .compare-badge-nft.you {
            border-color: var(--accent-cyan);
        }
        
        .compare-badge-nft.them {
            border-color: var(--accent-gold);
        }
        
        .compare-badge-info {
            flex: 1;
            min-width: 0;
        }
        
        .compare-badge-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }
        
        .compare-badge-rarity {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .compare-badge-rarity.rare {
            color: var(--accent-gold);
        }
        
        .compare-loading {
            text-align: center;
            padding: 32px;
            color: var(--text-secondary);
        }
        
        .compare-trade-summary {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: center;
            gap: 12px;
        }
        
        .compare-trade-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: transform 0.2s;
        }
        
        .compare-trade-btn:hover {
            transform: translateY(-2px);
        }
        
        .compare-trade-btn.copy {
            background: var(--accent-cyan);
            color: #000;
        }
        
        .compare-trade-btn.create-offer {
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-pink));
            color: #000;
        }
        
        /* Trade Offer Builder */
        .trade-offer-modal {
            max-width: 800px;
        }
        
        .trade-builder {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .trade-side {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
        }
        
        .trade-side.yours {
            border-color: var(--accent-cyan);
        }
        
        .trade-side.theirs {
            border-color: var(--accent-gold);
        }
        
        .trade-side-header {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .trade-side.yours .trade-side-header {
            color: var(--accent-cyan);
        }
        
        .trade-side.theirs .trade-side-header {
            color: var(--accent-gold);
        }
        
        .trade-nft-picker {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 240px;
            overflow-y: auto;
            margin-bottom: 12px;
        }
        
        .trade-picker-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .trade-picker-section-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .trade-picker-section-label.valuable {
            color: var(--accent-gold);
        }
        
        .trade-picker-section-label .badge-count {
            background: var(--accent-gold);
            color: #000;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
        }
        
        .trade-picker-nfts {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .trade-nft-option {
            width: 56px;
            height: 56px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid var(--border);
            transition: all 0.2s;
            position: relative;
        }
        
        .trade-nft-option:hover {
            border-color: var(--accent-purple);
        }
        
        .trade-nft-option.selected {
            border-color: var(--accent-green);
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.4);
        }
        
        .trade-nft-option.valuable {
            border-color: var(--accent-gold);
            box-shadow: 0 0 8px rgba(255, 215, 0, 0.3);
        }
        
        .trade-nft-option.valuable.selected {
            border-color: var(--accent-green);
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.4);
        }
        
        .trade-nft-option .badge-indicator {
            position: absolute;
            bottom: 2px;
            left: 2px;
            background: var(--accent-gold);
            color: #000;
            font-size: 9px;
            padding: 1px 4px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .trade-nft-option.selected::after {
            content: '✓';
            position: absolute;
            top: 2px;
            right: 2px;
            background: var(--accent-green);
            color: #000;
            font-size: 10px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .trade-nft-option img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Custom image upload */
        .trade-custom-images {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed var(--border);
        }
        
        .trade-custom-label {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .trade-custom-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .trade-custom-add {
            width: 56px;
            height: 56px;
            border-radius: 8px;
            border: 2px dashed var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-secondary);
            font-size: 24px;
        }
        
        .trade-custom-add:hover {
            border-color: var(--accent-purple);
            color: var(--accent-purple);
        }
        
        .trade-custom-img {
            width: 56px;
            height: 56px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid var(--accent-purple);
            position: relative;
        }
        
        .trade-custom-img.selected {
            border-color: var(--accent-green);
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.4);
        }
        
        .trade-custom-img.selected::after {
            content: '✓';
            position: absolute;
            top: 2px;
            right: 2px;
            background: var(--accent-green);
            color: #000;
            font-size: 10px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .trade-custom-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .trade-custom-img .remove-btn {
            position: absolute;
            top: 2px;
            left: 2px;
            background: var(--accent-pink);
            color: #fff;
            font-size: 10px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .trade-custom-img:hover .remove-btn {
            opacity: 1;
        }
        
        /* Trade Simulator */
        .trade-simulator {
            background: var(--bg-hover);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .trade-sim-header {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .trade-sim-net {
            margin-left: auto;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }
        
        .trade-sim-net.positive {
            background: rgba(0, 255, 136, 0.15);
            color: var(--accent-green);
        }
        
        .trade-sim-net.negative {
            background: rgba(255, 0, 128, 0.15);
            color: var(--accent-pink);
        }
        
        .trade-sim-net.neutral {
            background: rgba(136, 136, 153, 0.15);
            color: var(--text-secondary);
        }
        
        .trade-sim-section {
            margin-bottom: 12px;
        }
        
        .trade-sim-section:last-child {
            margin-bottom: 0;
        }
        
        .trade-sim-section-title {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .trade-sim-section-title.gain {
            color: var(--accent-green);
        }
        
        .trade-sim-section-title.lose {
            color: var(--accent-pink);
        }
        
        .trade-sim-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .trade-sim-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: var(--bg-card);
            border-radius: 6px;
            font-size: 12px;
        }
        
        .trade-sim-badge img {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .trade-sim-badge.gain {
            border: 1px solid var(--accent-green);
        }
        
        .trade-sim-badge.lose {
            border: 1px solid var(--accent-pink);
        }
        
        .trade-sim-empty {
            font-size: 12px;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        .trade-selected-nfts {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            min-height: 60px;
            padding: 8px;
            background: var(--bg-hover);
            border-radius: 8px;
            margin-bottom: 12px;
        }
        
        .trade-selected-nft {
            width: 52px;
            text-align: center;
        }
        
        .trade-selected-nft img {
            width: 48px;
            height: 48px;
            border-radius: 6px;
            object-fit: cover;
        }
        
        .trade-selected-nft span {
            font-size: 10px;
            color: var(--text-secondary);
            display: block;
            margin-top: 2px;
        }
        
        .trade-eth-input {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .trade-eth-input label {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .trade-eth-input input {
            width: 80px;
            padding: 8px 10px;
            background: var(--bg-hover);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
        }
        
        .trade-eth-input input:focus {
            outline: none;
            border-color: var(--accent-purple);
        }
        
        .trade-middle {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .trade-arrow {
            font-size: 32px;
            color: var(--accent-purple);
        }
        
        .trade-label {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            letter-spacing: 2px;
        }
        
        /* Trade Preview */
        .trade-preview-container {
            background: var(--bg-hover);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .trade-preview-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-align: center;
        }
        
        .trade-preview {
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1025 50%, #0f1020 100%);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
        }
        
        .trade-preview-header {
            text-align: center;
            margin-bottom: 16px;
        }
        
        .trade-preview-title {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .trade-preview-content {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 16px;
            align-items: center;
        }
        
        .trade-preview-side {
            text-align: center;
        }
        
        .trade-preview-side-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .trade-preview-side.yours .trade-preview-side-label {
            color: var(--accent-cyan);
        }
        
        .trade-preview-side.theirs .trade-preview-side-label {
            color: var(--accent-gold);
        }
        
        .trade-preview-nfts {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }
        
        .trade-preview-nft {
            text-align: center;
        }
        
        .trade-preview-nft img {
            width: 64px;
            height: 64px;
            border-radius: 8px;
            object-fit: cover;
        }
        
        .trade-preview-side.yours .trade-preview-nft img {
            border: 2px solid var(--accent-cyan);
        }
        
        .trade-preview-side.theirs .trade-preview-nft img {
            border: 2px solid var(--accent-gold);
        }
        
        .trade-preview-nft span {
            display: block;
            font-size: 11px;
            font-family: 'JetBrains Mono', monospace;
            margin-top: 4px;
        }
        
        .trade-preview-side.yours .trade-preview-nft span {
            color: var(--accent-cyan);
        }
        
        .trade-preview-side.theirs .trade-preview-nft span {
            color: var(--accent-gold);
        }
        
        .trade-preview-eth {
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            margin-top: 8px;
            padding: 4px 8px;
            background: var(--bg-card);
            border-radius: 4px;
            display: inline-block;
        }
        
        .trade-preview-middle {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        
        .trade-preview-arrows {
            font-size: 24px;
            color: var(--accent-purple);
        }
        
        .trade-preview-for {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .trade-preview-footer {
            text-align: center;
            margin-top: 16px;
            font-size: 12px;
            color: var(--accent-cyan);
        }
        
        .trade-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        
        .trade-action-btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: transform 0.2s;
        }
        
        .trade-action-btn:hover {
            transform: translateY(-2px);
        }
        
        .trade-action-btn.copy-img {
            background: var(--accent-purple);
            color: #fff;
        }
        
        .trade-action-btn.download {
            background: var(--accent-green);
            color: #000;
        }
        
        /* NFT Lookup Section */
        .nft-lookup-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .nft-lookup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .nft-lookup-header h3 {
            font-size: 18px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nft-lookup-input-row {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .nft-lookup-input-row input {
            flex: 1;
            max-width: 200px;
            padding: 12px 16px;
            background: var(--bg-hover);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 16px;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .nft-lookup-input-row input:focus {
            outline: none;
            border-color: var(--accent-cyan);
        }
        
        .nft-lookup-input-row button {
            padding: 12px 24px;
            background: var(--accent-cyan);
            border: none;
            border-radius: 8px;
            color: #000;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .nft-lookup-input-row button:hover {
            transform: translateY(-2px);
        }
        
        .nft-lookup-result {
            display: none;
        }
        
        .nft-lookup-result.active {
            display: block;
        }
        
        .nft-lookup-card {
            display: flex;
            gap: 24px;
            background: var(--bg-hover);
            border-radius: 12px;
            padding: 20px;
        }
        
        .nft-lookup-image {
            flex-shrink: 0;
        }
        
        .nft-lookup-image img {
            width: 160px;
            height: 160px;
            border-radius: 12px;
            object-fit: cover;
            border: 3px solid var(--accent-cyan);
        }
        
        .nft-lookup-info {
            flex: 1;
        }
        
        .nft-lookup-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-cyan);
            margin-bottom: 8px;
        }
        
        .nft-lookup-stats {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .nft-lookup-stat {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .nft-lookup-stat strong {
            color: var(--text-primary);
        }
        
        .nft-lookup-badges-title {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        
        .nft-lookup-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .nft-lookup-badge {
            padding: 8px 14px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nft-lookup-badge-rarity {
            font-size: 11px;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .nft-lookup-badge-rarity.rare {
            color: var(--accent-gold);
        }
        
        .nft-lookup-no-badges {
            color: var(--text-secondary);
            font-style: italic;
        }
        
        .nft-lookup-opensea {
            margin-top: 16px;
        }
        
        .nft-lookup-opensea a {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: var(--accent-cyan);
            text-decoration: none;
            font-size: 13px;
        }
        
        .nft-lookup-opensea a:hover {
            text-decoration: underline;
        }
        
        .nft-lookup-whatif {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }
        
        .nft-lookup-whatif-title {
            font-size: 14px;
            color: var(--accent-green);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .nft-lookup-whatif-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .nft-lookup-whatif-badge {
            padding: 6px 10px;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid var(--accent-green);
            border-radius: 6px;
            font-size: 12px;
        }
        
        .nft-lookup-whatif-none {
            color: var(--text-secondary);
            font-size: 13px;
        }
        
        /* Badge Image Styles */
        .badge-img {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            object-fit: cover;
            flex-shrink: 0;
        }
        
        .badge-img.small {
            width: 24px;
            height: 24px;
            border-radius: 4px;
        }
        
        .badge-img.large {
            width: 48px;
            height: 48px;
            border-radius: 8px;
        }
        
        /* Badge Explorer */
        .badge-explorer-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .badge-explorer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .badge-explorer-header h3 {
            font-size: 18px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .badge-explorer-controls {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .badge-explorer-search {
            padding: 8px 12px;
            background: var(--bg-hover);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 14px;
            width: 180px;
        }
        
        .badge-explorer-search:focus {
            outline: none;
            border-color: var(--accent-cyan);
        }
        
        .badge-explorer-filter {
            padding: 8px 12px;
            background: var(--bg-hover);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
        }
        
        .badge-explorer-filter:focus {
            outline: none;
            border-color: var(--accent-cyan);
        }
        
        .badge-explorer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px;
            max-height: 500px;
            overflow-y: auto;
            padding-right: 8px;
        }
        
        .badge-explorer-grid::-webkit-scrollbar {
            width: 8px;
        }
        
        .badge-explorer-grid::-webkit-scrollbar-track {
            background: var(--bg-hover);
            border-radius: 4px;
        }
        
        .badge-explorer-grid::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }
        
        .badge-explorer-grid::-webkit-scrollbar-thumb:hover {
            background: var(--accent-purple);
        }
        
        .explorer-badge-card {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--bg-hover);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .explorer-badge-card:hover {
            border-color: var(--accent-cyan);
            transform: translateY(-2px);
        }
        
        .explorer-badge-card.owned {
            border-color: var(--accent-green);
            background: rgba(0, 255, 136, 0.05);
        }
        
        .explorer-badge-img {
            width: 56px;
            height: 56px;
            border-radius: 10px;
            object-fit: cover;
            flex-shrink: 0;
        }
        
        .explorer-badge-card.owned .explorer-badge-img {
            box-shadow: 0 0 12px rgba(0, 255, 136, 0.3);
        }
        
        .explorer-badge-info {
            flex: 1;
            min-width: 0;
        }
        
        .explorer-badge-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .explorer-badge-meta {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .explorer-badge-category {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 4px;
            background: var(--bg-card);
            color: var(--text-secondary);
        }
        
        .explorer-badge-category.trait {
            background: rgba(0, 212, 255, 0.15);
            color: var(--accent-cyan);
        }
        
        .explorer-badge-category.collection {
            background: rgba(168, 85, 247, 0.15);
            color: var(--accent-purple);
        }
        
        .explorer-badge-category.type {
            background: rgba(255, 215, 0, 0.15);
            color: var(--accent-gold);
        }
        
        .explorer-badge-category.vibestr {
            background: rgba(255, 0, 128, 0.15);
            color: var(--accent-pink);
        }
        
        .explorer-badge-rarity {
            font-size: 11px;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .explorer-badge-rarity.rare {
            color: var(--accent-gold);
        }
        
        .explorer-badge-owned {
            font-size: 11px;
            color: var(--accent-green);
            font-weight: 600;
        }
        
        .explorer-empty {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }
        
        .explorer-stats {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .explorer-stats span {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .explorer-stats strong {
            color: var(--text-primary);
        }
        
        /* Badge Explorer Button (shown after wallet lookup) */
        .badge-explorer-btn {
            display: none;
            width: 100%;
            padding: 16px 24px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 24px;
            text-align: center;
        }
        
        .badge-explorer-btn:hover {
            border-color: var(--accent-cyan);
            background: var(--bg-hover);
        }
        
        .badge-explorer-btn span {
            margin-right: 8px;
        }
        
        /* Badge Explorer Modal */
        .badge-explorer-modal {
            max-width: 1000px;
            max-height: 85vh;
        }
        
        .badge-explorer-modal .modal-body {
            padding: 0;
        }
        
        .badge-explorer-modal .badge-explorer-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 0;
        }
        
        .badge-explorer-modal .explorer-stats {
            padding: 12px 20px;
            margin-bottom: 0;
            border-bottom: 1px solid var(--border);
        }
        
        .badge-explorer-modal .badge-explorer-grid {
            max-height: 55vh;
            padding: 16px 20px;
        }
        
        /* High Value Target Cards */
        .target-nft-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 16px;
        }
        
        .target-nft-card {
            background: var(--bg-card);
            border: 2px solid var(--accent-gold);
            border-radius: 12px;
            padding: 16px;
            display: flex;
            gap: 16px;
            position: relative;
            overflow: hidden;
        }
        
        .target-nft-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-gold), var(--accent-pink));
        }
        
        .target-nft-img {
            width: 80px;
            height: 80px;
            border-radius: 10px;
            object-fit: cover;
            border: 2px solid var(--accent-gold);
            flex-shrink: 0;
        }
        
        .target-nft-info {
            flex: 1;
            min-width: 0;
        }
        
        .target-nft-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .target-nft-id {
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            color: var(--accent-gold);
            font-weight: 600;
        }
        
        .target-nft-count {
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-pink));
            color: #000;
            font-size: 12px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 12px;
        }
        
        .target-nft-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .target-badge-tag {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 4px;
            background: var(--bg-hover);
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .header h1 { font-size: 1.8rem; }
            .search-box { flex-direction: column; }
            .search-box button { width: 100%; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .tabs { flex-wrap: wrap; }
            .tabs-container { flex-direction: column; align-items: stretch; }
            .sort-controls { justify-content: center; }
            .share-buttons { flex-direction: column; }
            .share-btn { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>🤙 GVC Badge Lookup</h1>
            <p>Check your badge collection and find what you're missing</p>
        </header>
        
        <section class="search-section">
            <div class="search-box">
                <input type="text" id="walletInput" placeholder="Enter wallet(s), ENS name(s), or token IDs...">
                <button onclick="lookupWallet()">Look Up</button>
            </div>
            <p class="search-hint">Supports multiple wallets! Separate with commas: 0x123..., name.eth, 0x456...</p>
        </section>
        
        <!-- NFT Lookup Section -->
        <section class="nft-lookup-section" id="nftLookupSection">
            <div class="nft-lookup-header">
                <h3>🔍 NFT Badge Lookup</h3>
            </div>
            <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 16px;">
                Enter a GVC token ID to see all its badges - useful for evaluating NFTs before buying!
            </p>
            <div class="nft-lookup-input-row">
                <input type="number" id="nftLookupInput" placeholder="Token ID (1-10000)" min="1" max="10000">
                <button onclick="lookupNFT()">Look Up NFT</button>
            </div>
            <div class="nft-lookup-result" id="nftLookupResult"></div>
        </section>
        
        <!-- Badge Explorer Button (shown after wallet lookup) -->
        <button class="badge-explorer-btn" id="badgeExplorerBtn" onclick="showBadgeExplorerModal()">
            <span>🏅</span> Explore All 89 Badges
        </button>
        
        <!-- Badge Explorer Section (visible on load, hidden after lookup) -->
        <section class="badge-explorer-section" id="badgeExplorerSection">
            <div class="badge-explorer-header">
                <h3>🏅 Badge Explorer</h3>
                <div class="badge-explorer-controls">
                    <input type="text" class="badge-explorer-search" id="badgeExplorerSearch" placeholder="Search badges..." oninput="filterBadgeExplorer()">
                    <select class="badge-explorer-filter" id="badgeExplorerFilter" onchange="filterBadgeExplorer()">
                        <option value="all">All Categories</option>
                        <option value="trait">Trait Badges</option>
                        <option value="type">Type Badges</option>
                        <option value="collection">Collection Badges</option>
                        <option value="vibestr">$VIBESTR Badges</option>
                    </select>
                    <select class="badge-explorer-filter" id="badgeExplorerSort" onchange="filterBadgeExplorer()">
                        <option value="rarity">Sort: Rarest First</option>
                        <option value="rarity-desc">Sort: Most Common</option>
                        <option value="alpha">Sort: A-Z</option>
                    </select>
                </div>
            </div>
            <div class="explorer-stats" id="explorerStats">
                <span>📊 <strong>89</strong> total badges</span>
                <span id="explorerOwnedStat" style="display: none;">✅ <strong>0</strong> owned</span>
            </div>
            <div class="badge-explorer-grid" id="badgeExplorerGrid">
                <!-- Badges will be rendered here -->
            </div>
        </section>
        
        <section class="results" id="results">
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Looking up badges...</p>
            </div>
            
            <div class="error" id="error" style="display: none;">
                <p>Could not find NFTs for this wallet. Try entering token IDs directly.</p>
            </div>
            
            <div id="resultsContent" style="display: none;">
                <div class="stats-grid">
                    <div class="stat-card cyan clickable" onclick="showNFTGallery()">
                        <div class="value" id="nftCount">0</div>
                        <div class="label">GVC NFTs (click to view)</div>
                    </div>
                    <div class="stat-card green">
                        <div class="value" id="ownedBadges">0</div>
                        <div class="label">Badges Owned</div>
                    </div>
                    <div class="stat-card pink">
                        <div class="value" id="missingBadges">0</div>
                        <div class="label">Missing</div>
                    </div>
                    <div class="stat-card gold rarest" id="rarestCard">
                        <div class="label">Rarest Badge</div>
                        <img class="rarest-nft-img" id="rarestNftImg" src="" alt="Rarest NFT" style="display: none;">
                        <div class="rarest-badge-name" id="rarestBadge">-</div>
                    </div>
                </div>
                
                <div class="completion-section">
                    <div class="completion-header">
                        <h3>Badge Completion</h3>
                        <span id="completionPct">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                </div>
                
                <div class="share-buttons">
                    <button class="share-btn owned" onclick="showShareModal('owned')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
                            <polyline points="16 6 12 2 8 6"/>
                            <line x1="12" y1="2" x2="12" y2="15"/>
                        </svg>
                        Share My Badges
                    </button>
                    <button class="share-btn hunting" onclick="showShareModal('hunting')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                        </svg>
                        I'm On The Hunt
                    </button>
                    <button class="share-btn compare" onclick="showCompareModal()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 3h5v5"/>
                            <path d="M8 21H3v-5"/>
                            <path d="M21 3l-9 9"/>
                            <path d="M3 21l9-9"/>
                        </svg>
                        Compare Wallets
                    </button>
                </div>
                
                <div class="tabs-container">
                    <div class="tabs">
                        <button class="tab active" onclick="showTab('owned')">Owned (<span id="ownedTabCount">0</span>)</button>
                        <button class="tab missing" onclick="showTab('missing')">Missing (<span id="missingTabCount">0</span>)</button>
                    </div>
                    <div class="sort-controls">
                        <span class="sort-label">Sort:</span>
                        <button class="sort-btn active" data-sort="rarity" onclick="setSortMode('rarity')">Rarity <span class="arrow">↑</span></button>
                        <button class="sort-btn" data-sort="quantity" onclick="setSortMode('quantity')">Quantity <span class="arrow">↓</span></button>
                        <button class="sort-btn" data-sort="alpha" onclick="setSortMode('alpha')">A-Z <span class="arrow">↓</span></button>
                    </div>
                </div>
                
                <div class="badge-grid" id="ownedGrid"></div>
                <div class="badge-grid" id="missingGrid" style="display: none;"></div>
            </div>
        </section>
        
        <footer class="footer">
            <p>Built for the <a href="https://opensea.io/collection/good-vibes-club" target="_blank">Good Vibes Club</a> community 🤙</p>
            <div class="footer-credit">
                <span>Vibe Coded by</span>
                <a href="https://x.com/GoldenBronny" target="_blank">
                    <svg class="x-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                    GoldenBronny
                </a>
            </div>
        </footer>
    </div>
    
    <!-- Dynamic Floating NFTs Container -->
    <div class="floating-nfts-container" id="floatingNftsContainer"></div>
    
    <!-- NFT Preview Modal -->
    <div class="modal-overlay" id="modal" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 id="modalTitle">Badge Name</h2>
                <a id="modalOpenSeaLink" href="#" target="_blank" style="display: none; color: var(--accent-cyan); text-decoration: none; font-size: 13px; margin-left: 12px;">View all on OpenSea →</a>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="nft-grid" id="modalNFTs"></div>
            </div>
        </div>
    </div>
    
    <!-- NFT Gallery Modal -->
    <div class="modal-overlay" id="galleryModal" onclick="closeGalleryModal(event)">
        <div class="modal" style="max-width: 1000px;" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 id="galleryTitle">Your GVC Collection</h2>
                <button class="modal-close" onclick="closeGalleryModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="nft-gallery-grid" id="galleryNFTs"></div>
            </div>
        </div>
    </div>
    
    <!-- Share Modal -->
    <div class="modal-overlay" id="shareModal" onclick="closeShareModal(event)">
        <div class="modal share-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 id="shareModalTitle">Share Your Badges</h2>
                <button class="modal-close" onclick="closeShareModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- NFT Picker -->
                <div class="share-customize">
                    <h4>🖼️ Choose your featured NFT:</h4>
                    <div class="share-nft-picker" id="shareNftPicker"></div>
                </div>
                
                <!-- Badge Picker -->
                <div class="share-customize">
                    <h4 id="badgePickerTitle">✨ Select badges to feature (max 6):</h4>
                    <div class="share-badge-picker" id="shareBadgePicker"></div>
                    <div class="share-selected-count" id="shareSelectedCount">0 of 6 selected</div>
                </div>
                
                <!-- Preview -->
                <div class="share-image-preview" id="shareImagePreview"></div>
                
                <!-- Actions -->
                <div class="share-actions" style="margin-top: 16px;">
                    <button class="share-action-btn copy" onclick="copyShareText()">📋 Copy Text</button>
                    <button class="share-action-btn copy-img" onclick="copyShareImage()">🖼️ Copy Image</button>
                    <button class="share-action-btn twitter" onclick="shareToTwitter()">𝕏 Share</button>
                    <button class="share-action-btn download" onclick="downloadShareImage()">📥 Save Image</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Compare Wallet Modal -->
    <div class="modal-overlay" id="compareModal" onclick="closeCompareModal(event)">
        <div class="modal compare-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>🔄 Compare Wallets</h2>
                <button class="modal-close" onclick="closeCompareModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Input Section -->
                <div class="compare-input-section">
                    <p style="color: var(--text-secondary); margin-bottom: 12px; font-size: 14px;">
                        Enter another wallet to find potential badge trades
                    </p>
                    <div class="compare-input-row">
                        <input type="text" id="compareWalletInput" placeholder="Enter wallet address or ENS name..." />
                        <button onclick="runComparison()">Compare</button>
                    </div>
                </div>
                
                <!-- Loading State -->
                <div class="compare-loading" id="compareLoading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Loading wallet data...</p>
                </div>
                
                <!-- Results Section -->
                <div class="compare-results" id="compareResults">
                    <!-- Header with wallet addresses -->
                    <div class="compare-header">
                        <div class="compare-wallet you">
                            <div class="compare-wallet-label">Your Wallet</div>
                            <div class="compare-wallet-address" id="compareYouAddress">-</div>
                        </div>
                        <div class="compare-vs">⚡</div>
                        <div class="compare-wallet them">
                            <div class="compare-wallet-label">Their Wallet</div>
                            <div class="compare-wallet-address" id="compareThemAddress">-</div>
                        </div>
                    </div>
                    
                    <!-- High Value Targets -->
                    <div class="compare-section" id="sectionTargets">
                        <div class="compare-section-header" onclick="toggleCompareSection('targets')">
                            <div class="compare-section-title" style="color: var(--accent-gold);">
                                🎯 High Value Targets
                                <span class="compare-section-count" id="countTargets">0</span>
                            </div>
                            <div class="compare-section-toggle" id="toggleTargets">▼</div>
                        </div>
                        <div class="compare-section-content expanded" id="contentTargets">
                            <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 12px;">
                                Their NFTs that have multiple badges you need - best trade targets!
                            </p>
                            <div class="target-nft-grid" id="gridTargets"></div>
                        </div>
                    </div>
                    
                    <!-- They Have, You Need -->
                    <div class="compare-section" id="sectionTheyHave">
                        <div class="compare-section-header" onclick="toggleCompareSection('theyHave')">
                            <div class="compare-section-title they-have">
                                🎯 They Have, You Need
                                <span class="compare-section-count" id="countTheyHave">0</span>
                            </div>
                            <div class="compare-section-toggle" id="toggleTheyHave">▼</div>
                        </div>
                        <div class="compare-section-content expanded" id="contentTheyHave">
                            <div class="compare-badge-grid" id="gridTheyHave"></div>
                        </div>
                    </div>
                    
                    <!-- You Have, They Need -->
                    <div class="compare-section" id="sectionYouHave">
                        <div class="compare-section-header" onclick="toggleCompareSection('youHave')">
                            <div class="compare-section-title you-have">
                                💎 You Have, They Need
                                <span class="compare-section-count" id="countYouHave">0</span>
                            </div>
                            <div class="compare-section-toggle" id="toggleYouHave">▼</div>
                        </div>
                        <div class="compare-section-content expanded" id="contentYouHave">
                            <div class="compare-badge-grid" id="gridYouHave"></div>
                        </div>
                    </div>
                    
                    <!-- Shared Badges -->
                    <div class="compare-section" id="sectionShared">
                        <div class="compare-section-header" onclick="toggleCompareSection('shared')">
                            <div class="compare-section-title shared">
                                🤝 Badges You Both Have
                                <span class="compare-section-count" id="countShared">0</span>
                            </div>
                            <div class="compare-section-toggle" id="toggleShared">▶</div>
                        </div>
                        <div class="compare-section-content" id="contentShared">
                            <div class="compare-badge-grid" id="gridShared"></div>
                        </div>
                    </div>
                    
                    <!-- Trade Summary Actions -->
                    <div class="compare-trade-summary">
                        <button class="compare-trade-btn copy" onclick="copyTradeSummary()">📋 Copy Trade Summary</button>
                        <button class="compare-trade-btn create-offer" onclick="showTradeOfferBuilder()">🎨 Create Trade Offer</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Badge Explorer Modal -->
    <div class="modal-overlay" id="badgeExplorerModal" onclick="closeBadgeExplorerModal(event)">
        <div class="modal badge-explorer-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>🏅 Badge Explorer</h2>
                <button class="modal-close" onclick="closeBadgeExplorerModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="badge-explorer-header">
                    <div class="badge-explorer-controls">
                        <input type="text" class="badge-explorer-search" id="badgeExplorerSearchModal" placeholder="Search badges..." oninput="filterBadgeExplorerModal()">
                        <select class="badge-explorer-filter" id="badgeExplorerFilterModal" onchange="filterBadgeExplorerModal()">
                            <option value="all">All Categories</option>
                            <option value="trait">Trait Badges</option>
                            <option value="type">Type Badges</option>
                            <option value="collection">Collection Badges</option>
                            <option value="vibestr">$VIBESTR Badges</option>
                        </select>
                        <select class="badge-explorer-filter" id="badgeExplorerSortModal" onchange="filterBadgeExplorerModal()">
                            <option value="rarity">Sort: Rarest First</option>
                            <option value="rarity-desc">Sort: Most Common</option>
                            <option value="alpha">Sort: A-Z</option>
                        </select>
                    </div>
                </div>
                <div class="explorer-stats" id="explorerStatsModal">
                    <span>📊 <strong>89</strong> total badges</span>
                    <span id="explorerOwnedStatModal" style="display: none;">✅ <strong>0</strong> owned</span>
                </div>
                <div class="badge-explorer-grid" id="badgeExplorerGridModal">
                    <!-- Badges will be rendered here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Trade Offer Builder Modal -->
    <div class="modal-overlay" id="tradeOfferModal" onclick="closeTradeOfferModal(event)">
        <div class="modal trade-offer-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>🎨 Create Trade Offer</h2>
                <button class="modal-close" onclick="closeTradeOfferModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="trade-builder">
                    <!-- Trade Simulator - spans all columns -->
                    <div class="trade-simulator" id="tradeSimulator" style="grid-column: 1 / -1; display: block;">
                        <div class="trade-sim-header">
                            📊 Badge Impact Analysis
                            <span class="trade-sim-net" id="tradeSimNet">Select NFTs</span>
                        </div>
                        <div class="trade-sim-section" id="tradeSimGain">
                            <div class="trade-sim-section-title gain">🟢 You'd GAIN:</div>
                            <div class="trade-sim-badges" id="tradeSimGainBadges"><span class="trade-sim-empty">Select NFTs to analyze</span></div>
                        </div>
                        <div class="trade-sim-section" id="tradeSimLose">
                            <div class="trade-sim-section-title lose">🔴 You'd LOSE:</div>
                            <div class="trade-sim-badges" id="tradeSimLoseBadges"><span class="trade-sim-empty">Select NFTs to analyze</span></div>
                        </div>
                    </div>
                    
                    <!-- Your Side -->
                    <div class="trade-side yours">
                        <div class="trade-side-header">📤 You're Offering</div>
                        <div class="trade-selected-nfts" id="tradeYourSelected">
                            <span style="color: var(--text-secondary); font-size: 12px;">Click NFTs below to add</span>
                        </div>
                        <div class="trade-nft-picker" id="tradeYourPicker"></div>
                        <div class="trade-custom-images">
                            <div class="trade-custom-label">Add other NFTs:</div>
                            <div class="trade-custom-grid" id="tradeYourCustom">
                                <div class="trade-custom-add" onclick="addCustomImage('yours')" title="Add custom NFT image">+</div>
                            </div>
                            <input type="file" id="customImageInputYours" accept="image/*" style="display:none" onchange="handleCustomImageUpload(event, 'yours')">
                        </div>
                        <div class="trade-eth-input">
                            <label>+ ETH:</label>
                            <input type="number" id="tradeYourEth" placeholder="0.00" step="0.01" min="0" onchange="updateTradePreview()">
                        </div>
                    </div>
                    
                    <!-- Middle -->
                    <div class="trade-middle">
                        <span class="trade-arrow">⇄</span>
                        <span class="trade-label">TRADE</span>
                    </div>
                    
                    <!-- Their Side -->
                    <div class="trade-side theirs">
                        <div class="trade-side-header">📥 You're Requesting</div>
                        <div class="trade-selected-nfts" id="tradeTheirSelected">
                            <span style="color: var(--text-secondary); font-size: 12px;">Click NFTs below to add</span>
                        </div>
                        <div class="trade-nft-picker" id="tradeTheirPicker"></div>
                        <div class="trade-custom-images">
                            <div class="trade-custom-label">Add other NFTs:</div>
                            <div class="trade-custom-grid" id="tradeTheirCustom">
                                <div class="trade-custom-add" onclick="addCustomImage('theirs')" title="Add custom NFT image">+</div>
                            </div>
                            <input type="file" id="customImageInputTheirs" accept="image/*" style="display:none" onchange="handleCustomImageUpload(event, 'theirs')">
                        </div>
                        <div class="trade-eth-input">
                            <label>+ ETH:</label>
                            <input type="number" id="tradeTheirEth" placeholder="0.00" step="0.01" min="0" onchange="updateTradePreview()">
                        </div>
                    </div>
                </div>
                
                <!-- Preview -->
                <div class="trade-preview-container">
                    <div class="trade-preview-label">Preview</div>
                    <div class="trade-preview" id="tradePreview">
                        <div class="trade-preview-header">
                            <div class="trade-preview-title">🤝 Trade Offer</div>
                        </div>
                        <div class="trade-preview-content">
                            <div class="trade-preview-side yours">
                                <div class="trade-preview-side-label">I Give</div>
                                <div class="trade-preview-nfts" id="previewYourNfts">
                                    <span style="color: var(--text-secondary); font-size: 12px;">Select NFTs</span>
                                </div>
                                <div class="trade-preview-eth" id="previewYourEth" style="display: none;"></div>
                            </div>
                            <div class="trade-preview-middle">
                                <div class="trade-preview-arrows">⟷</div>
                                <div class="trade-preview-for">FOR</div>
                            </div>
                            <div class="trade-preview-side theirs">
                                <div class="trade-preview-side-label">I Get</div>
                                <div class="trade-preview-nfts" id="previewTheirNfts">
                                    <span style="color: var(--text-secondary); font-size: 12px;">Select NFTs</span>
                                </div>
                                <div class="trade-preview-eth" id="previewTheirEth" style="display: none;"></div>
                            </div>
                        </div>
                        <div class="trade-preview-footer">gvcbadges.com</div>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="trade-actions">
                    <button class="trade-action-btn copy-img" onclick="copyTradeOfferImage()">🖼️ Copy Image</button>
                    <button class="trade-action-btn download" onclick="downloadTradeOfferImage()">📥 Save Image</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Badge data will be loaded from GVC's API
        let badgeData = {};
        let nftData = {};
        let imageData = {};
        let walletNFTs = [];
        let walletBadges = {};
        let missingBadgesList = [];
        let ownedTypesGlobal = [];
        
        // New state variables
        let currentSortMode = 'rarity';
        let sortDirection = 'asc'; // 'asc' or 'desc'
        let currentTab = 'owned';
        let shareMode = 'owned';
        let rarestBadgeData = { badge: null, badgeName: '-', tokenId: null };
        
        // Compare wallet state
        let compareWalletData = {
            address: null,
            nfts: [],
            badges: {},
            tokenToBadges: {}
        };
        
        // Trade offer state
        let tradeOfferData = {
            yourNfts: [],
            theirNfts: [],
            yourEth: 0,
            theirEth: 0
        };
        
        // VIBE Bounty Hunter self-report state
        let vibeBountyHunterCount = 0;
        
        // ===========================================
        // BADGE IMAGE URLs (from GVC API)
        // ===========================================
        const BADGE_IMAGES = {
            "multi_type_master": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/multi_type_master_1759173898608.webp",
            "five_badges": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/five_badges_1759173901700.webp",
            "ten_badges": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/ten_badges_1759173905051.webp",
            "fifteen_badges": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/fifteen_badges_1759173908432.webp",
            "thirty_badges": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/thirty_badges_1760378215065.webp",
            "forty_badges": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/forty_badges_1760378218029.webp",
            "twenty_badges": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/twenty_badges_1760372854419.webp",
            "fifty_badges": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/fifty_badges_1760378221304.webp",
            "gradient_hatrick": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/gradient_hatrick_1759173915751.webp",
            "plastic_hatrick": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/plastic_hatrick_1759173918553.webp",
            "robot_hatrick": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/robot_hatrick_1759173921703.webp",
            "gradient_high_five": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/gradient_high_five_1759173924809.webp",
            "plastic_high_five": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/plastic_high_five_1759173927856.webp",
            "robot_high_five": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/robot_high_five_1759173931029.webp",
            "yin_n_yang": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/yin_n_yang_1759173942484.webp",
            "power_duo": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/power_duo_1759173963251.webp",
            "chris_favorite_badge": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/chris_favorite_badge_1759173988815.webp",
            "elite_rainbow_ranger": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/elite_rainbow_ranger_1759174003980.webp",
            "vibestr_blue_tier": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/vibestr_blue_tier_1762440817215.webp",
            "vibestr_pink_tier": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/vibestr_pink_tier_1759174030384.webp",
            "vibestr_purple_tier": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/vibestr_purple_tier_1764590442681.webp",
            "vibestr_bronze_tier": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/vibestr_bronze_tier_1759174034267.webp",
            "vibestr_silver_tier": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/vibestr_silver_tier_1759174037847.webp",
            "vibestr_gold_tier": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/vibestr_gold_tier_1759174041345.webp",
            "vibestr_diamond_tier": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/vibestr_diamond_tier_1764590445999.webp",
            "vibestr_cosmic_tier": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/vibestr_cosmic_tier_1764590448508.webp",
            "mountain_goat": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/mountain_goat_1759174026593.webp",
            "vibestr_bounty_hunter": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/vibestr_bounty_hunter_1759174044563.webp",
            "one_of_one": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/one_of_one_1759173811608.webp",
            "stone": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/stone_1759173815165.webp",
            "cosmic": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/cosmic_1759173818340.webp",
            "ranger": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/ranger_1759173821753.webp",
            "astro_bean": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/astro_bean_1759173824578.webp",
            "pothead": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/pothead_1759173827603.webp",
            "surfer": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/surfer_1759173830462.webp",
            "super_rare": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/super_rare_1759173833292.webp",
            "science_goggles": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/science_goggles_1759173835714.webp",
            "astro_balls": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/astro_balls_1759173838889.webp",
            "doge": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/doge_1759173842640.webp",
            "pepe": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/pepe_1759173846260.webp",
            "rainbow_visor": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/rainbow_visor_1759173849941.webp",
            "rainbow_bubble_goggles": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/rainbow_bubble_goggles_1759173853819.webp",
            "gamer": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/gamer_1759173856821.webp",
            "sweettooth": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/sweettooth_1759173860105.webp",
            "checkmate": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/checkmate_1759173863329.webp",
            "shower": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/shower_1759173865972.webp",
            "baller": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/baller_1759173868839.webp",
            "plants": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/plants_1759173871973.webp",
            "rainbow_boombox": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/rainbow_boombox_1759173875165.webp",
            "electric_rings": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/electric_rings_1759173878797.webp",
            "king": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/king_1759173882056.webp",
            "poker_face": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/poker_face_1759173884906.webp",
            "toy_bricks": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/toy_bricks_1759173887659.webp",
            "billiards": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/billiards_1759173890603.webp",
            "lamp": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/lamp_1759173892925.webp",
            "captain": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/captain_1759173895611.webp",
            "suited_up": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/suited_up_1759173934070.webp",
            "gud_meat": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/gud_meat_1759173936766.webp",
            "vibefoot_fan_club": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/vibefoot_fan_club_1759173939420.webp",
            "seas_the_day": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/seas_the_day_1759173945252.webp",
            "no_face_no_problem": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/no_face_no_problem_1759173948247.webp",
            "varsity_vibes": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/varsity_vibes_1759173950723.webp",
            "hail_mary_heroes": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/hail_mary_heroes_1759173953534.webp",
            "great_stacheby": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/great_stacheby_1759173956903.webp",
            "vibetown_social_club": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/vibetown_social_club_1759173960008.webp",
            "necks_level": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/necks_level_1759173966777.webp",
            "fur_the_win": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/fur_the_win_1759173969828.webp",
            "nounish_vibes": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/nounish_vibes_1759173973218.webp",
            "tanks_a_lot": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/tanks_a_lot_1759173976815.webp",
            "sir_vibes_a_lot": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/sir_vibes_a_lot_1759173980023.webp",
            "full_send_maverick": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/full_send_maverick_1759173982959.webp",
            "straw_man": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/straw_man_1759173985595.webp",
            "ladies_night": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/ladies_night_1759173991853.webp",
            "showtime": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/showtime_1759173995136.webp",
            "party_in_the_back": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/party_in_the_back_1759173998578.webp",
            "funky_fresh": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/funky_fresh_1759174001274.webp",
            "high_noon_hustler": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/high_noon_hustler_1759174007143.webp",
            "visooor_enjoyooor": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/visooor_enjoyooor_1759174010233.webp",
            "homerun": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/homerun_1759174013207.webp",
            "hoodie_up_society": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/hoodie_up_society_1759174015984.webp",
            "zoom_in_vibe_out": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/zoom_in_vibe_out_1759174018930.webp",
            "full_throttle": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/full_throttle_1759174022912.webp",
            "rainbow_citizen": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/rainbow_citizen_1759173791000.webp",
            "gold_member": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/gold_member_1759173793799.webp",
            "grayscale_seeker": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/grayscale_seeker_1759173797002.webp",
            "any_gvc": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/any_gvc_1759173799963.webp",
            "robot_lover": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/robot_lover_1759173802514.webp",
            "plastic_lover": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/plastic_lover_1759173806081.webp",
            "gradient_lover": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/gradient_lover_1759173808918.webp",
            // Combo badges (constructed from base badges)
            "collection_5": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/five_badges_1759173901700.webp",
            "collection_10": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/ten_badges_1759173905051.webp",
            "collection_15": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/fifteen_badges_1759173908432.webp",
            "collection_20": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/twenty_badges_1760372854419.webp",
            "collection_30": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/thirty_badges_1760378215065.webp",
            "collection_40": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/forty_badges_1760378218029.webp",
            "collection_50": "https://sl1vlqqspml5zngx.public.blob.vercel-storage.com/badges/optimized/fifty_badges_1760378221304.webp"
        };
        
        // Helper to get badge image URL
        function getBadgeImage(badge) {
            return BADGE_IMAGES[badge] || null;
        }
        
        // ===========================================
        // BADGE NAME MAPPINGS (API name -> Display name)
        // ===========================================
        const BADGE_DISPLAY_NAMES = {
            // NFT Trait Badges (62 from API)
            'any_gvc': 'Official Citizen of Vibetown',
            'astro_balls': 'Stellar Spheres',
            'astro_bean': 'AstroBean',
            'baller': 'Vibetown Baller',
            'billiards': "Rack Em' Up",
            'captain': 'Oh Captain My Captain',
            'checkmate': 'No Pawn Intended',
            'cosmic': 'Cosmic Guardian',
            'doge': 'Shiba Syndicate',
            'electric_rings': 'Atomic Aura',
            'elite_rainbow_ranger': 'Elite Rainbow Ranger',
            'full_send_maverick': 'Full Send Maverick',
            'full_throttle': 'Full Throttle',
            'funky_fresh': 'Funky Fresh',
            'fur_the_win': 'Fur The Win',
            'gamer': '360 No Scope',
            'gold_member': 'Golden Fever',
            'gradient_lover': 'Gradient Gatherer',
            'grayscale_seeker': 'Grailscale Hunter',
            'great_stacheby': 'Great \'Stacheby',
            'gud_meat': 'Gud Meat',
            'hail_mary_heroes': 'Hail Mary Heroes',
            'high_noon_hustler': 'High Noon Hustler',
            'homerun': 'Homerun',
            'hoodie_up_society': 'Hoodie Up Society',
            'king': 'Vibetown Royalty',
            'ladies_night': 'Ladies Night',
            'lamp': 'I Love Lamp',
            'necks_level': 'Necks Level',
            'no_face_no_problem': 'No Face, No Problem',
            'nounish_vibes': 'Nounish Vibes',
            'one_of_one': 'One of One',
            'party_in_the_back': 'Party In The Back',
            'pepe': 'Pepe Posse',
            'plants': 'Aloe You Vera Much',
            'plastic_lover': 'Plastic Pioneer',
            'poker_face': 'Pocket Rockets',
            'pothead': 'High Vibes',
            'rainbow_boombox': 'Bass In Your Face',
            'rainbow_bubble_goggles': 'Bubble Visionary',
            'rainbow_citizen': 'Rainbow Maxi',
            'rainbow_visor': 'Hue Got This',
            'ranger': 'Vibe Ranger',
            'robot_lover': 'Love at First Byte',
            'science_goggles': 'Atomic Aura',
            'seas_the_day': 'Seas The Day',
            'shower': 'Soaked N\' Stoked',
            'showtime': 'Showtime',
            'sir_vibes_a_lot': 'Sir Vibes-a-lot',
            'stone': 'Marble Potential',
            'straw_man': 'Straw Man',
            'suited_up': 'Suited Up',
            'super_rare': 'SuperRare',
            'surfer': 'Get Pitted',
            'sweettooth': 'Sugar Rush',
            'tanks_a_lot': 'Tanks A Lot',
            'toy_bricks': 'Brick By Brick',
            'varsity_vibes': 'Varsity Vibes',
            'vibefoot_fan_club': 'Vibetoot Fan Club',
            'vibetown_social_club': 'Vibetown Social Club',
            'visooor_enjoyooor': 'Visooor Enjoyooor',
            'zoom_in_vibe_out': 'Zoom In, Vibe Out',
            // Combo badges
            'gradient_hatrick': 'Gradient Hatrick',
            'plastic_hatrick': 'Plastic Hatrick',
            'robot_hatrick': 'Robot Hatrick',
            'gradient_high_five': 'Gradient High Five',
            'plastic_high_five': 'Plastic High Five',
            'robot_high_five': 'Robot High Five',
            'power_duo': 'Power Duo',
            'chris_favorite': "Chris' Favorite Badge",
            'multi_type_master': 'Multi-Type Master',
            'yin_n_yang': "Yin N' Yang",
            'mountain_goat': 'Mountain GOAT',
            // Special badges
            'vibe_bounty_hunter': 'VIBE Bounty Hunter'
        };
        
        // Badge colors for display
        const BADGE_COLORS = {
            // Rainbow/Special
            'rainbow_citizen': 'linear-gradient(90deg, #ff0000, #ff9900, #ffff00, #00ff00, #0099ff, #6633ff)',
            'rainbow_visor': 'linear-gradient(90deg, #ff0000, #ff9900, #ffff00, #00ff00, #0099ff, #6633ff)',
            'rainbow_bubble_goggles': 'linear-gradient(90deg, #ff0000, #ff9900, #ffff00, #00ff00, #0099ff, #6633ff)',
            'science_goggles': 'linear-gradient(90deg, #ff0000, #ff9900, #ffff00, #00ff00, #0099ff, #6633ff)',
            'elite_rainbow_ranger': 'linear-gradient(90deg, #ff0000, #ff9900, #ffff00, #00ff00, #0099ff, #6633ff)',
            'rainbow_boombox': 'linear-gradient(90deg, #ff0000, #ff9900, #ffff00, #00ff00, #0099ff, #6633ff)',
            // Gold/Yellow themed
            'gold_member': '#ffd700',
            'great_stacheby': '#ff9500',
            'doge': '#ffd700',
            'showtime': '#ffa500',
            // Grayscale
            'grayscale_seeker': '#888888',
            'chris_favorite': '#888888',
            // Special/Rare
            'one_of_one': '#ff00ff',
            'super_rare': '#ff4500',
            'cosmic': '#9933ff',
            // Type lovers
            'robot_lover': '#00ffff',
            'plastic_lover': '#ff69b4',
            'gradient_lover': 'linear-gradient(90deg, #ff6b6b, #4ecdc4)',
            // General
            'any_gvc': '#00d4ff',
            'ranger': '#228b22',
            'pothead': '#32cd32',
            'pepe': '#00aa00',
            'gamer': '#9400d3',
            'checkmate': '#b8860b',
            'poker_face': '#006400',
            'captain': '#4da6ff',
            'suited_up': '#9370db',
            'ladies_night': '#ff1493',
            'party_in_the_back': '#8b4513',
            'funky_fresh': '#ff6347',
            'homerun': '#dc143c',
            // New badges
            'astro_balls': '#9933ff',
            'astro_bean': '#00d4ff',
            'baller': '#ff9500',
            'billiards': '#228b22',
            'electric_rings': '#00ffff',
            'full_send_maverick': '#00d4ff',
            'full_throttle': '#ff4500',
            'fur_the_win': '#8b4513',
            'gud_meat': '#ff6347',
            'hail_mary_heroes': '#4da6ff',
            'high_noon_hustler': '#a855f7',
            'hoodie_up_society': '#00d4ff',
            'king': '#ffd700',
            'lamp': '#ffa500',
            'necks_level': '#a855f7',
            'no_face_no_problem': '#ffd700',
            'nounish_vibes': '#32cd32',
            'plants': '#32cd32',
            'seas_the_day': '#00d4ff',
            'shower': '#00d4ff',
            'sir_vibes_a_lot': '#a855f7',
            'stone': '#888888',
            'straw_man': '#ffa500',
            'surfer': '#00d4ff',
            'sweettooth': '#ff69b4',
            'tanks_a_lot': '#228b22',
            'toy_bricks': '#ff4500',
            'varsity_vibes': '#00d4ff',
            'vibefoot_fan_club': '#00d4ff',
            'vibetown_social_club': '#ff4500',
            'visooor_enjoyooor': '#00ffff',
            'zoom_in_vibe_out': '#00d4ff',
            // Collection badges (milestone badges)
            'collection_5': '#ff9500',
            'collection_10': '#c0c0c0',
            'collection_15': '#ffd700',
            'collection_20': '#a855f7',
            'collection_30': '#ff4500',
            'collection_40': '#ff69b4',
            'collection_50': '#00d4ff',
            // VIBESTR tier badges
            'vibestr_blue': '#87CEEB',
            'vibestr_pink': '#FF69B4',
            'vibestr_purple': '#9932CC',
            'vibestr_bronze': '#CD7F32',
            'vibestr_silver': '#C0C0C0',
            'vibestr_gold': '#FFD700',
            'vibestr_diamond': '#B9F2FF',
            'vibestr_cosmic': 'linear-gradient(90deg, #ff0000, #ff9900, #ffff00, #00ff00, #0099ff, #6633ff)',
            // Combo badges
            'gradient_hatrick': 'linear-gradient(90deg, #4ecdc4, #44a08d)',
            'plastic_hatrick': '#FF69B4',
            'robot_hatrick': '#00ffff',
            'gradient_high_five': 'linear-gradient(90deg, #4ecdc4, #44a08d)',
            'plastic_high_five': '#FF69B4',
            'robot_high_five': '#00ffff',
            'power_duo': '#ffd700',
            'multi_type_master': 'linear-gradient(90deg, #ff69b4, #4ecdc4, #00ffff)',
            'yin_n_yang': 'linear-gradient(90deg, #888888, #ff0000, #ff9900, #ffff00, #00ff00, #0099ff)',
            'mountain_goat': '#87CEEB',
            // Special badges
            'vibe_bounty_hunter': '#a855f7'
        };
        
        // Collection badge display names
        const COLLECTION_BADGE_NAMES = {
            'collection_5': 'Collector of Epic Vibes',
            'collection_10': 'Collector of Exquisite Vibes',
            'collection_15': 'Collector of Legendary Vibes',
            'collection_20': 'Collector of Immaculate Vibes',
            'collection_30': 'Collector of Pristine Vibes',
            'collection_40': 'Collector of Transcendent Vibes',
            'collection_50': 'Collector of Magnificent Vibes'
        };
        
        // OpenSea links for badges
        const BADGE_OPENSEA_LINKS = {
            'any_gvc': 'https://opensea.io/collection/good-vibes-club?status=all',
            'astro_balls': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Hair%22,%22values%22:[%22Astronaut+White%22]}]',
            'astro_bean': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Hair%22,%22values%22:[%22Astro+Bean+Pink%22]}]',
            'baller': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Body%22,%22values%22:[%22Tank+Top+Yellow+Baller%22]}]',
            'billiards': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Face%22,%22values%22:[%22Billiards+Glasses%22]}]',
            'captain': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Hair%22,%22values%22:[%22Captain+Hat%22]}]',
            'checkmate': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Face%22,%22values%22:[%22Checkmate+Glasses%22]}]',
            'cosmic': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Type%22,%22values%22:[%22Cosmic+Guardian%22]}]',
            'doge': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Body%22,%22values%22:[%22Hoodie+Up+Doge%22]}]',
            'electric_rings': 'https://opensea.io/collection/good-vibes-club?traits=[{%22traitType%22:%22Hair%22,%22values%22:[%22Blue+Electric+Rings%22]}]',
            'full_send_maverick': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Body%22,%22values%22:[%22Pilot+Jacket+Cosmic%22,%22Pilot+Jacket+Mint%22,%22Pilot+Jacket+Yellow%22,%22Pilot+Jacket+Light+Blue%22,%22Pilot+Jacket+Lime%22,%22Pilot+Jacket+Red%22,%22Pilot+Jacket+Pink%22,%22Pilot+Jacket+Purple%22,%22Pilot+Jacket+Black%22]}]',
            'full_throttle': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Hair%22,%22values%22:[%22Moto+Helmet+Visor+Down+Black+Clear%22,%22Moto+Helmet+Visor+Up+Black+Clear%22,%22Moto+Helmet+Visor+Down+Rainbow%22,%22Moto+Helmet+Visor+Up+Cosmic%22,%22Moto+Helmet+Visor+Down+Pink%22,%22Moto+Helmet+Visor+Down+Blue%22,%22Moto+Helmet+Visor+Up+Pink%22,%22Moto+Helmet+Visor+Up+Gold%22,%22Moto+Helmet+Visor+Down+White%22,%22Moto+Helmet+Visor+Up+White%22,%22Moto+Helmet+Visor+Up+Rainbow%22]}]',
            'funky_fresh': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Hair%22,%22values%22:[%22Headphones+Cosmic%22,%22Headphones+Glass%22,%22Yellow+Headband+White+Headphones%22,%22Blue+Headband+White+Headphones%22,%22Mint+Headband+White+Headphones%22,%22Gold+Headband+Gold+Headphones%22,%22Purple+Headband+White+Headphones%22,%22Pink+Headband+White+Headphones%22,%22Red+Headband+White+Headphones%22,%22Black+Headband+Black+Headphones%22,%22White+Headband+White+Headphones%22,%22Rainbow+Headband+White+Headphones%22]}]',
            'fur_the_win': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Body%22,%22values%22:[%22Fur+Jacket+Mint%22,%22Fur+Jacket+Pink%22,%22Fur+Jacket+Blue%22,%22Fur+Jacket+Red%22,%22Fur+Jacket+Gold%22]}]',
            'gamer': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Face%22,%22values%22:[%22Pro+Gamer+Glasses%22]}]',
            'gold_member': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Type%22,%22values%22:[%22Gold%22]}]',
            'gradient_lover': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Type%22,%22values%22:[%22Gradient+Magenta+Purple+Blue%22,%22Gradient+Pink+Magenta+Red%22,%22Gradient+Yellow+Orange%22,%22Gradient+Dark+Blue+Light+Blue%22,%22Gradient+Cyan+Blue+Purple%22,%22Gradient+Lime+Yellow%22,%22Gradient+Blue+Purple+Pink%22,%22Gradient+Yellow+Yellow%22,%22Gradient+Pink+Pink%22,%22Gradient+Red+Purple%22,%22Gradient+Lime+Seafoam%22]}]',
            'grayscale_seeker': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Type%22,%22values%22:[%22Grayscale%22]}]',
            'great_stacheby': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Face%22,%22values%22:[%2280s+Glasses+Stache%22,%22Stache+Black%22,%22Beard+Sweettooth%22,%22Beard+Blue%22,%22Beard+Pink%22,%22Beard+Red%22,%22Beard+Black%22]}]',
            'gud_meat': 'https://opensea.io/collection/good-vibes-club?traits=[{%22traitType%22:%22Body%22,%22values%22:[%22Leather%20Jacket%20Cream%22]}]',
            'hail_mary_heroes': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Hair%22,%22values%22:[%22Football+Helmet+Cosmic%22,%22Football+Helmet+Yellow%22,%22Football+Helmet+Blue%22,%22Football+Helmet+Red%22,%22Football+Helmet+Mint%22,%22Football+Helmet+Gold%22,%22Football+Helmet+Purple%22,%22Football+Helmet+Pink%22,%22Football+Helmet+White%22,%22Football+Helmet+Black%22]}]',
            'high_noon_hustler': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Hair%22,%22values%22:[%22Wide+Brim+Hat+Lime%22,%22Wide+Brim+Hat+Yellow%22,%22Wide+Brim+Hat+Light+Blue%22,%22Wide+Brim+Hat+Gold%22,%22Wide+Brim+Hat+Mint%22,%22Wide+Brim+Hat+Dark+Blue%22,%22Wide+Brim+Hat+Pink%22,%22Wide+Brim+Hat+Purple%22,%22Wide+Brim+Hat+Red%22,%22Wide+Brim+Hat+Glass%22,%22Wide+Brim+Hat+Black%22,%22Wide+Brim+Hat+White%22,%22Wide+Brim+Hat+Cosmic%22,%22Dundee+Hat+Yellow%22,%22Dundee+Hat+Light+Blue%22,%22Dundee+Hat+Purple%22,%22Dundee+Hat+Lime%22,%22Dundee+Hat+Dark+Blue%22,%22Dundee+Hat+Mint%22,%22Dundee+Hat+Pink%22,%22Dundee+Hat+Gold%22,%22Dundee+Hat+Red%22,%22Dundee+Hat+Cosmic%22,%22Dundee+Hat+Black%22,%22Dundee+Hat+White%22]}]',
            'homerun': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Hair%22,%22values%22:[%22Ballcap+Forward+Cosmic%22,%22Ballcap+Forward+Pink%22,%22Ballcap+Forward+Lime%22,%22Ballcap+Forward+Light+Blue%22,%22Ballcap+Forward+Dark+Blue%22,%22Ballcap+Forward+Yellow%22,%22Ballcap+Forward+Gold%22,%22Ballcap+Forward+Red%22,%22Ballcap+Forward+Mint%22,%22Ballcap+Forward+Purple%22,%22Ballcap+Forward+Black+SuperRare%22,%22Ballcap+Forward+White%22,%22Backwards+Hat+Cosmic%22,%22Backwards+Hat+Lime+Black%22,%22Backwards+Hat+Light+Blue+Denim+White%22,%22Backwards+Hat+Pink+White%22,%22Backwards+Hat+Yellow+White%22,%22Backwards+Hat+Blue+White%22,%22Backwards+Hat+Blue+Denim+Black%22,%22Backwards+Hat+Mint+White%22,%22Backwards+Hat+Red+White%22,%22Backwards+Hat+Black+Gray%22,%22Backwards+Hat+Pink+Denim%22,%22Backwards+Hat+Gold+Black%22,%22Backwards+Hat+Purple+Denim%22,%22Backwards+Hat+White+White%22]}]',
            'hoodie_up_society': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Body%22,%22values%22:[%22Hoodie+Up+Blue%22,%22Hoodie+Up+Yellow%22,%22Hoodie+Up+Mint%22,%22Hoodie+Up+Purple%22,%22Hoodie+Up+Pink%22,%22Hoodie+Up+Black%22,%22Hoodie+Up+Red%22,%22Hoodie+Up+White%22,%22Hoodie+Up+Gold%22]}]',
            'king': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Hair%22,%22values%22:[%22Royal+Crown+Gold%22]}]',
            'ladies_night': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Hair%22,%22values%22:[%22Female+Ponytail+Shiny+Blue%22,%22Female+Ponytail+Shiny+Mint%22,%22Female+Bob+Cut+Cosmic%22,%22Female+Bun+Shiny+Lime%22,%22Female+Bob+Cut+Shiny+Mint%22,%22Female+Bun+Cosmic%22,%22Female+Ponytail+Lime%22,%22Female+Bob+Cut+Shiny+Red%22,%22Female+Bob+Cut+Shiny+Lime%22,%22Female+Ponytail+Shiny+Pink%22,%22Female+Ponytail+Blue%22,%22Female+Ponytail+Cosmic%22,%22Female+Ponytail+Shiny+Yellow%22,%22Female+Ponytail+Pink%22,%22Female+Bob+Cut+Shiny+Yellow%22,%22Female+Bun+Pink%22,%22Female+Bun+Blue%22,%22Female+Bun+Lime%22,%22Female+Bob+Cut+Shiny+Purple%22,%22Female+Ponytail+Yellow%22,%22Female+Bun+Shiny+Yellow%22,%22Female+Ponytail+Shiny+Purple%22,%22Female+Ponytail+Shiny+Red%22,%22Female+Ponytail+Rainbow%22,%22Female+Bun+Shiny+Mint%22,%22Female+Bob+Cut+Shiny+Pink%22,%22Female+Ponytail+Red%22,%22Female+Bun+Yellow%22,%22Female+Ponytail+Purple%22,%22Female+Bun+Red%22,%22Female+Bun+Shiny+Pink%22,%22Female+Bun+Shiny+Red%22,%22Female+Bun+Mint%22,%22Female+Bun+Shiny+Purple%22,%22Female+Bob+Cut+Shiny+Black%22,%22Female+Ponytail+Mint%22,%22Female+Bun+Gold%22,%22Female+Bun+Chrome%22,%22Female+Bun+Rainbow%22,%22Female+Ponytail+Chrome%22,%22Female+Bun+Shiny+Black%22,%22Female+Bob+Cut+Chrome%22,%22Female+Bob+Cut+Gold%22,%22Female+Bun+Purple%22,%22Female+Ponytail+Gold%22,%22Female+Ponytail+Shiny+Black%22,%22Female+Bun+Black%22,%22Female+Ponytail+Black%22,%22Female+Bob+Cut+Glass%22]}]',
            'lamp': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Hair%22,%22values%22:[%22Lamp+Red%22]}]',
            'necks_level': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Body%22,%22values%22:[%22Turtleneck+Cosmic%22,%22Turtleneck+Yellow+Chrome%22,%22Turtleneck+Blue+Chrome%22,%22Turtleneck+Lime+Chrome%22,%22Turtleneck+Purple+Chrome%22,%22Turtleneck+Mint+Chrome%22,%22Turtleneck+Gold%22,%22Turtleneck+Red+Gold%22,%22Turtleneck+Pink+Chrome%22,%22Turtleneck+Black+Chrome%22,%22Turtleneck+White+Chrome%22]}]',
            'no_face_no_problem': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Face%22,%22values%22:[%22Glass+Hexagon%22,%22No+Face%22,%22Gold+Vibe+Hand%22]}]',
            'nounish_vibes': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Face%22,%22values%22:[%22Nouns+Glasses+Pink%22,%22Nouns+Glasses+Red%22,%22Nouns+Glasses+Mint%22]}]',
            'one_of_one': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Type%22,%22values%22:[%22Vibefoot%22,%22Flower+Power%22,%22Chill+Vibes+Guy%22,%22Super+Vibe%22,%22XRay%22,%22Glass+Jelly%22,%22The+Champion+Of+Vibes%22,%22Bad+Vibes+Guy%22,%22Holo+Leader%22]}]',
            'party_in_the_back': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Hair%22,%22values%22:[%22Mullet+Cosmic%22,%22Mullet+Shiny+Yellow%22,%22Mullet+Shiny+Lime%22,%22Mullet+Rainbow%22,%22Mullet+Shiny+Blue%22,%22Mullet+Lime%22,%22Mullet+Shiny+Pink%22,%22Mullet+Shiny+Purple%22,%22Mullet+Blue%22,%22Mullet+Yellow%22,%22Mullet+Shiny+Mint%22,%22Mullet+Mint%22,%22Mullet+Shiny+Red%22,%22Mullet+Pink%22,%22Mullet+Purple%22,%22Mullet+Red%22,%22Mullet+Chrome%22,%22Mullet+Gold%22,%22Mullet+Glass%22,%22Mullet+Shiny+Black%22,%22Mullet+Black%22]}]',
            'pepe': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Body%22,%22values%22:[%22Hoodie+Up+Pepe%22]}]',
            'plants': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Body%22,%22values%22:[%22Overalls+Pink+Farmer+Plants%22,%22Overalls+Mint+Farmer+Plants%22]}]',
            'plastic_lover': 'https://opensea.io/collection/good-vibes-club?traits=[{%22traitType%22:%22Type%22,%22values%22:[%22Plastic+Blue%22,%22Plastic+Yellow%22,%22Plastic+Purple%22,%22Plastic+Pink%22,%22Plastic+Red%22,%22Plastic+Mint%22]}]',
            'poker_face': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Face%22,%22values%22:[%22Poker+Face%22]}]',
            'pothead': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Hair%22,%22values%22:[%22Pothead%22]}]',
            'rainbow_boombox': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Face%22,%22values%22:[%22Rainbow+Boombox%22]}]',
            'rainbow_bubble_goggles': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Face%22,%22values%22:[%22Bubble+Goggles%22]}]',
            'rainbow_citizen': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Type%22,%22values%22:[%22Rainbow%22]}]',
            'rainbow_visor': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Face%22,%22values%22:[%22Rainbow+Visor%22]}]',
            'robot_lover': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Type%22,%22values%22:[%22Robot+Lilac%22,%22Robot+Red+Candy+Apple%22,%22Robot+Ice%22,%22Robot+Cobalt%22,%22Robot+Pink%22]}]',
            'science_goggles': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Face%22,%22values%22:[%22Science+Goggles%22]}]',
            'seas_the_day': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Face%22,%22values%22:[%22Eyepatch%22]}]',
            'shower': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Body%22,%22values%22:[%22Shower%22]}]',
            'stone': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Type%22,%22values%22:[%22Unfinished+Stone+Sculpture%22]}]',
            'straw_man': 'https://opensea.io/collection/good-vibes-club?traits=[{%22traitType%22:%22Hair%22,%22values%22:[%22Straw+Hat+Cream%22]}]',
            'suited_up': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Body%22,%22values%22:[%22Suit+Cosmic%22,%22Suit+Cream+Red%22,%22Suit+Lime%22,%22Suit+Yellow%22,%22Suit+Light+Blue%22,%22Suit+Gold%22,%22Suit+Dark+Blue%22,%22Suit+Purple%22,%22Suit+Rainbow%22,%22Suit+Pink%22,%22Suit+Glass%22,%22Suit+Mint%22,%22Suit+Red%22,%22Suit+Black%22,%22Suit+Light+Grey%22,%22Suit+White%22,%22Electro+Hero+Suit%22]}]',
            'surfer': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Body%22,%22values%22:[%22Surfer+Purple%22,%22Surfer+Red%22]}]',
            'sweettooth': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Face%22,%22values%22:[%22Beard+Sweettooth%22]}]',
            'toy_bricks': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Face%22,%22values%22:[%22Toy+Bricks%22]}]',
            'vibefoot_fan_club': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Body%22,%22values%22:[%22TShirt+Vibefoot+Fan+Club%22]}]',
            'vibetown_social_club': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Body%22,%22values%22:[%22Retro+Windbreaker+Pink%22,%22Hooded+Jacket+Pink%22,%22Hoodie+White%22,%22Overalls+Shirt+Pink+Purple%22]}]',
            'visooor_enjoyooor': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Face%22,%22values%22:[%22Rainbow+Visor%22,%22Laser+Visor%22,%22Robo+Visor+Dots+Full%22,%22Robo+Visor+GVC%22,%22Robo+Visor+Dot+Eyes%22]}]',
            'showtime': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Body%22,%22values%22:[%22Gold+Chains+Tattoos%22,%22Hoodie+Up+Gold%22,%22Plastic+Armor+Gold%22,%22Overalls+Gold%22,%22Puffy+Vest+Gold%22,%22Leather+Jacket+Gold%22,%22Fur+Jacket+Gold%22,%22Driving+Jacket+Gold%22,%22Hoodie+Gold%22,%22Suit+Gold%22,%22Puffy+Jacket+Gold%22,%22Turtleneck+Gold%22,%22Retro+Windbreaker+Gold%22,%22Tank+Top+Gold%22,%22Hooded+Jacket+Gold%22,%22Turtleneck+Red+Gold%22,%22Letterman+Jacket+Gold+Chrome%22]}]',
            'sir_vibes_a_lot': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Hair%22,%22values%22:[%22Knight+Helm+Red%22,%22Knight+Helm+White%22,%22Knight+Helm+Black%22]}]',
            'tanks_a_lot': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Face%22,%22values%22:[%22Diver+Mask+Black+Chrome%22]}]',
            'varsity_vibes': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Body%22,%22values%22:[%22Letterman+Jacket+Light+Blue%22,%22Letterman+Jacket+Gold+Chrome%22,%22Letterman+Jacket+Dark+Blue%22,%22Letterman+Jacket+Cosmic%22,%22Letterman+Jacket+Lime%22,%22Letterman+Jacket+Yellow%22,%22Letterman+Jacket+Glass%22,%22Letterman+Jacket+Mint%22,%22Letterman+Jacket+Pink%22,%22Letterman+Jacket+Purple%22,%22Letterman+Jacket+Red%22,%22Letterman+Jacket+Black%22]}]',
            'zoom_in_vibe_out': 'https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Face%22,%22values%22:[%22Monocle%22]}]'
        };
        
        function getBadgeOpenSeaLink(badge) {
            return BADGE_OPENSEA_LINKS[badge] || null;
        }
        
        function getBadgeColor(badge) {
            return BADGE_COLORS[badge] || '#00d4ff';
        }
        
        function formatBadgeName(badge) {
            // Check display name mapping first
            if (BADGE_DISPLAY_NAMES[badge]) {
                return BADGE_DISPLAY_NAMES[badge];
            }
            // Collection badges
            if (badge.startsWith('collection_')) {
                return COLLECTION_BADGE_NAMES[badge] || `${badge.replace('collection_', '')} Badges`;
            }
            // VIBESTR badges
            if (badge.startsWith('vibestr_')) {
                const tier = badge.replace('vibestr_', '');
                return `$VIBESTR ${tier.charAt(0).toUpperCase() + tier.slice(1)} Tier`;
            }
            // Fallback: format from snake_case
            return badge.split('_').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
        }
        
        // Load badge data from GVC API
        async function loadBadgeData() {
            try {
                const response = await fetch('https://www.goodvibesclub.io/assets/badge_token_map.json');
                const data = await response.json();
                
                console.log('Raw badge data:', data);
                
                // Badge data is in badgeToTokens property
                if (data.badgeToTokens) {
                    badgeData = data.badgeToTokens;
                } else {
                    badgeData = data;
                }
                
                // Also store tokenToBadges for faster lookup
                if (data.tokenToBadges) {
                    window.tokenToBadges = data.tokenToBadges;
                }
                
                console.log(`Loaded ${Object.keys(badgeData).length} badge types`);
            } catch (error) {
                console.error('Failed to load badge data:', error);
            }
        }
        
        // Load image URLs
        async function loadImageData() {
            try {
                const response = await fetch('gvc-images.json');
                imageData = await response.json();
                console.log(`Loaded ${Object.keys(imageData).length} image URLs`);
            } catch (error) {
                console.error('Failed to load image data:', error);
            }
        }
        
        // Load NFT type data for combo badge calculations
        let typeData = {};
        async function loadTypeData() {
            try {
                const response = await fetch('gvc-types.json');
                typeData = await response.json();
                console.log(`Loaded ${Object.keys(typeData).length} NFT types`);
            } catch (error) {
                console.error('Failed to load type data:', error);
            }
        }
        
        // Load special traits data for Mountain GOAT badge
        let specialTraitsData = {};
        async function loadSpecialTraitsData() {
            try {
                const response = await fetch('gvc-special-traits.json');
                specialTraitsData = await response.json();
                console.log(`Loaded special traits for ${Object.keys(specialTraitsData).length} NFTs`);
            } catch (error) {
                console.error('Failed to load special traits data:', error);
            }
        }
        
        // Initialize on page load
        loadBadgeData().then(function() {
            initBadgeExplorer();
        });
        loadImageData();
        loadTypeData();
        loadSpecialTraitsData();
        
        // Load last wallet from localStorage
        window.addEventListener('DOMContentLoaded', function() {
            const lastWallet = localStorage.getItem('gvc_last_wallet');
            if (lastWallet) {
                document.getElementById('walletInput').value = lastWallet;
            }
        });
        
        // Store resolved addresses for VIBESTR lookup
        let resolvedAddresses = [];
        
        async function lookupWallet() {
            const input = document.getElementById('walletInput').value.trim();
            if (!input) return;
            
            // Save to localStorage
            localStorage.setItem('gvc_last_wallet', input);
            
            const results = document.getElementById('results');
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const content = document.getElementById('resultsContent');
            
            results.classList.add('active');
            loading.style.display = 'block';
            error.style.display = 'none';
            content.style.display = 'none';
            
            // Reset resolved addresses and bounty hunter state
            resolvedAddresses = [];
            vibeBountyHunterCount = 0;
            
            try {
                let tokenIds = [];
                let vibestrBalance = 0;
                
                // Check if input is purely token IDs (only numbers, commas, spaces)
                if (/^[\d,\s]+$/.test(input)) {
                    tokenIds = input.split(',').map(id => id.trim()).filter(id => id);
                } else {
                    // Parse input for multiple wallets/ENS names
                    const inputs = input.split(/[,\n]+/)
                        .map(s => s.trim())
                        .filter(s => s.length > 0);
                    
                    console.log('Looking up ' + inputs.length + ' wallet(s):', inputs);
                    
                    // Fetch NFTs from all wallets in parallel
                    const allResults = await Promise.all(
                        inputs.map(async (walletInput) => {
                            try {
                                return await fetchWalletNFTs(walletInput);
                            } catch (e) {
                                console.error('Failed to fetch for ' + walletInput + ':', e);
                                return [];
                            }
                        })
                    );
                    
                    // Combine all token IDs (use Set to avoid duplicates if same NFT appears)
                    const combinedSet = new Set();
                    allResults.forEach(ids => {
                        ids.forEach(id => combinedSet.add(id.toString()));
                    });
                    tokenIds = Array.from(combinedSet);
                    
                    console.log('Combined total: ' + tokenIds.length + ' unique NFTs from ' + inputs.length + ' wallet(s)');
                    
                    // Fetch VIBESTR balance for all resolved addresses
                    if (resolvedAddresses.length > 0) {
                        vibestrBalance = await fetchVibestrBalance(resolvedAddresses);
                        console.log('Total VIBESTR balance: ' + vibestrBalance);
                    }
                }
                
                if (tokenIds.length === 0) {
                    throw new Error('No NFTs found');
                }
                
                processResults(tokenIds, vibestrBalance);
                loading.style.display = 'none';
                content.style.display = 'block';
                
                // Update floating NFTs with wallet's NFTs
                updateFloatingNFTs(tokenIds);
                
            } catch (err) {
                console.error(err);
                loading.style.display = 'none';
                error.style.display = 'block';
            }
        }
        
        async function fetchWalletNFTs(addressOrENS) {
            let address = addressOrENS;
            
            // Resolve ENS if needed
            if (addressOrENS.includes('.')) {
                try {
                    const ensResponse = await fetch(`https://api.ensideas.com/ens/resolve/${addressOrENS}`);
                    const ensData = await ensResponse.json();
                    if (ensData.address) {
                        address = ensData.address;
                    }
                } catch (e) {
                    console.log('ENS resolution failed, trying as address');
                }
            }
            
            // Store resolved address for VIBESTR lookup
            if (address.startsWith('0x')) {
                resolvedAddresses.push(address);
            }
            
            // Try Reservoir API first
            const CONTRACT = '0xb8ea78fcacef50d41375e44e6814ebba36bb33c4';
            
            try {
                const reservoirUrl = `https://api.reservoir.tools/users/${address}/tokens/v7?collection=${CONTRACT}&limit=200`;
                console.log('Trying Reservoir:', reservoirUrl);
                const response = await fetch(reservoirUrl);
                const data = await response.json();
                
                if (data.tokens && data.tokens.length > 0) {
                    const tokens = data.tokens.map(t => t.token.tokenId);
                    console.log(`Found ${tokens.length} NFTs via Reservoir`);
                    return tokens;
                }
            } catch (e) {
                console.log('Reservoir failed:', e);
            }
            
            // Fallback to Alchemy
            try {
                const alchemyUrl = `https://eth-mainnet.g.alchemy.com/nft/v3/demo/getNFTsForOwner?owner=${address}&contractAddresses[]=${CONTRACT}&withMetadata=false`;
                console.log('Trying Alchemy:', alchemyUrl);
                const response = await fetch(alchemyUrl);
                const data = await response.json();
                
                if (data.ownedNfts && data.ownedNfts.length > 0) {
                    const tokens = data.ownedNfts.map(nft => nft.tokenId);
                    console.log(`Found ${tokens.length} NFTs via Alchemy`);
                    return tokens;
                }
            } catch (e) {
                console.log('Alchemy failed:', e);
            }
            
            return [];
        }
        
        // Fetch VIBESTR token balance
        async function fetchVibestrBalance(addresses) {
            const VIBESTR_CONTRACT = '0xd0cc2b0efb168bfe1f94a948d8df70fa10257196';
            let totalBalance = 0;
            
            for (const address of addresses) {
                try {
                    // Use public RPC with eth_call (most reliable, no API key needed)
                    const balanceOfSelector = '0x70a08231';
                    const paddedAddress = address.toLowerCase().replace('0x', '').padStart(64, '0');
                    const callData = balanceOfSelector + paddedAddress;
                    
                    // Try multiple public RPCs
                    const rpcUrls = [
                        'https://rpc.ankr.com/eth',
                        'https://eth.llamarpc.com',
                        'https://1rpc.io/eth',
                        'https://ethereum.publicnode.com'
                    ];
                    
                    let success = false;
                    for (const rpcUrl of rpcUrls) {
                        if (success) break;
                        try {
                            console.log(`Trying RPC: ${rpcUrl}`);
                            const response = await fetch(rpcUrl, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    jsonrpc: '2.0',
                                    method: 'eth_call',
                                    params: [{ to: VIBESTR_CONTRACT, data: callData }, 'latest'],
                                    id: 1
                                })
                            });
                            const data = await response.json();
                            
                            if (data.result && data.result !== '0x' && data.result !== '0x0') {
                                const balance = parseInt(data.result, 16) / 1e18;
                                totalBalance += balance;
                                console.log(`VIBESTR balance for ${address}: ${balance.toLocaleString()}`);
                                success = true;
                            }
                        } catch (e) {
                            console.log(`RPC ${rpcUrl} failed:`, e.message);
                        }
                    }
                    
                    if (!success) {
                        console.log(`Could not fetch VIBESTR balance for ${address} from any RPC`);
                    }
                } catch (e) {
                    console.log('VIBESTR balance fetch failed:', e);
                }
            }
            
            return totalBalance;
        }
        
        // Meta badges configuration
        const COLLECTION_BADGE_THRESHOLDS = [5, 10, 15, 20, 30, 40, 50];
        const VIBESTR_TIERS = [
            { name: 'vibestr_blue', threshold: 69000, color: '#87CEEB' },
            { name: 'vibestr_pink', threshold: 250000, color: '#FF69B4' },
            { name: 'vibestr_purple', threshold: 500000, color: '#9932CC' },
            { name: 'vibestr_bronze', threshold: 1000000, color: '#CD7F32' },
            { name: 'vibestr_silver', threshold: 2500000, color: '#C0C0C0' },
            { name: 'vibestr_gold', threshold: 4200000, color: '#FFD700' },
            { name: 'vibestr_diamond', threshold: 6900000, color: '#B9F2FF' },
            { name: 'vibestr_cosmic', threshold: 10000000, color: 'linear-gradient(90deg, #ff0000, #ff9900, #ffff00, #00ff00, #0099ff, #6633ff)' }
        ];
        
        // Type colors for High Five badges - the 5 (or 6) colors needed for each type
        const TYPE_COLORS = {
            'Gradient': ['Gradient Yellow Orange', 'Gradient Yellow Yellow', 'Gradient Pink Pink', 'Gradient Pink Magenta Red', 'Gradient Magenta Purple Blue', 'Gradient Cyan Blue Purple', 'Gradient Dark Blue Light Blue', 'Gradient Blue Purple Pink', 'Gradient Lime Yellow', 'Gradient Lime Seafoam', 'Gradient Red Purple'],
            'Plastic': ['Plastic Pink', 'Plastic Mint', 'Plastic Red', 'Plastic Yellow', 'Plastic Blue', 'Plastic Purple'],
            'Robot': ['Robot Red Candy Apple', 'Robot Lilac', 'Robot Ice', 'Robot Cobalt', 'Robot Pink']
        };
        
        // OpenSea search URLs for each type color
        const OPENSEA_SEARCH_BASE = 'https://opensea.io/collection/good-vibes-club?traits=';
        
        function getOpenSeaLink(typeColor) {
            const traitParam = JSON.stringify([{"traitType": "Type", "values": [typeColor]}]);
            return OPENSEA_SEARCH_BASE + encodeURIComponent(traitParam);
        }
        
        // Get missing colors for a type prefix
        function getMissingColors(ownedTypes, typePrefix) {
            const allColors = TYPE_COLORS[typePrefix] || [];
            const ownedColors = [...new Set(ownedTypes.filter(t => t && t.startsWith(typePrefix)))];
            return allColors.filter(color => !ownedColors.includes(color));
        }
        
        // Combo badges - based on owning NFTs with specific type combinations
        const COMBO_BADGES = [
            { 
                name: 'gradient_hatrick', 
                requirement: '3 different Gradient colors', 
                check: (types) => countUniqueByPrefix(types, 'Gradient') >= 3,
                progress: (types, tokenIds) => ({ current: countUniqueByPrefix(types, 'Gradient'), needed: 3 })
            },
            { 
                name: 'plastic_hatrick', 
                requirement: '3 different Plastic colors', 
                check: (types) => countUniqueByPrefix(types, 'Plastic') >= 3,
                progress: (types, tokenIds) => ({ current: countUniqueByPrefix(types, 'Plastic'), needed: 3 })
            },
            { 
                name: 'robot_hatrick', 
                requirement: '3 different Robot colors', 
                check: (types) => countUniqueByPrefix(types, 'Robot') >= 3,
                progress: (types, tokenIds) => ({ current: countUniqueByPrefix(types, 'Robot'), needed: 3 })
            },
            { 
                name: 'gradient_high_five', 
                requirement: '5 different Gradient colors', 
                check: (types) => countUniqueByPrefix(types, 'Gradient') >= 5,
                progress: (types, tokenIds) => ({ current: countUniqueByPrefix(types, 'Gradient'), needed: 5 })
            },
            { 
                name: 'plastic_high_five', 
                requirement: '5 different Plastic colors', 
                check: (types) => countUniqueByPrefix(types, 'Plastic') >= 5,
                progress: (types, tokenIds) => ({ current: countUniqueByPrefix(types, 'Plastic'), needed: 5 })
            },
            { 
                name: 'robot_high_five', 
                requirement: '5 different Robot colors', 
                check: (types) => countUniqueByPrefix(types, 'Robot') >= 5,
                progress: (types, tokenIds) => ({ current: countUniqueByPrefix(types, 'Robot'), needed: 5 })
            },
            { 
                name: 'power_duo', 
                requirement: '2 GVCs of same type & color', 
                check: (types) => hasDuplicateType(types),
                progress: (types, tokenIds) => ({ current: getMaxDuplicateCount(types), needed: 2 })
            },
            { 
                name: 'chris_favorite', 
                requirement: '2 Grayscale GVCs', 
                check: (types) => countByType(types, 'Grayscale') >= 2,
                progress: (types, tokenIds) => ({ current: countByType(types, 'Grayscale'), needed: 2 })
            },
            { 
                name: 'multi_type_master', 
                requirement: '1 Plastic + 1 Gradient + 1 Robot', 
                check: (types) => hasAllThreeTypes(types),
                progress: (types, tokenIds) => {
                    let count = 0;
                    if (types.some(t => t && t.startsWith('Plastic'))) count++;
                    if (types.some(t => t && t.startsWith('Gradient'))) count++;
                    if (types.some(t => t && t.startsWith('Robot'))) count++;
                    return { current: count, needed: 3 };
                }
            },
            { 
                name: 'yin_n_yang', 
                requirement: 'Own Grayscale + Rainbow', 
                check: (types) => hasGrayscaleAndRainbow(types),
                progress: (types, tokenIds) => {
                    let count = 0;
                    if (types.some(t => t === 'Grayscale')) count++;
                    if (types.some(t => t === 'Rainbow')) count++;
                    return { current: count, needed: 2 };
                }
            },
            { 
                name: 'mountain_goat', 
                requirement: '2 NFTs with Snowboard Goggles or Puffy Jacket', 
                check: (types, tokenIds) => hasMountainGoatTraits(tokenIds),
                progress: (types, tokenIds) => ({ current: countMountainGoatTraits(tokenIds), needed: 2 })
            },
            { 
                name: 'elite_rainbow_ranger', 
                requirement: 'Rainbow Type + Plastic Armor/Helmet', 
                check: (types, tokenIds) => hasRainbowWarrior(types, tokenIds),
                progress: (types, tokenIds) => getRainbowWarriorProgress(types, tokenIds)
            }
        ];
        
        // Helper functions for combo badge checks
        function countUniqueByPrefix(types, prefix) {
            const unique = new Set(types.filter(t => t && t.startsWith(prefix)));
            return unique.size;
        }
        
        function countByType(types, exactType) {
            return types.filter(t => t === exactType).length;
        }
        
        function hasDuplicateType(types) {
            const counts = {};
            for (const t of types) {
                if (t) {
                    counts[t] = (counts[t] || 0) + 1;
                    if (counts[t] >= 2) return true;
                }
            }
            return false;
        }
        
        function getMaxDuplicateCount(types) {
            const counts = {};
            let max = 0;
            for (const t of types) {
                if (t) {
                    counts[t] = (counts[t] || 0) + 1;
                    max = Math.max(max, counts[t]);
                }
            }
            return Math.min(max, 2); // Cap at 2 since that's the goal
        }
        
        function hasAllThreeTypes(types) {
            const hasPlastic = types.some(t => t && t.startsWith('Plastic'));
            const hasGradient = types.some(t => t && t.startsWith('Gradient'));
            const hasRobot = types.some(t => t && t.startsWith('Robot'));
            return hasPlastic && hasGradient && hasRobot;
        }
        
        function hasGrayscaleAndRainbow(types) {
            const hasGrayscale = types.some(t => t === 'Grayscale');
            const hasRainbow = types.some(t => t === 'Rainbow');
            return hasGrayscale && hasRainbow;
        }
        
        function hasMountainGoatTraits(tokenIds) {
            return countMountainGoatTraits(tokenIds) >= 2;
        }
        
        function countMountainGoatTraits(tokenIds) {
            let count = 0;
            for (const tokenId of tokenIds) {
                const traits = specialTraitsData[tokenId] || specialTraitsData[String(tokenId)];
                if (traits && traits.length > 0) {
                    count++;
                }
            }
            return Math.min(count, 2); // Cap at 2 since that's the goal
        }
        
        // Rainbow Warrior badge - needs Rainbow Type + Plastic Armor/Helmet
        const PLASTIC_ARMOR_HELMET_IDS = new Set(["1", "113", "122", "138", "181", "270", "281", "282", "284", "303", "307", "394", "396", "427", "556", "572", "593", "614", "626", "644", "668", "688", "703", "716", "784", "817", "822", "931", "952", "959", "968", "993", "1000", "1023", "1037", "1052", "1073", "1075", "1078", "1171", "1217", "1239", "1240", "1261", "1267", "1311", "1315", "1319", "1426", "1436", "1466", "1481", "1528", "1536", "1547", "1582", "1594", "1624", "1652", "1653", "1657", "1740", "1746", "1755", "1787", "1815", "1818", "1820", "1861", "1879", "1908", "1909", "1926", "2021", "2060", "2077", "2140", "2196", "2229", "2270", "2281", "2318", "2345", "2358", "2366", "2422", "2423", "2465", "2470", "2490", "2509", "2579", "2604", "2698", "2724", "2732", "2763", "2810", "2828", "2837", "2853", "2905", "2965", "2991", "3025", "3175", "3189", "3206", "3276", "3284", "3329", "3333", "3334", "3371", "3392", "3471", "3526", "3548", "3574", "3616", "3635", "3656", "3669", "3695", "3760", "3804", "3823", "3849", "3872", "3875", "3884", "3906", "3947", "3988", "4000", "4001", "4062", "4104", "4135", "4179", "4180", "4216", "4246", "4248", "4302", "4332", "4432", "4508", "4570", "4585", "4589", "4600", "4655", "4667", "4684", "4701", "4724", "4799", "4824", "4877", "4884", "4900", "4911", "4930", "4938", "4974", "4977", "4984", "5033", "5041", "5084", "5091", "5104", "5143", "5147", "5158", "5163", "5211", "5229", "5236", "5332", "5346", "5372", "5403", "5438", "5482", "5515", "5527", "5528", "5531", "5576", "5578", "5596", "5667", "5697", "5739", "5745", "5759", "5784", "5806", "5866", "5884", "5976", "5979", "5999", "6030", "6164", "6186", "6189", "6222", "6226", "6240", "6326", "6361", "6371", "6383", "6389", "6394", "6414", "6441", "6472", "6511", "6557", "6578", "6636", "6653", "6656", "6691", "6703", "6712", "6753", "6760", "6772", "6777", "6779", "6814", "6921", "6925", "6946"]);
        
        function hasRainbowWarrior(types, tokenIds) {
            const hasRainbow = types.some(t => t === 'Rainbow');
            const hasPlasticArmorHelmet = tokenIds.some(id => PLASTIC_ARMOR_HELMET_IDS.has(String(id)));
            return hasRainbow && hasPlasticArmorHelmet;
        }
        
        function getRainbowWarriorProgress(types, tokenIds) {
            let count = 0;
            if (types.some(t => t === 'Rainbow')) count++;
            if (tokenIds.some(id => PLASTIC_ARMOR_HELMET_IDS.has(String(id)))) count++;
            return { current: count, needed: 2 };
        }
        
        // Store combo badge progress for display
        let comboBadgeProgress = {};
        
        function calculateComboBadges(tokenIds) {
            // Get types for all owned tokens
            const ownedTypes = tokenIds.map(id => typeData[id] || typeData[String(id)]).filter(t => t);
            console.log('Owned types:', ownedTypes);
            
            // Store globally for use in renderMissingBadges
            ownedTypesGlobal = ownedTypes;
            
            const results = {};
            comboBadgeProgress = {}; // Reset progress
            
            COMBO_BADGES.forEach(badge => {
                const earned = badge.check(ownedTypes, tokenIds);
                results[badge.name] = earned;
                
                // Calculate progress for missing badges
                if (!earned && badge.progress) {
                    comboBadgeProgress[badge.name] = badge.progress(ownedTypes, tokenIds);
                }
            });
            
            return results;
        }
        
        // Total badge count constant (for completion calculation)
        const TOTAL_BADGES = 89;
        
        function processResults(tokenIds, vibestrBalance = 0) {
            // Get badges for these tokens
            walletBadges = {};
            let totalBadgeCount = 0;
            
            // Use tokenToBadges if available (faster)
            if (window.tokenToBadges) {
                tokenIds.forEach(tokenId => {
                    const badges = window.tokenToBadges[tokenId] || window.tokenToBadges[String(tokenId)] || [];
                    badges.forEach(badge => {
                        if (!walletBadges[badge]) {
                            walletBadges[badge] = [];
                        }
                        walletBadges[badge].push(tokenId);
                        totalBadgeCount++;
                    });
                });
            } else {
                // Fallback: check each badge's token list
                tokenIds.forEach(tokenId => {
                    Object.entries(badgeData).forEach(([badge, tokens]) => {
                        let tokenList = Array.isArray(tokens) ? tokens : Object.values(tokens);
                        const hasToken = tokenList.some(t => 
                            String(t) === String(tokenId) || parseInt(t) === parseInt(tokenId)
                        );
                        
                        if (hasToken) {
                            if (!walletBadges[badge]) {
                                walletBadges[badge] = [];
                            }
                            walletBadges[badge].push(tokenId);
                            totalBadgeCount++;
                        }
                    });
                });
            }
            
            // Count NFT-based badges first (before adding meta badges)
            const nftBadgeCount = Object.keys(walletBadges).length;
            
            // Calculate combo badges based on NFT types owned
            const comboBadges = calculateComboBadges(tokenIds);
            const earnedComboBadges = [];
            const missingComboBadges = [];
            
            Object.entries(comboBadges).forEach(([badge, earned]) => {
                if (earned) {
                    walletBadges[badge] = ['meta'];
                    earnedComboBadges.push(badge);
                } else {
                    missingComboBadges.push(badge);
                }
            });
            
            // Add VIBESTR Tier Badges (based on token holdings) - BEFORE collection badges
            const earnedVibestrBadges = [];
            const missingVibestrBadges = [];
            VIBESTR_TIERS.forEach(tier => {
                if (vibestrBalance >= tier.threshold) {
                    walletBadges[tier.name] = ['meta'];
                    earnedVibestrBadges.push(tier.name);
                } else {
                    missingVibestrBadges.push(tier.name);
                }
            });
            
            // Count total badges BEFORE collection badges (NFT + combo + VIBESTR)
            let badgeCountForCollection = Object.keys(walletBadges).length;
            
            // Add Collection Badges (cascading - each badge earned counts toward the next)
            const earnedCollectionBadges = [];
            const missingCollectionBadges = [];
            COLLECTION_BADGE_THRESHOLDS.forEach(threshold => {
                const badgeName = `collection_${threshold}`;
                if (badgeCountForCollection >= threshold) {
                    walletBadges[badgeName] = ['meta'];
                    earnedCollectionBadges.push(badgeName);
                    badgeCountForCollection++; // This badge now counts toward the next threshold!
                } else {
                    missingCollectionBadges.push(badgeName);
                }
            });
            
            // Find missing badges
            const allBadges = Object.keys(badgeData);
            const ownedBadgeNames = Object.keys(walletBadges);
            missingBadgesList = allBadges.filter(b => !ownedBadgeNames.includes(b));
            
            // Add missing meta badges to the list
            missingBadgesList = [...missingBadgesList, ...missingComboBadges, ...missingCollectionBadges, ...missingVibestrBadges];
            
            // Add VIBE Bounty Hunter to missing if not checked
            if (vibeBountyHunterCount < 1) {
                missingBadgesList.push('vibe_bounty_hunter');
            }
            
            // Sort missing by rarity (fewer tokens = rarer), meta badges go last
            missingBadgesList.sort((a, b) => {
                // Special badges go to the end
                if (a === 'vibe_bounty_hunter') return 1;
                if (b === 'vibe_bounty_hunter') return -1;
                // Meta badges go after NFT badges but before special
                const aIsMeta = a.startsWith('collection_') || a.startsWith('vibestr_') || COMBO_BADGES.some(cb => cb.name === a);
                const bIsMeta = b.startsWith('collection_') || b.startsWith('vibestr_') || COMBO_BADGES.some(cb => cb.name === b);
                if (aIsMeta && !bIsMeta) return 1;
                if (!aIsMeta && bIsMeta) return -1;
                if (aIsMeta && bIsMeta) return 0;
                
                const aTokens = badgeData[a];
                const bTokens = badgeData[b];
                const aLen = aTokens ? (Array.isArray(aTokens) ? aTokens.length : Object.keys(aTokens).length) : 999;
                const bLen = bTokens ? (Array.isArray(bTokens) ? bTokens.length : Object.keys(bTokens).length) : 999;
                return aLen - bLen;
            });
            
            // Update stats - use fixed total of 89
            const ownedCount = ownedBadgeNames.length + vibeBountyHunterCount;
            const completion = Math.round((ownedCount / TOTAL_BADGES) * 100);
            
            // Find rarest badge owned (fewest NFTs have it) - skip meta badges
            let rarestBadge = '-';
            let rarestCount = Infinity;
            let rarestTokenId = null;
            let rarestBadgeKey = null;
            ownedBadgeNames.forEach(badge => {
                if (badge.startsWith('collection_') || badge.startsWith('vibestr_')) return;
                if (COMBO_BADGES.some(cb => cb.name === badge)) return;
                const tokens = badgeData[badge];
                if (!tokens) return;
                const count = Array.isArray(tokens) ? tokens.length : Object.keys(tokens).length;
                if (count < rarestCount) {
                    rarestCount = count;
                    rarestBadgeKey = badge;
                    rarestBadge = formatBadgeName(badge);
                    rarestTokenId = walletBadges[badge] ? walletBadges[badge][0] : null;
                }
            });
            
            rarestBadgeData = { badge: rarestBadgeKey, badgeName: rarestBadge, tokenId: rarestTokenId };
            
            document.getElementById('nftCount').textContent = tokenIds.length;
            document.getElementById('ownedBadges').textContent = ownedCount;
            document.getElementById('missingBadges').textContent = TOTAL_BADGES - ownedCount;
            document.getElementById('rarestBadge').textContent = rarestBadge;
            
            // Show rarest NFT image if we have one
            const rarestImg = document.getElementById('rarestNftImg');
            if (rarestTokenId && imageData[rarestTokenId]) {
                rarestImg.src = imageData[rarestTokenId];
                rarestImg.style.display = 'block';
            } else {
                rarestImg.style.display = 'none';
            }
            
            document.getElementById('completionPct').textContent = completion + '%';
            document.getElementById('progressFill').style.width = completion + '%';
            document.getElementById('ownedTabCount').textContent = ownedCount;
            document.getElementById('missingTabCount').textContent = TOTAL_BADGES - ownedCount;
            
            // Render badge grids
            renderOwnedBadges();
            renderMissingBadges();
            
            // Hide badge explorer section and show button instead
            hideBadgeExplorerShowButton();
            
            // Store for modal use
            walletNFTs = tokenIds;
        }
        
        function renderOwnedBadges() {
            const grid = document.getElementById('ownedGrid');
            currentTab = 'owned';
            
            // Helper to check if badge is meta (combo, collection, or vibestr)
            const isMetaBadge = (name) => {
                return name.startsWith('collection_') || 
                       name.startsWith('vibestr_') || 
                       COMBO_BADGES.some(cb => cb.name === name);
            };
            
            // Apply sorting
            const sorted = sortBadges(Object.entries(walletBadges), true);
            
            let html = sorted.map(([badge, tokens]) => {
                const color = getBadgeColor(badge);
                const isGradient = color.includes('gradient');
                const style = isGradient 
                    ? `background: ${color}; -webkit-background-clip: text; -webkit-text-fill-color: transparent;`
                    : `color: ${color};`;
                
                const isCombo = COMBO_BADGES.some(cb => cb.name === badge);
                const isMeta = badge.startsWith('collection_') || badge.startsWith('vibestr_') || isCombo;
                const countDisplay = isMeta ? '✓' : `×${tokens.length}`;
                const clickHandler = isMeta ? '' : `onclick="showBadgeNFTs('${badge}', true)"`;
                const cursorStyle = isMeta ? 'cursor: default;' : '';
                const badgeImgUrl = getBadgeImage(badge);
                const imgHtml = badgeImgUrl ? `<img class="badge-item-img" src="${badgeImgUrl}" alt="">` : '';
                
                return `
                    <div class="badge-item" ${clickHandler} style="${cursorStyle}">
                        ${imgHtml}
                        <div class="badge-item-content">
                            <span class="badge-name" style="${style}">${formatBadgeName(badge)}</span>
                            <span class="badge-count" style="${isMeta ? 'color: var(--accent-green);' : ''}">${countDisplay}</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Add VIBE Bounty Hunter if claimed
            if (vibeBountyHunterCount > 0) {
                const color = getBadgeColor('vibe_bounty_hunter');
                const badgeImgUrl = getBadgeImage('vibestr_bounty_hunter');
                const imgHtml = badgeImgUrl ? `<img class="badge-item-img" src="${badgeImgUrl}" alt="">` : '';
                html += `
                    <div class="badge-item" style="cursor: default;">
                        ${imgHtml}
                        <div class="badge-item-content">
                            <span class="badge-name" style="color: ${color};">${formatBadgeName('vibe_bounty_hunter')}</span>
                            <span class="badge-count" style="color: var(--accent-green);">✓</span>
                        </div>
                        <span class="badge-note">Self-reported badge</span>
                    </div>
                `;
            }
            
            grid.innerHTML = html;
        }
        
        function renderMissingBadges() {
            const grid = document.getElementById('missingGrid');
            currentTab = 'missing';
            
            // Apply sorting
            const sortedMissing = sortBadges(missingBadgesList, false);
            
            grid.innerHTML = sortedMissing.map(badge => {
                const color = getBadgeColor(badge);
                const isGradient = color.includes && color.includes('gradient');
                const style = isGradient 
                    ? `background: ${color}; -webkit-background-clip: text; -webkit-text-fill-color: transparent;`
                    : `color: ${color};`;
                
                const comboInfo = COMBO_BADGES.find(cb => cb.name === badge);
                const isCombo = !!comboInfo;
                const isMeta = badge.startsWith('collection_') || badge.startsWith('vibestr_') || isCombo;
                const isSpecial = badge === 'vibe_bounty_hunter';
                let requirement = '';
                let progressBar = '';
                let extraContent = '';
                
                if (isSpecial) {
                    requirement = 'Bought via Gondi or NFT Strategy';
                    extraContent = `
                        <div class="bounty-checkbox-container">
                            <input type="checkbox" id="bountyHunterCheck1" onchange="updateBountyHunterCount()" ${vibeBountyHunterCount >= 1 ? 'checked' : ''}>
                            <label for="bountyHunterCheck1">I have this badge</label>
                        </div>
                        <span class="badge-note">We can't verify this badge - manually check it if you have it</span>
                    `;
                } else if (badge.startsWith('collection_')) {
                    const num = badge.replace('collection_', '');
                    requirement = `Collect ${num} badges`;
                } else if (badge.startsWith('vibestr_')) {
                    const tier = VIBESTR_TIERS.find(t => t.name === badge);
                    requirement = tier ? `Hold ${tier.threshold.toLocaleString()} $VIBESTR` : '';
                } else if (isCombo) {
                    // Show progress for combo badges
                    const progress = comboBadgeProgress[badge];
                    if (progress && progress.current > 0) {
                        const pct = Math.round((progress.current / progress.needed) * 100);
                        requirement = `${progress.current}/${progress.needed} - ${comboInfo.requirement}`;
                        progressBar = `
                            <div class="combo-progress">
                                <div class="combo-progress-fill" style="width: ${pct}%"></div>
                            </div>
                        `;
                        
                        // Show missing colors for High Five and Hatrick badges
                        if (badge.includes('high_five') || badge.includes('hatrick')) {
                            let typePrefix = '';
                            if (badge.startsWith('gradient')) typePrefix = 'Gradient';
                            else if (badge.startsWith('plastic')) typePrefix = 'Plastic';
                            else if (badge.startsWith('robot')) typePrefix = 'Robot';
                            
                            if (typePrefix && ownedTypesGlobal.length > 0) {
                                const missingColors = getMissingColors(ownedTypesGlobal, typePrefix);
                                
                                if (missingColors.length > 0 && missingColors.length <= 5) {
                                    const colorLinks = missingColors.map(color => 
                                        `<a href="${getOpenSeaLink(color)}" target="_blank" style="color: var(--accent-cyan); text-decoration: none; font-size: 12px;">${color.replace(typePrefix + ' ', '')}</a>`
                                    ).join(', ');
                                    extraContent = `<div class="badge-note" style="color: var(--text-secondary);">Missing: ${colorLinks}</div>`;
                                }
                            }
                        }
                        
                        // Show missing for Chris' Favorite (Grayscale)
                        if (badge === 'chris_favorite' && progress.current === 1) {
                            extraContent = `<div class="badge-note" style="color: var(--text-secondary);">Need 1 more: <a href="${getOpenSeaLink('Grayscale')}" target="_blank" style="color: var(--accent-cyan); text-decoration: none; font-size: 12px;">Grayscale</a></div>`;
                        }
                        
                        // Show missing for Yin N' Yang
                        if (badge === 'yin_n_yang' && ownedTypesGlobal.length > 0) {
                            const hasGrayscale = ownedTypesGlobal.some(t => t === 'Grayscale');
                            const hasRainbow = ownedTypesGlobal.some(t => t === 'Rainbow');
                            let missing = [];
                            if (!hasGrayscale) missing.push(`<a href="${getOpenSeaLink('Grayscale')}" target="_blank" style="color: var(--accent-cyan); text-decoration: none; font-size: 12px;">Grayscale</a>`);
                            if (!hasRainbow) missing.push(`<a href="${getOpenSeaLink('Rainbow')}" target="_blank" style="color: var(--accent-cyan); text-decoration: none; font-size: 12px;">Rainbow</a>`);
                            if (missing.length > 0) {
                                extraContent = `<div class="badge-note" style="color: var(--text-secondary);">Missing: ${missing.join(', ')}</div>`;
                            }
                        }
                        
                        // Show missing for Elite Rainbow Ranger
                        if (badge === 'elite_rainbow_ranger') {
                            const hasRainbow = ownedTypesGlobal.some(t => t === 'Rainbow');
                            const hasPlasticArmorHelmet = walletNFTs.some(id => PLASTIC_ARMOR_HELMET_IDS.has(String(id)));
                            let missing = [];
                            if (!hasRainbow) missing.push(`<a href="${getOpenSeaLink('Rainbow')}" target="_blank" style="color: var(--accent-cyan); text-decoration: none; font-size: 12px;">Rainbow Type</a>`);
                            if (!hasPlasticArmorHelmet) {
                                missing.push(`<a href="https://opensea.io/collection/good-vibes-club?traits=[{%22traitType%22:%22Body%22,%22values%22:[%22Plastic+Armor+Light+Blue%22,%22Plastic+Armor+Yellow%22,%22Plastic+Armor+Blue%22,%22Plastic+Armor+Lime%22,%22Plastic+Armor+Glass%22,%22Plastic+Armor+Mint%22,%22Plastic+Armor+Red%22,%22Plastic+Armor+Pink%22,%22Plastic+Armor+Gold%22,%22Plastic+Armor+Purple%22,%22Plastic+Armor+Black%22,%22Plastic+Armor+White%22]}]" target="_blank" style="color: var(--accent-cyan); text-decoration: none; font-size: 12px;">Plastic Armor</a>`);
                                missing.push(`<a href="https://opensea.io/collection/good-vibes-club?traits=[{%22traitType%22:%22Hair%22,%22values%22:[%22Plastic+Helmet+White%22,%22Plastic+Helmet+Yellow%22,%22Plastic+Helmet+Glass%22,%22Plastic+Helmet+Light+Blue%22,%22Plastic+Helmet+Pink%22,%22Plastic+Helmet+Purple%22,%22Plastic+Helmet+Black%22,%22Plastic+Helmet+Blue%22,%22Plastic+Helmet+Gold%22,%22Plastic+Helmet+Mint%22,%22Plastic+Helmet+Lime%22,%22Plastic+Helmet+Red%22]}]" target="_blank" style="color: var(--accent-cyan); text-decoration: none; font-size: 12px;">Plastic Helmet</a>`);
                            }
                            if (missing.length > 0) {
                                extraContent = `<div class="badge-note" style="color: var(--text-secondary);">Missing: ${missing.join(', ')}</div>`;
                            }
                        }
                    } else {
                        requirement = comboInfo.requirement;
                    }
                } else {
                    const tokens = badgeData[badge];
                    const rarity = tokens ? (Array.isArray(tokens) ? tokens.length : Object.keys(tokens).length) : 0;
                    requirement = `${rarity} NFTs have this`;
                }
                
                const clickHandler = (isMeta || isSpecial) ? '' : `onclick="showBadgeNFTs('${badge}', false)"`;
                const cursorStyle = (isMeta || isSpecial) ? 'cursor: default;' : '';
                const badgeImgUrl = getBadgeImage(badge);
                const imgHtml = badgeImgUrl ? `<img class="badge-item-img" src="${badgeImgUrl}" alt="" style="opacity: 0.5;">` : '';
                
                return `
                    <div class="badge-item missing" ${clickHandler} style="${cursorStyle}">
                        ${imgHtml}
                        <div class="badge-item-content">
                            <span class="badge-name" style="${style}">${formatBadgeName(badge)}</span>
                            <span class="badge-count">${requirement}</span>
                        </div>
                        ${progressBar}
                        ${extraContent}
                    </div>
                `;
            }).join('');
        }
        
        function updateBountyHunterCount() {
            const check1 = document.getElementById('bountyHunterCheck1');
            
            // Check if box is checked
            vibeBountyHunterCount = (check1 && check1.checked) ? 1 : 0;
            
            // Update counts
            const ownedCount = Object.keys(walletBadges).length + vibeBountyHunterCount;
            const completion = Math.round((ownedCount / TOTAL_BADGES) * 100);
            
            document.getElementById('ownedBadges').textContent = ownedCount;
            document.getElementById('missingBadges').textContent = TOTAL_BADGES - ownedCount;
            document.getElementById('completionPct').textContent = `${completion}%`;
            document.getElementById('progressFill').style.width = `${completion}%`;
            document.getElementById('ownedTabCount').textContent = ownedCount;
            document.getElementById('missingTabCount').textContent = TOTAL_BADGES - ownedCount;
            
            // Update missing list
            if (vibeBountyHunterCount >= 1) {
                missingBadgesList = missingBadgesList.filter(b => b !== 'vibe_bounty_hunter');
            } else if (!missingBadgesList.includes('vibe_bounty_hunter')) {
                missingBadgesList.push('vibe_bounty_hunter');
            }
            
            // Re-render both grids
            renderOwnedBadges();
            renderMissingBadges();
        }
        
        function showTab(tab) {
            currentTab = tab;
            const ownedGrid = document.getElementById('ownedGrid');
            const missingGrid = document.getElementById('missingGrid');
            const tabs = document.querySelectorAll('.tab');
            
            tabs.forEach(t => t.classList.remove('active'));
            
            if (tab === 'owned') {
                ownedGrid.style.display = 'grid';
                missingGrid.style.display = 'none';
                tabs[0].classList.add('active');
                renderOwnedBadges();
            } else {
                ownedGrid.style.display = 'none';
                missingGrid.style.display = 'grid';
                tabs[1].classList.add('active');
                renderMissingBadges();
            }
        }
        
        function showBadgeNFTs(badge, isOwned) {
            const modal = document.getElementById('modal');
            const title = document.getElementById('modalTitle');
            const nftGrid = document.getElementById('modalNFTs');
            const openSeaLink = document.getElementById('modalOpenSeaLink');
            
            const badgeColor = getBadgeColor(badge);
            title.textContent = formatBadgeName(badge);
            
            // Show/hide OpenSea link
            const badgeLink = getBadgeOpenSeaLink(badge);
            if (badge === 'ranger') {
                // Special case: ranger has two link options
                openSeaLink.href = '#';
                openSeaLink.style.display = 'none';
                // We'll add the links after the title instead
                const rangerLinks = `<a href="https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Hair%22,%22values%22:[%22Plastic+Helmet+White%22,%22Plastic+Helmet+Yellow%22,%22Plastic+Helmet+Glass%22,%22Plastic+Helmet+Light+Blue%22,%22Plastic+Helmet+Pink%22,%22Plastic+Helmet+Purple%22,%22Plastic+Helmet+Black%22,%22Plastic+Helmet+Blue%22,%22Plastic+Helmet+Gold%22,%22Plastic+Helmet+Mint%22,%22Plastic+Helmet+Lime%22,%22Plastic+Helmet+Red%22]}]" target="_blank" style="color: var(--accent-cyan); text-decoration: none; font-size: 13px; margin-left: 12px;">Plastic Helmet →</a> <a href="https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Body%22,%22values%22:[%22Plastic+Armor+Light+Blue%22,%22Plastic+Armor+Yellow%22,%22Plastic+Armor+Blue%22,%22Plastic+Armor+Lime%22,%22Plastic+Armor+Glass%22,%22Plastic+Armor+Mint%22,%22Plastic+Armor+Red%22,%22Plastic+Armor+Pink%22,%22Plastic+Armor+Gold%22,%22Plastic+Armor+Purple%22,%22Plastic+Armor+Black%22]}]" target="_blank" style="color: var(--accent-cyan); text-decoration: none; font-size: 13px; margin-left: 12px;">Plastic Armor →</a>`;
                title.innerHTML = formatBadgeName(badge) + rangerLinks;
            } else if (badge === 'super_rare') {
                // Special case: super_rare has two link options
                openSeaLink.href = '#';
                openSeaLink.style.display = 'none';
                const superRareLinks = `<a href="https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Hair%22,%22values%22:[%22Ballcap+Forward+Black+SuperRare%22,%22Bucket+Hat+Black+SuperRare%22]}]" target="_blank" style="color: var(--accent-cyan); text-decoration: none; font-size: 13px; margin-left: 12px;">Hair →</a> <a href="https://opensea.io/collection/good-vibes-club?status=all&traits=[{%22traitType%22:%22Body%22,%22values%22:[%22Hoodie+Black+SuperRare%22]}]" target="_blank" style="color: var(--accent-cyan); text-decoration: none; font-size: 13px; margin-left: 12px;">Body →</a>`;
                title.innerHTML = formatBadgeName(badge) + superRareLinks;
            } else if (badgeLink) {
                title.textContent = formatBadgeName(badge);
                openSeaLink.href = badgeLink;
                openSeaLink.style.display = 'inline';
            } else {
                title.textContent = formatBadgeName(badge);
                openSeaLink.style.display = 'none';
            }
            
            let tokenIds;
            if (isOwned) {
                tokenIds = walletBadges[badge];
            } else {
                const tokens = badgeData[badge];
                const allTokens = Array.isArray(tokens) ? tokens : Object.values(tokens);
                tokenIds = allTokens.slice(0, 50); // Limit to 50 for performance
            }
            
            const CONTRACT = '0xb8ea78fcacef50d41375e44e6814ebba36bb33c4';
            
            nftGrid.innerHTML = tokenIds.map(tokenId => {
                const imgUrl = imageData[tokenId] || imageData[String(tokenId)];
                
                if (imgUrl) {
                    return `
                        <a href="https://opensea.io/assets/ethereum/${CONTRACT}/${tokenId}" target="_blank" class="nft-card">
                            <img src="${imgUrl}" alt="#${tokenId}" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div style="display:none; padding: 20px; text-align: center;">
                                <div style="font-size: 16px; font-weight: 600;">#${tokenId}</div>
                            </div>
                            <div class="nft-id">#${tokenId}</div>
                        </a>
                    `;
                } else {
                    return `
                        <a href="https://opensea.io/assets/ethereum/${CONTRACT}/${tokenId}" target="_blank" class="nft-card" style="text-decoration: none;">
                            <div style="font-family: 'JetBrains Mono', monospace; font-size: 16px; font-weight: 600; color: var(--text-primary); padding: 20px;">#${tokenId}</div>
                            <div style="font-size: 11px; color: var(--accent-cyan);">View on OpenSea →</div>
                        </a>
                    `;
                }
            }).join('');
            
            modal.classList.add('active');
        }
        
        function closeModal(event) {
            if (!event || event.target === document.getElementById('modal')) {
                document.getElementById('modal').classList.remove('active');
            }
        }
        
        // Allow Enter key to search
        document.getElementById('walletInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                lookupWallet();
            }
        });
        
        // Close modal on Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
                closeGalleryModal();
                closeShareModal();
            }
        });
        
        // ========================================
        // SORTING FUNCTIONALITY
        // ========================================
        function setSortMode(mode) {
            // Detect current tab from DOM (more reliable)
            const ownedGrid = document.getElementById('ownedGrid');
            currentTab = ownedGrid.style.display !== 'none' ? 'owned' : 'missing';
            
            // If clicking the same mode, toggle direction
            if (currentSortMode === mode) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortMode = mode;
                // Default directions for each mode
                if (mode === 'rarity') {
                    sortDirection = 'asc'; // Rarest first
                } else if (mode === 'quantity') {
                    sortDirection = 'desc'; // Most owned first
                } else if (mode === 'alpha') {
                    sortDirection = 'asc'; // A-Z
                }
            }
            
            // Update button states and arrows
            document.querySelectorAll('.sort-btn').forEach(btn => {
                const isActive = btn.dataset.sort === mode;
                btn.classList.toggle('active', isActive);
                
                // Update arrow for active button
                const arrow = btn.querySelector('.arrow');
                if (arrow) {
                    if (isActive) {
                        arrow.textContent = sortDirection === 'asc' ? '↑' : '↓';
                    } else {
                        // Reset inactive buttons to default arrows
                        if (btn.dataset.sort === 'rarity') arrow.textContent = '↑';
                        else arrow.textContent = '↓';
                    }
                }
                
                // Update button text for alpha
                if (btn.dataset.sort === 'alpha' && isActive) {
                    btn.innerHTML = (sortDirection === 'asc' ? 'A-Z' : 'Z-A') + ' <span class="arrow">' + (sortDirection === 'asc' ? '↓' : '↑') + '</span>';
                } else if (btn.dataset.sort === 'alpha' && !isActive) {
                    btn.innerHTML = 'A-Z <span class="arrow">↓</span>';
                }
            });
            
            if (currentTab === 'owned') {
                renderOwnedBadges();
            } else {
                renderMissingBadges();
            }
        }
        
        function getBadgeRarity(badge) {
            if (badge.startsWith('collection_') || badge.startsWith('vibestr_') || COMBO_BADGES.some(cb => cb.name === badge)) {
                return 9999;
            }
            const tokens = badgeData[badge];
            return tokens ? (Array.isArray(tokens) ? tokens.length : Object.keys(tokens).length) : 9999;
        }
        
        function sortBadges(badges, isOwned) {
            const sorted = badges.slice().sort((a, b) => {
                const badgeA = isOwned ? a[0] : a;
                const badgeB = isOwned ? b[0] : b;
                
                // Special badges always go last
                if (badgeA === 'vibe_bounty_hunter') return 1;
                if (badgeB === 'vibe_bounty_hunter') return -1;
                
                let result = 0;
                switch (currentSortMode) {
                    case 'rarity':
                        result = getBadgeRarity(badgeA) - getBadgeRarity(badgeB);
                        break;
                    case 'quantity':
                        if (isOwned) {
                            result = b[1].length - a[1].length; // Default: most first
                            if (sortDirection === 'asc') result = -result;
                            return result;
                        }
                        result = getBadgeRarity(badgeA) - getBadgeRarity(badgeB);
                        break;
                    case 'alpha':
                        result = formatBadgeName(badgeA).localeCompare(formatBadgeName(badgeB));
                        break;
                    default:
                        return 0;
                }
                
                // Apply direction (except quantity which is handled above)
                if (currentSortMode !== 'quantity' && sortDirection === 'desc') {
                    result = -result;
                }
                
                return result;
            });
            
            return sorted;
        }
        
        // ========================================
        // NFT GALLERY MODAL
        // ========================================
        function showNFTGallery() {
            const modal = document.getElementById('galleryModal');
            const grid = document.getElementById('galleryNFTs');
            const title = document.getElementById('galleryTitle');
            
            title.textContent = 'Your GVC Collection (' + walletNFTs.length + ' NFTs)';
            
            const CONTRACT = '0xb8ea78fcacef50d41375e44e6814ebba36bb33c4';
            
            grid.innerHTML = walletNFTs.map(tokenId => {
                const imgUrl = imageData[tokenId] || imageData[String(tokenId)];
                const badges = window.tokenToBadges ? (window.tokenToBadges[tokenId] || window.tokenToBadges[String(tokenId)] || []) : [];
                const displayBadges = badges.slice(0, 3).map(b => formatBadgeName(b));
                const moreBadges = badges.length > 3 ? '+' + (badges.length - 3) : '';
                
                return '<a href="https://opensea.io/assets/ethereum/' + CONTRACT + '/' + tokenId + '" target="_blank" class="nft-gallery-card">' +
                    (imgUrl ? '<img src="' + imgUrl + '" alt="#' + tokenId + '" loading="lazy">' : '<div style="aspect-ratio:1;background:var(--bg-hover);display:flex;align-items:center;justify-content:center;">No Image</div>') +
                    '<div class="nft-gallery-info">' +
                    '<div class="nft-gallery-id">#' + tokenId + '</div>' +
                    '<div class="nft-gallery-badges">' +
                    displayBadges.map(b => '<span class="nft-badge-tag">' + b + '</span>').join('') +
                    (moreBadges ? '<span class="nft-badge-tag" style="background:var(--accent-cyan);color:#000;">' + moreBadges + '</span>' : '') +
                    '</div></div></a>';
            }).join('');
            
            modal.classList.add('active');
        }
        
        function closeGalleryModal(event) {
            if (!event || event.target === document.getElementById('galleryModal')) {
                document.getElementById('galleryModal').classList.remove('active');
            }
        }
        
        // ========================================
        // SHARE FUNCTIONALITY
        // ========================================
        let selectedShareNft = null;
        let selectedShareBadges = [];
        const MAX_SHARE_BADGES = 6;
        
        function showShareModal(mode) {
            shareMode = mode;
            selectedShareBadges = [];
            
            // Auto-select the NFT that earned the rarest badge
            if (rarestBadgeData.tokenId) {
                selectedShareNft = rarestBadgeData.tokenId;
            } else if (walletNFTs.length > 0) {
                selectedShareNft = walletNFTs[0];
            } else {
                selectedShareNft = null;
            }
            
            const modal = document.getElementById('shareModal');
            const title = document.getElementById('shareModalTitle');
            const badgePickerTitle = document.getElementById('badgePickerTitle');
            
            if (mode === 'owned') {
                title.textContent = '🤙 Share Your Badges';
                badgePickerTitle.textContent = '✨ Select badges to feature (max 6):';
            } else {
                title.textContent = "🔍 I'm On The Hunt";
                badgePickerTitle.textContent = '🎯 Select badges you want (max 6):';
            }
            
            // Build NFT picker
            buildNftPicker();
            
            // Build badge picker
            buildBadgePicker();
            
            // Auto-select top badges
            autoSelectBadges();
            
            // Update preview
            updateSharePreview();
            
            modal.classList.add('active');
        }
        
        function buildNftPicker() {
            const picker = document.getElementById('shareNftPicker');
            
            // Sort NFTs: ones that earned rare badges first
            const nftsByRarity = walletNFTs.slice().sort((a, b) => {
                // Get the rarest badge each NFT has
                const badgesA = window.tokenToBadges ? (window.tokenToBadges[a] || window.tokenToBadges[String(a)] || []) : [];
                const badgesB = window.tokenToBadges ? (window.tokenToBadges[b] || window.tokenToBadges[String(b)] || []) : [];
                
                // Find rarest badge for each (lowest rarity number = rarest)
                const rarestA = badgesA.length > 0 ? Math.min(...badgesA.map(badge => getBadgeRarity(badge))) : 99999;
                const rarestB = badgesB.length > 0 ? Math.min(...badgesB.map(badge => getBadgeRarity(badge))) : 99999;
                
                return rarestA - rarestB;
            });
            
            picker.innerHTML = nftsByRarity.map(tokenId => {
                const imgUrl = imageData[tokenId] || imageData[String(tokenId)];
                const isSelected = tokenId === selectedShareNft || String(tokenId) === String(selectedShareNft);
                const badges = window.tokenToBadges ? (window.tokenToBadges[tokenId] || window.tokenToBadges[String(tokenId)] || []) : [];
                const rarestBadge = badges.length > 0 ? badges.reduce((a, b) => getBadgeRarity(a) < getBadgeRarity(b) ? a : b) : null;
                const isRare = rarestBadge && getBadgeRarity(rarestBadge) < 100; // Highlight if badge has <100 holders
                
                return '<div class="share-nft-option ' + (isSelected ? 'selected' : '') + (isRare ? ' rare' : '') + '" onclick="selectShareNft(\'' + tokenId + '\')" title="' + (rarestBadge ? formatBadgeName(rarestBadge) : '#' + tokenId) + '">' +
                    (imgUrl ? '<img src="' + imgUrl + '" alt="#' + tokenId + '">' : '<div style="width:100%;height:100%;background:var(--bg-hover);display:flex;align-items:center;justify-content:center;font-size:10px;">#' + tokenId + '</div>') +
                    '</div>';
            }).join('');
        }
        
        function buildBadgePicker() {
            const picker = document.getElementById('shareBadgePicker');
            
            let badgesToShow;
            if (shareMode === 'owned') {
                // Show owned badges sorted by rarity
                badgesToShow = Object.keys(walletBadges)
                    .filter(b => !b.startsWith('collection_') && !b.startsWith('vibestr_') && !COMBO_BADGES.some(cb => cb.name === b))
                    .sort((a, b) => getBadgeRarity(a) - getBadgeRarity(b));
            } else {
                // Show missing badges sorted by rarity (most achievable first)
                badgesToShow = missingBadgesList
                    .filter(b => !b.startsWith('collection_') && !b.startsWith('vibestr_') && !COMBO_BADGES.some(cb => cb.name === b) && b !== 'vibe_bounty_hunter');
            }
            
            picker.innerHTML = badgesToShow.map(badge => {
                const color = getBadgeColor(badge);
                const isSelected = selectedShareBadges.includes(badge);
                const style = color.includes('gradient') 
                    ? 'background: ' + color + '; -webkit-background-clip: text; -webkit-text-fill-color: transparent;'
                    : 'color: ' + color + ';';
                return '<div class="share-badge-option ' + (isSelected ? 'selected' : '') + '" data-badge="' + badge + '" onclick="toggleShareBadge(\'' + badge + '\')">' +
                    '<span style="' + style + '">' + formatBadgeName(badge) + '</span>' +
                    '</div>';
            }).join('');
        }
        
        function autoSelectBadges() {
            let badgesToSelect;
            if (shareMode === 'owned') {
                badgesToSelect = Object.keys(walletBadges)
                    .filter(b => !b.startsWith('collection_') && !b.startsWith('vibestr_') && !COMBO_BADGES.some(cb => cb.name === b))
                    .sort((a, b) => getBadgeRarity(a) - getBadgeRarity(b))
                    .slice(0, MAX_SHARE_BADGES);
            } else {
                badgesToSelect = missingBadgesList
                    .filter(b => !b.startsWith('collection_') && !b.startsWith('vibestr_') && !COMBO_BADGES.some(cb => cb.name === b) && b !== 'vibe_bounty_hunter')
                    .slice(0, MAX_SHARE_BADGES);
            }
            
            selectedShareBadges = badgesToSelect;
            
            // Update UI
            document.querySelectorAll('.share-badge-option').forEach(el => {
                el.classList.toggle('selected', selectedShareBadges.includes(el.dataset.badge));
            });
            
            updateSelectedCount();
        }
        
        function selectShareNft(tokenId) {
            selectedShareNft = tokenId;
            
            // Update UI
            document.querySelectorAll('.share-nft-option').forEach(el => {
                el.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            updateSharePreview();
        }
        
        function toggleShareBadge(badge) {
            const idx = selectedShareBadges.indexOf(badge);
            if (idx > -1) {
                selectedShareBadges.splice(idx, 1);
            } else if (selectedShareBadges.length < MAX_SHARE_BADGES) {
                selectedShareBadges.push(badge);
            }
            
            // Update UI
            document.querySelectorAll('.share-badge-option').forEach(el => {
                el.classList.toggle('selected', selectedShareBadges.includes(el.dataset.badge));
            });
            
            updateSelectedCount();
            updateSharePreview();
        }
        
        function updateSelectedCount() {
            document.getElementById('shareSelectedCount').textContent = selectedShareBadges.length + ' of ' + MAX_SHARE_BADGES + ' selected';
        }
        
        function updateSharePreview() {
            const preview = document.getElementById('shareImagePreview');
            const ownedCount = Object.keys(walletBadges).length + vibeBountyHunterCount;
            const completion = Math.round((ownedCount / TOTAL_BADGES) * 100);
            
            const nftImgUrl = selectedShareNft ? (imageData[selectedShareNft] || imageData[String(selectedShareNft)]) : null;
            
            let titleText, statsText;
            if (shareMode === 'owned') {
                titleText = '🤙 My GVC Badge Collection';
                statsText = walletNFTs.length + ' NFTs • ' + ownedCount + ' Badges • ' + completion + '%';
            } else {
                titleText = "🔍 Badges I'm Hunting";
                statsText = (TOTAL_BADGES - ownedCount) + ' Missing • ' + ownedCount + '/' + TOTAL_BADGES + ' Collected';
            }
            
            preview.innerHTML = 
                (nftImgUrl ? '<img class="share-hero-nft" src="' + nftImgUrl + '" alt="Featured NFT">' : '') +
                '<div class="share-image-title">' + titleText + '</div>' +
                '<div class="share-image-stats">' + statsText + '</div>' +
                '<div class="share-image-badges">' +
                selectedShareBadges.map(b => {
                    const color = getBadgeColor(b);
                    const style = color.includes('gradient') 
                        ? 'background: ' + color + '; -webkit-background-clip: text; -webkit-text-fill-color: transparent;'
                        : 'color: ' + color + ';';
                    return '<span class="share-badge-tag" style="' + style + '">' + formatBadgeName(b) + '</span>';
                }).join('') +
                '</div>' +
                '<div class="share-image-footer">gvcbadges.com</div>';
        }
        
        function closeShareModal(event) {
            if (!event || event.target === document.getElementById('shareModal')) {
                document.getElementById('shareModal').classList.remove('active');
            }
        }
        
        function getShareText() {
            const ownedCount = Object.keys(walletBadges).length + vibeBountyHunterCount;
            const completion = Math.round((ownedCount / TOTAL_BADGES) * 100);
            
            const badgeNames = selectedShareBadges.map(b => '• ' + formatBadgeName(b)).join('\n');
            
            if (shareMode === 'owned') {
                return '🤙 My @goodvibesclub Badge Collection\n\n' +
                    '📊 ' + walletNFTs.length + ' NFTs | ' + ownedCount + ' Badges | ' + completion + '% Complete\n\n' +
                    '✨ Featured Badges:\n' + badgeNames + '\n\n' +
                    '🔍 Check yours at gvcbadges.com\n\n' +
                    '#GVC #GoodVibesClub #NFT';
            } else {
                return "🔍 I'm hunting @goodvibesclub badges!\n\n" +
                    '📊 ' + ownedCount + '/' + TOTAL_BADGES + ' collected (' + completion + '%)\n\n' +
                    '🎯 Most Wanted:\n' + badgeNames + '\n\n' +
                    'Got any leads? 👀\n\n' +
                    'gvcbadges.com\n\n' +
                    '#GVC #GoodVibesClub #NFT';
            }
        }
        
        function copyShareText() {
            const text = getShareText();
            navigator.clipboard.writeText(text).then(function() {
                const btn = document.querySelector('.share-action-btn.copy');
                const originalText = btn.textContent;
                btn.textContent = '✓ Copied!';
                setTimeout(function() {
                    btn.textContent = originalText;
                }, 2000);
            });
        }
        
        function shareToTwitter() {
            const text = encodeURIComponent(getShareText());
            window.open('https://twitter.com/intent/tweet?text=' + text, '_blank');
        }
        
        function copyShareImage() {
            const btn = document.querySelector('.share-action-btn.copy-img');
            const originalText = btn.textContent;
            btn.textContent = '⏳ Creating...';
            
            // Generate the canvas
            generateShareCanvas(function(canvas) {
                canvas.toBlob(function(blob) {
                    try {
                        navigator.clipboard.write([
                            new ClipboardItem({ 'image/png': blob })
                        ]).then(function() {
                            btn.textContent = '✓ Copied!';
                            setTimeout(function() {
                                btn.textContent = originalText;
                            }, 2000);
                        }).catch(function(err) {
                            console.error('Failed to copy image:', err);
                            btn.textContent = '❌ Failed';
                            setTimeout(function() {
                                btn.textContent = originalText;
                            }, 2000);
                            // Fallback: offer to download instead
                            alert('Could not copy to clipboard. Your browser may not support this feature. Try the "Save Image" button instead.');
                        });
                    } catch (err) {
                        console.error('Clipboard API not supported:', err);
                        btn.textContent = '❌ Not supported';
                        setTimeout(function() {
                            btn.textContent = originalText;
                        }, 2000);
                        alert('Your browser does not support copying images to clipboard. Try the "Save Image" button instead.');
                    }
                }, 'image/png');
            });
        }
        
        function generateShareCanvas(callback) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size (good for Twitter)
            canvas.width = 800;
            canvas.height = 500;
            
            // Draw background gradient
            const gradient = ctx.createLinearGradient(0, 0, 800, 500);
            gradient.addColorStop(0, '#0a0a0f');
            gradient.addColorStop(0.5, '#1a1025');
            gradient.addColorStop(1, '#0f1020');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 800, 500);
            
            // Add subtle border
            ctx.strokeStyle = '#2a2a3a';
            ctx.lineWidth = 2;
            ctx.strokeRect(10, 10, 780, 480);
            
            const ownedCount = Object.keys(walletBadges).length + vibeBountyHunterCount;
            const completion = Math.round((ownedCount / TOTAL_BADGES) * 100);
            
            let titleText, statsText;
            if (shareMode === 'owned') {
                titleText = '🤙 My GVC Badge Collection';
                statsText = walletNFTs.length + ' NFTs  •  ' + ownedCount + ' Badges  •  ' + completion + '% Complete';
            } else {
                titleText = "🔍 Badges I'm Hunting";
                statsText = (TOTAL_BADGES - ownedCount) + ' Missing  •  ' + ownedCount + '/' + TOTAL_BADGES + ' Collected';
            }
            
            // Function to draw everything after image loads (or without image)
            function drawContent(nftImg) {
                // Draw NFT image if available (centered near top)
                if (nftImg) {
                    const imgSize = 140;
                    const imgX = 400 - imgSize/2;
                    const imgY = 40;
                    
                    // Draw rounded rectangle clip for image
                    ctx.save();
                    ctx.beginPath();
                    ctx.roundRect(imgX, imgY, imgSize, imgSize, 16);
                    ctx.closePath();
                    ctx.clip();
                    ctx.drawImage(nftImg, imgX, imgY, imgSize, imgSize);
                    ctx.restore();
                    
                    // Draw gold border
                    ctx.strokeStyle = '#ffd700';
                    ctx.lineWidth = 4;
                    ctx.beginPath();
                    ctx.roundRect(imgX, imgY, imgSize, imgSize, 16);
                    ctx.stroke();
                }
                
                const startY = nftImg ? 210 : 100;
                
                // Draw title
                ctx.font = 'bold 32px Inter, Arial, sans-serif';
                ctx.fillStyle = '#ffffff';
                ctx.textAlign = 'center';
                ctx.fillText(titleText, 400, startY);
                
                // Draw stats
                ctx.font = '18px Inter, Arial, sans-serif';
                ctx.fillStyle = '#888899';
                ctx.fillText(statsText, 400, startY + 40);
                
                // Draw "Featured Badges" label
                ctx.font = '16px Inter, Arial, sans-serif';
                ctx.fillStyle = shareMode === 'owned' ? '#00d4ff' : '#ff44aa';
                ctx.fillText(shareMode === 'owned' ? '✨ Featured Badges' : '🎯 Most Wanted', 400, startY + 90);
                
                // Draw badges in a nice grid
                ctx.font = '15px Inter, Arial, sans-serif';
                const badgesToDraw = selectedShareBadges.slice(0, 6);
                const cols = 2;
                const rows = Math.ceil(badgesToDraw.length / cols);
                const badgeStartY = startY + 120;
                const colWidth = 300;
                const rowHeight = 32;
                
                badgesToDraw.forEach((badge, i) => {
                    const col = i % cols;
                    const row = Math.floor(i / cols);
                    const x = 400 + (col - 0.5) * colWidth;
                    const y = badgeStartY + row * rowHeight;
                    
                    // Get badge color
                    const color = getBadgeColor(badge);
                    if (color.includes('gradient')) {
                        ctx.fillStyle = '#00d4ff'; // Fallback for gradients
                    } else {
                        ctx.fillStyle = color;
                    }
                    
                    ctx.textAlign = 'center';
                    ctx.fillText('• ' + formatBadgeName(badge), x, y);
                });
                
                // Draw footer
                ctx.font = 'bold 16px Inter, Arial, sans-serif';
                ctx.fillStyle = '#00d4ff';
                ctx.fillText('gvcbadges.com', 400, 460);
                
                // Draw GVC branding
                ctx.font = '12px Inter, Arial, sans-serif';
                ctx.fillStyle = '#666677';
                ctx.fillText('Good Vibes Club Badge Lookup', 400, 480);
                
                // Return canvas via callback
                callback(canvas);
            }
            
            // Try to load NFT image
            const nftImgUrl = selectedShareNft ? (imageData[selectedShareNft] || imageData[String(selectedShareNft)]) : null;
            
            if (nftImgUrl) {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = function() {
                    drawContent(img);
                };
                img.onerror = function() {
                    console.log('Could not load NFT image, drawing without it');
                    drawContent(null);
                };
                img.src = nftImgUrl;
            } else {
                drawContent(null);
            }
        }
        
        function downloadShareImage() {
            const btn = document.querySelector('.share-action-btn.download');
            const originalText = btn.textContent;
            btn.textContent = '⏳ Creating...';
            
            generateShareCanvas(function(canvas) {
                triggerDownload(canvas);
                btn.textContent = '✓ Saved!';
                setTimeout(function() {
                    btn.textContent = originalText;
                }, 2000);
            });
        }
        
        function triggerDownload(canvas) {
            const link = document.createElement('a');
            link.download = 'gvc-badges-' + (shareMode === 'owned' ? 'collection' : 'hunting') + '.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
        
        // ========================================
        // WALLET COMPARISON
        // ========================================
        function showCompareModal() {
            const modal = document.getElementById('compareModal');
            const input = document.getElementById('compareWalletInput');
            
            // Load last compared wallet from localStorage
            const lastCompare = localStorage.getItem('gvc_last_compare_wallet');
            if (lastCompare) {
                input.value = lastCompare;
            }
            
            // Reset results visibility
            document.getElementById('compareResults').classList.remove('active');
            document.getElementById('compareLoading').style.display = 'none';
            
            modal.classList.add('active');
            input.focus();
        }
        
        function closeCompareModal(event) {
            if (!event || event.target === document.getElementById('compareModal')) {
                document.getElementById('compareModal').classList.remove('active');
            }
        }
        
        async function runComparison() {
            const input = document.getElementById('compareWalletInput');
            const address = input.value.trim();
            
            if (!address) {
                alert('Please enter a wallet address or ENS name');
                return;
            }
            
            // Save to localStorage
            localStorage.setItem('gvc_last_compare_wallet', address);
            
            // Show loading
            document.getElementById('compareResults').classList.remove('active');
            document.getElementById('compareLoading').style.display = 'block';
            
            try {
                // Fetch their NFTs using same method as main lookup
                const theirNFTs = await fetchWalletNFTsForCompare(address);
                
                if (!theirNFTs || theirNFTs.length === 0) {
                    throw new Error('No GVC NFTs found for this wallet');
                }
                
                // Process their badges
                const theirBadges = {};
                const theirTokenToBadges = {};
                
                // Build their badge ownership
                theirNFTs.forEach(function(tokenId) {
                    theirTokenToBadges[tokenId] = [];
                    
                    Object.entries(badgeData).forEach(function([badge, tokens]) {
                        const tokenList = Array.isArray(tokens) ? tokens : Object.keys(tokens).map(Number);
                        if (tokenList.includes(Number(tokenId)) || tokenList.includes(String(tokenId))) {
                            if (!theirBadges[badge]) theirBadges[badge] = [];
                            theirBadges[badge].push(tokenId);
                            theirTokenToBadges[tokenId].push(badge);
                        }
                    });
                });
                
                // Store comparison data
                compareWalletData = {
                    address: address,
                    nfts: theirNFTs,
                    badges: theirBadges,
                    tokenToBadges: theirTokenToBadges
                };
                
                // Render comparison
                renderComparison();
                
            } catch (error) {
                console.error('Comparison error:', error);
                alert('Error: ' + error.message);
                document.getElementById('compareLoading').style.display = 'none';
            }
        }
        
        // Separate fetch function for comparison (doesn't modify global resolvedAddresses)
        async function fetchWalletNFTsForCompare(addressOrENS) {
            let address = addressOrENS;
            
            // Resolve ENS if needed
            if (addressOrENS.includes('.')) {
                try {
                    const ensResponse = await fetch('https://api.ensideas.com/ens/resolve/' + addressOrENS);
                    const ensData = await ensResponse.json();
                    if (ensData.address) {
                        address = ensData.address;
                        // Update the stored address to show resolved ENS
                        compareWalletData.address = addressOrENS + ' (' + address.slice(0, 6) + '...' + address.slice(-4) + ')';
                    }
                } catch (e) {
                    console.log('ENS resolution failed, trying as address');
                }
            }
            
            const CONTRACT = '0xb8ea78fcacef50d41375e44e6814ebba36bb33c4';
            
            // Try Reservoir API first
            try {
                const reservoirUrl = 'https://api.reservoir.tools/users/' + address + '/tokens/v7?collection=' + CONTRACT + '&limit=200';
                console.log('Compare - Trying Reservoir:', reservoirUrl);
                const response = await fetch(reservoirUrl);
                const data = await response.json();
                
                if (data.tokens && data.tokens.length > 0) {
                    const tokens = data.tokens.map(t => t.token.tokenId);
                    console.log('Compare - Found ' + tokens.length + ' NFTs via Reservoir');
                    return tokens;
                }
            } catch (e) {
                console.log('Compare - Reservoir failed:', e);
            }
            
            // Fallback to Alchemy
            try {
                const alchemyUrl = 'https://eth-mainnet.g.alchemy.com/nft/v3/demo/getNFTsForOwner?owner=' + address + '&contractAddresses[]=' + CONTRACT + '&withMetadata=false';
                console.log('Compare - Trying Alchemy:', alchemyUrl);
                const response = await fetch(alchemyUrl);
                const data = await response.json();
                
                if (data.ownedNfts && data.ownedNfts.length > 0) {
                    const tokens = data.ownedNfts.map(nft => nft.tokenId);
                    console.log('Compare - Found ' + tokens.length + ' NFTs via Alchemy');
                    return tokens;
                }
            } catch (e) {
                console.log('Compare - Alchemy failed:', e);
            }
            
            return [];
        }
        
        function renderComparison() {
            // Hide loading
            document.getElementById('compareLoading').style.display = 'none';
            
            // Truncate addresses for display
            const yourAddr = walletNFTs.length > 0 ? truncateAddress(document.getElementById('walletInput').value) : 'Your Wallet';
            const theirAddr = truncateAddress(compareWalletData.address);
            
            document.getElementById('compareYouAddress').textContent = yourAddr;
            document.getElementById('compareThemAddress').textContent = theirAddr;
            
            // Calculate badge differences
            const yourBadges = new Set(Object.keys(walletBadges));
            const theirBadges = new Set(Object.keys(compareWalletData.badges));
            
            // Filter out meta badges for cleaner comparison
            const filterMeta = (badge) => !badge.startsWith('collection_') && !badge.startsWith('vibestr_') && !COMBO_BADGES.some(cb => cb.name === badge);
            
            // They have, you need (in their set but not yours)
            const theyHaveYouNeed = [...theirBadges].filter(b => !yourBadges.has(b) && filterMeta(b));
            
            // You have, they need (in your set but not theirs)
            const youHaveTheyNeed = [...yourBadges].filter(b => !theirBadges.has(b) && filterMeta(b));
            
            // Shared badges (in both sets)
            const sharedBadges = [...yourBadges].filter(b => theirBadges.has(b) && filterMeta(b));
            
            // Sort all by rarity
            theyHaveYouNeed.sort((a, b) => getBadgeRarity(a) - getBadgeRarity(b));
            youHaveTheyNeed.sort((a, b) => getBadgeRarity(a) - getBadgeRarity(b));
            sharedBadges.sort((a, b) => getBadgeRarity(a) - getBadgeRarity(b));
            
            // === HIGH VALUE TARGETS ===
            // Analyze their NFTs for ones with multiple badges you need
            const badgesYouNeedSet = new Set(theyHaveYouNeed);
            const highValueTargets = [];
            
            compareWalletData.nfts.forEach(function(tokenId) {
                const theirTokenBadges = compareWalletData.tokenToBadges[tokenId] || [];
                const badgesYouNeedFromThis = theirTokenBadges.filter(b => badgesYouNeedSet.has(b));
                
                if (badgesYouNeedFromThis.length >= 2) {
                    highValueTargets.push({
                        tokenId: tokenId,
                        badges: badgesYouNeedFromThis,
                        count: badgesYouNeedFromThis.length
                    });
                }
            });
            
            // Sort by badge count (most valuable first)
            highValueTargets.sort((a, b) => b.count - a.count);
            
            // Update counts
            document.getElementById('countTargets').textContent = highValueTargets.length;
            document.getElementById('countTheyHave').textContent = theyHaveYouNeed.length;
            document.getElementById('countYouHave').textContent = youHaveTheyNeed.length;
            document.getElementById('countShared').textContent = sharedBadges.length;
            
            // Show/hide targets section based on results
            const targetsSection = document.getElementById('sectionTargets');
            if (highValueTargets.length === 0) {
                targetsSection.style.display = 'none';
            } else {
                targetsSection.style.display = 'block';
                renderHighValueTargets(highValueTargets);
            }
            
            // Render badge grids
            renderCompareGrid('gridTheyHave', theyHaveYouNeed, 'them');
            renderCompareGrid('gridYouHave', youHaveTheyNeed, 'you');
            renderCompareGrid('gridShared', sharedBadges, 'both');
            
            // Show results
            document.getElementById('compareResults').classList.add('active');
        }
        
        function renderHighValueTargets(targets) {
            const grid = document.getElementById('gridTargets');
            
            grid.innerHTML = targets.map(function(target) {
                const imgUrl = imageData[target.tokenId] || imageData[String(target.tokenId)];
                
                const badgeTags = target.badges.map(function(badge) {
                    const color = getBadgeColor(badge);
                    const style = color.includes('gradient') 
                        ? 'background: ' + color + '; -webkit-background-clip: text; -webkit-text-fill-color: transparent;'
                        : 'color: ' + color + ';';
                    return '<span class="target-badge-tag" style="' + style + '">' + formatBadgeName(badge) + '</span>';
                }).join('');
                
                return '<div class="target-nft-card">' +
                    (imgUrl ? '<img class="target-nft-img" src="' + imgUrl + '" alt="#' + target.tokenId + '">' : '<div class="target-nft-img" style="background:var(--bg-hover);display:flex;align-items:center;justify-content:center;">#' + target.tokenId + '</div>') +
                    '<div class="target-nft-info">' +
                        '<div class="target-nft-header">' +
                            '<span class="target-nft-id">GVC #' + target.tokenId + '</span>' +
                            '<span class="target-nft-count">' + target.count + ' badges you need!</span>' +
                        '</div>' +
                        '<div class="target-nft-badges">' + badgeTags + '</div>' +
                    '</div>' +
                '</div>';
            }).join('');
        }
        
        function renderCompareGrid(gridId, badges, owner) {
            const grid = document.getElementById(gridId);
            
            if (badges.length === 0) {
                grid.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 16px;">None found</p>';
                return;
            }
            
            grid.innerHTML = badges.map(function(badge) {
                const color = getBadgeColor(badge);
                const isGradient = color.includes('gradient');
                const nameStyle = isGradient 
                    ? 'background: ' + color + '; -webkit-background-clip: text; -webkit-text-fill-color: transparent;'
                    : 'color: ' + color + ';';
                
                const rarity = getBadgeRarity(badge);
                const rarityClass = rarity < 50 ? 'rare' : '';
                const rarityText = rarity < 9999 ? rarity + ' NFTs have this' : '';
                
                // Get NFT images
                let nftHtml = '';
                if (owner === 'them' || owner === 'both') {
                    const theirTokens = compareWalletData.badges[badge] || [];
                    theirTokens.slice(0, 2).forEach(function(tokenId) {
                        const imgUrl = imageData[tokenId] || imageData[String(tokenId)];
                        if (imgUrl) {
                            nftHtml += '<img class="compare-badge-nft them" src="' + imgUrl + '" alt="#' + tokenId + '" title="Their #' + tokenId + '">';
                        }
                    });
                }
                if (owner === 'you' || owner === 'both') {
                    const yourTokens = walletBadges[badge] || [];
                    yourTokens.slice(0, 2).forEach(function(tokenId) {
                        const imgUrl = imageData[tokenId] || imageData[String(tokenId)];
                        if (imgUrl) {
                            nftHtml += '<img class="compare-badge-nft you" src="' + imgUrl + '" alt="#' + tokenId + '" title="Your #' + tokenId + '">';
                        }
                    });
                }
                
                return '<div class="compare-badge-card">' +
                    '<div class="compare-badge-nfts">' + nftHtml + '</div>' +
                    '<div class="compare-badge-info">' +
                        '<div class="compare-badge-name" style="' + nameStyle + '">' + formatBadgeName(badge) + '</div>' +
                        '<div class="compare-badge-rarity ' + rarityClass + '">' + rarityText + '</div>' +
                    '</div>' +
                '</div>';
            }).join('');
        }
        
        function truncateAddress(address) {
            if (!address) return '-';
            if (address.includes('.')) return address; // ENS name
            if (address.length > 12) {
                return address.slice(0, 6) + '...' + address.slice(-4);
            }
            return address;
        }
        
        function toggleCompareSection(section) {
            const content = document.getElementById('content' + section.charAt(0).toUpperCase() + section.slice(1));
            const toggle = document.getElementById('toggle' + section.charAt(0).toUpperCase() + section.slice(1));
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                toggle.textContent = '▶';
            } else {
                content.classList.add('expanded');
                toggle.textContent = '▼';
            }
        }
        
        function copyTradeSummary() {
            const yourAddr = document.getElementById('walletInput').value || 'Your Wallet';
            const theirAddr = compareWalletData.address || 'Their Wallet';
            
            const yourBadges = new Set(Object.keys(walletBadges));
            const theirBadges = new Set(Object.keys(compareWalletData.badges));
            
            const filterMeta = (badge) => !badge.startsWith('collection_') && !badge.startsWith('vibestr_') && !COMBO_BADGES.some(cb => cb.name === badge);
            
            const theyHaveYouNeed = [...theirBadges].filter(b => !yourBadges.has(b) && filterMeta(b));
            const youHaveTheyNeed = [...yourBadges].filter(b => !theirBadges.has(b) && filterMeta(b));
            
            theyHaveYouNeed.sort((a, b) => getBadgeRarity(a) - getBadgeRarity(b));
            youHaveTheyNeed.sort((a, b) => getBadgeRarity(a) - getBadgeRarity(b));
            
            // Find high value targets
            const badgesYouNeedSet = new Set(theyHaveYouNeed);
            const highValueTargets = [];
            
            compareWalletData.nfts.forEach(function(tokenId) {
                const theirTokenBadges = compareWalletData.tokenToBadges[tokenId] || [];
                const badgesYouNeedFromThis = theirTokenBadges.filter(b => badgesYouNeedSet.has(b));
                
                if (badgesYouNeedFromThis.length >= 2) {
                    highValueTargets.push({
                        tokenId: tokenId,
                        badges: badgesYouNeedFromThis,
                        count: badgesYouNeedFromThis.length
                    });
                }
            });
            highValueTargets.sort((a, b) => b.count - a.count);
            
            let text = '🔄 GVC Badge Trade Comparison\n\n';
            text += '👤 ' + yourAddr + ' ←→ ' + theirAddr + '\n\n';
            
            // High value targets
            if (highValueTargets.length > 0) {
                text += '🎯 HIGH VALUE TARGETS:\n';
                highValueTargets.slice(0, 5).forEach(function(t) {
                    text += '• GVC #' + t.tokenId + ' (' + t.count + ' badges): ' + t.badges.map(b => formatBadgeName(b)).join(', ') + '\n';
                });
                text += '\n';
            }
            
            text += '🎯 They have, I need (' + theyHaveYouNeed.length + '):\n';
            theyHaveYouNeed.slice(0, 6).forEach(function(b) {
                text += '• ' + formatBadgeName(b) + '\n';
            });
            if (theyHaveYouNeed.length > 6) text += '...and ' + (theyHaveYouNeed.length - 6) + ' more\n';
            
            text += '\n💎 I have, they need (' + youHaveTheyNeed.length + '):\n';
            youHaveTheyNeed.slice(0, 6).forEach(function(b) {
                text += '• ' + formatBadgeName(b) + '\n';
            });
            if (youHaveTheyNeed.length > 6) text += '...and ' + (youHaveTheyNeed.length - 6) + ' more\n';
            
            text += '\nGenerated at gvcbadges.com';
            
            navigator.clipboard.writeText(text).then(function() {
                const btn = document.querySelector('.compare-trade-btn.copy');
                const originalText = btn.textContent;
                btn.textContent = '✓ Copied!';
                setTimeout(function() {
                    btn.textContent = originalText;
                }, 2000);
            });
        }
        
        // ========================================
        // BADGE EXPLORER
        // ========================================
        
        // Badge category mapping
        const BADGE_CATEGORIES = {
            // Type badges
            'any_gvc': 'type', 'rainbow_citizen': 'type', 'gold_member': 'type', 
            'grayscale_seeker': 'type', 'robot_lover': 'type', 'plastic_lover': 'type', 
            'gradient_lover': 'type',
            
            // Collection badges
            'multi_type_master': 'collection', 'five_badges': 'collection', 'ten_badges': 'collection',
            'fifteen_badges': 'collection', 'twenty_badges': 'collection', 'thirty_badges': 'collection',
            'forty_badges': 'collection', 'fifty_badges': 'collection', 'gradient_hatrick': 'collection',
            'plastic_hatrick': 'collection', 'robot_hatrick': 'collection', 'gradient_high_five': 'collection',
            'plastic_high_five': 'collection', 'robot_high_five': 'collection', 'yin_n_yang': 'collection',
            'power_duo': 'collection', 'chris_favorite_badge': 'collection', 'elite_rainbow_ranger': 'collection',
            'collection_5': 'collection', 'collection_10': 'collection', 'collection_15': 'collection',
            'collection_20': 'collection', 'collection_30': 'collection', 'collection_40': 'collection',
            'collection_50': 'collection',
            
            // VIBESTR badges
            'vibestr_blue_tier': 'vibestr', 'vibestr_pink_tier': 'vibestr', 'vibestr_purple_tier': 'vibestr',
            'vibestr_bronze_tier': 'vibestr', 'vibestr_silver_tier': 'vibestr', 'vibestr_gold_tier': 'vibestr',
            'vibestr_diamond_tier': 'vibestr', 'vibestr_cosmic_tier': 'vibestr', 'vibestr_bounty_hunter': 'vibestr',
            'mountain_goat': 'vibestr'
        };
        
        function getBadgeCategory(badge) {
            return BADGE_CATEGORIES[badge] || 'trait';
        }
        
        function getAllBadges() {
            // Get all badges from badgeData plus known special badges
            const badges = new Set(Object.keys(badgeData));
            
            // Add VIBESTR badges
            ['vibestr_blue_tier', 'vibestr_pink_tier', 'vibestr_purple_tier', 'vibestr_bronze_tier',
             'vibestr_silver_tier', 'vibestr_gold_tier', 'vibestr_diamond_tier', 'vibestr_cosmic_tier',
             'vibestr_bounty_hunter', 'mountain_goat'].forEach(b => badges.add(b));
            
            // Add collection badges
            ['collection_5', 'collection_10', 'collection_15', 'collection_20', 
             'collection_30', 'collection_40', 'collection_50'].forEach(b => badges.add(b));
            
            return Array.from(badges);
        }
        
        function renderBadgeExplorer() {
            filterBadgeExplorer();
        }
        
        function filterBadgeExplorer() {
            const searchTerm = document.getElementById('badgeExplorerSearch').value.toLowerCase();
            const categoryFilter = document.getElementById('badgeExplorerFilter').value;
            const sortMode = document.getElementById('badgeExplorerSort').value;
            
            let badges = getAllBadges();
            
            // Filter by search
            if (searchTerm) {
                badges = badges.filter(b => {
                    const name = formatBadgeName(b).toLowerCase();
                    return name.includes(searchTerm);
                });
            }
            
            // Filter by category
            if (categoryFilter !== 'all') {
                badges = badges.filter(b => getBadgeCategory(b) === categoryFilter);
            }
            
            // Sort
            if (sortMode === 'rarity') {
                badges.sort((a, b) => getBadgeRarity(a) - getBadgeRarity(b));
            } else if (sortMode === 'rarity-desc') {
                badges.sort((a, b) => getBadgeRarity(b) - getBadgeRarity(a));
            } else if (sortMode === 'alpha') {
                badges.sort((a, b) => formatBadgeName(a).localeCompare(formatBadgeName(b)));
            }
            
            // Update owned stat
            const ownedCount = countOwnedBadges(badges);
            const ownedStat = document.getElementById('explorerOwnedStat');
            if (Object.keys(walletBadges).length > 0 || ownedTypesGlobal.length > 0) {
                ownedStat.innerHTML = '✅ <strong>' + ownedCount + '</strong> owned';
                ownedStat.style.display = 'inline-flex';
            }
            
            // Render
            const grid = document.getElementById('badgeExplorerGrid');
            renderBadgeExplorerGrid(grid, badges);
        }
        
        function showBadgeDetail(badge) {
            // For now, show the NFTs that have this badge (reuse existing function)
            const isMeta = badge.startsWith('collection_') || badge.startsWith('vibestr_') || 
                           COMBO_BADGES.some(cb => cb.name === badge);
            
            if (!isMeta && badgeData[badge]) {
                // Close the badge explorer modal first
                closeBadgeExplorerModal();
                // Small delay to let it close, then show NFTs
                setTimeout(function() {
                    showBadgeNFTs(badge, !!walletBadges[badge]);
                }, 100);
            }
        }
        
        // Initialize badge explorer when badge data loads
        function initBadgeExplorer() {
            if (Object.keys(badgeData).length > 0) {
                renderBadgeExplorer();
            }
        }
        
        // Hide badge explorer section and show button after wallet lookup
        function hideBadgeExplorerShowButton() {
            const explorer = document.getElementById('badgeExplorerSection');
            const btn = document.getElementById('badgeExplorerBtn');
            
            if (explorer) {
                explorer.style.display = 'none';
            }
            if (btn) {
                btn.style.display = 'block';
            }
        }
        
        // Show badge explorer modal
        function showBadgeExplorerModal() {
            filterBadgeExplorerModal();
            document.getElementById('badgeExplorerModal').classList.add('active');
        }
        
        // Close badge explorer modal
        function closeBadgeExplorerModal(event) {
            if (!event || event.target === document.getElementById('badgeExplorerModal')) {
                document.getElementById('badgeExplorerModal').classList.remove('active');
            }
        }
        
        // Filter for modal version
        function filterBadgeExplorerModal() {
            const searchTerm = document.getElementById('badgeExplorerSearchModal').value.toLowerCase();
            const categoryFilter = document.getElementById('badgeExplorerFilterModal').value;
            const sortMode = document.getElementById('badgeExplorerSortModal').value;
            
            let badges = getAllBadges();
            
            // Filter by search
            if (searchTerm) {
                badges = badges.filter(b => {
                    const name = formatBadgeName(b).toLowerCase();
                    return name.includes(searchTerm);
                });
            }
            
            // Filter by category
            if (categoryFilter !== 'all') {
                badges = badges.filter(b => getBadgeCategory(b) === categoryFilter);
            }
            
            // Sort
            if (sortMode === 'rarity') {
                badges.sort((a, b) => getBadgeRarity(a) - getBadgeRarity(b));
            } else if (sortMode === 'rarity-desc') {
                badges.sort((a, b) => getBadgeRarity(b) - getBadgeRarity(a));
            } else if (sortMode === 'alpha') {
                badges.sort((a, b) => formatBadgeName(a).localeCompare(formatBadgeName(b)));
            }
            
            // Count owned (including VIBESTR badges from ownedTypesGlobal check)
            const ownedCount = countOwnedBadges(badges);
            const ownedStat = document.getElementById('explorerOwnedStatModal');
            if (Object.keys(walletBadges).length > 0 || ownedTypesGlobal.length > 0) {
                ownedStat.innerHTML = '✅ <strong>' + ownedCount + '</strong> owned';
                ownedStat.style.display = 'inline-flex';
            }
            
            // Render
            const grid = document.getElementById('badgeExplorerGridModal');
            renderBadgeExplorerGrid(grid, badges);
        }
        
        // Count owned badges properly (including VIBESTR)
        function countOwnedBadges(badges) {
            let count = 0;
            badges.forEach(b => {
                if (isBadgeOwned(b)) count++;
            });
            return count;
        }
        
        // Check if a badge is owned (works for all badge types)
        function isBadgeOwned(badge) {
            // Check walletBadges first
            if (walletBadges[badge]) return true;
            
            // Check VIBESTR badges
            if (badge.startsWith('vibestr_') && window.vibestrBadgesOwned && window.vibestrBadgesOwned.includes(badge)) {
                return true;
            }
            
            // Check collection badges
            if (badge.startsWith('collection_')) {
                const num = parseInt(badge.split('_')[1]);
                const ownedCount = Object.keys(walletBadges).length;
                if (ownedCount >= num) return true;
            }
            
            return false;
        }
        
        // Render badge grid (shared between section and modal)
        function renderBadgeExplorerGrid(grid, badges) {
            if (badges.length === 0) {
                grid.innerHTML = '<div class="explorer-empty">No badges found matching your search</div>';
                return;
            }
            
            grid.innerHTML = badges.map(function(badge) {
                const imgUrl = getBadgeImage(badge);
                const color = getBadgeColor(badge);
                const isGradient = color.includes('gradient');
                const nameStyle = isGradient 
                    ? 'background: ' + color + '; -webkit-background-clip: text; -webkit-text-fill-color: transparent;'
                    : 'color: ' + color + ';';
                
                const category = getBadgeCategory(badge);
                const rarity = getBadgeRarity(badge);
                const isOwned = isBadgeOwned(badge);
                const isRare = rarity < 100;
                
                const imgHtml = imgUrl 
                    ? '<img class="explorer-badge-img" src="' + imgUrl + '" alt="">'
                    : '<div class="explorer-badge-img" style="background:var(--bg-card);display:flex;align-items:center;justify-content:center;font-size:10px;color:var(--text-secondary);">?</div>';
                
                return '<div class="explorer-badge-card' + (isOwned ? ' owned' : '') + '" onclick="showBadgeDetail(\'' + badge + '\')">' +
                    imgHtml +
                    '<div class="explorer-badge-info">' +
                        '<div class="explorer-badge-name" style="' + nameStyle + '">' + formatBadgeName(badge) + '</div>' +
                        '<div class="explorer-badge-meta">' +
                            '<span class="explorer-badge-category ' + category + '">' + category.charAt(0).toUpperCase() + category.slice(1) + '</span>' +
                            '<span class="explorer-badge-rarity' + (isRare ? ' rare' : '') + '">' + (rarity < 9999 ? rarity + ' NFTs' : '—') + '</span>' +
                            (isOwned ? '<span class="explorer-badge-owned">✓ Owned</span>' : '') +
                        '</div>' +
                    '</div>' +
                '</div>';
            }).join('');
        }
        
        // ========================================
        // NFT LOOKUP
        // ========================================
        function lookupNFT() {
            const input = document.getElementById('nftLookupInput');
            const tokenId = parseInt(input.value);
            
            if (!tokenId || tokenId < 1 || tokenId > 10000) {
                alert('Please enter a valid token ID (1-10000)');
                return;
            }
            
            // Get badges for this NFT
            const badges = [];
            Object.entries(badgeData).forEach(function([badge, tokens]) {
                const tokenList = Array.isArray(tokens) ? tokens : Object.keys(tokens).map(Number);
                if (tokenList.includes(tokenId) || tokenList.includes(String(tokenId))) {
                    badges.push(badge);
                }
            });
            
            // Sort by rarity
            badges.sort((a, b) => getBadgeRarity(a) - getBadgeRarity(b));
            
            // Get image
            const imgUrl = imageData[tokenId] || imageData[String(tokenId)];
            
            // Calculate what-if badges (if user has looked up a wallet)
            let whatIfBadges = [];
            if (Object.keys(walletBadges).length > 0) {
                whatIfBadges = badges.filter(b => !walletBadges[b]);
            }
            
            // Render result
            renderNFTLookupResult(tokenId, badges, imgUrl, whatIfBadges);
        }
        
        function renderNFTLookupResult(tokenId, badges, imgUrl, whatIfBadges) {
            const container = document.getElementById('nftLookupResult');
            
            const badgesHtml = badges.length > 0 
                ? badges.map(function(badge) {
                    const color = getBadgeColor(badge);
                    const isGradient = color.includes('gradient');
                    const nameStyle = isGradient 
                        ? 'background: ' + color + '; -webkit-background-clip: text; -webkit-text-fill-color: transparent;'
                        : 'color: ' + color + ';';
                    const rarity = getBadgeRarity(badge);
                    const rarityClass = rarity < 50 ? 'rare' : '';
                    const badgeImgUrl = getBadgeImage(badge);
                    const imgHtml = badgeImgUrl ? '<img class="badge-img small" src="' + badgeImgUrl + '" alt="">' : '';
                    
                    return '<div class="nft-lookup-badge">' +
                        imgHtml +
                        '<span style="' + nameStyle + '">' + formatBadgeName(badge) + '</span>' +
                        '<span class="nft-lookup-badge-rarity ' + rarityClass + '">(' + rarity + ' NFTs)</span>' +
                        '</div>';
                }).join('')
                : '<span class="nft-lookup-no-badges">No trait badges found for this NFT</span>';
            
            let whatIfHtml = '';
            if (Object.keys(walletBadges).length > 0) {
                if (whatIfBadges.length > 0) {
                    whatIfHtml = '<div class="nft-lookup-whatif">' +
                        '<div class="nft-lookup-whatif-title">✨ New badges you\'d gain:</div>' +
                        '<div class="nft-lookup-whatif-badges">' +
                        whatIfBadges.map(function(badge) {
                            const color = getBadgeColor(badge);
                            const style = color.includes('gradient') 
                                ? 'background: ' + color + '; -webkit-background-clip: text; -webkit-text-fill-color: transparent;'
                                : 'color: ' + color + ';';
                            return '<span class="nft-lookup-whatif-badge" style="' + style + '">' + formatBadgeName(badge) + '</span>';
                        }).join('') +
                        '</div></div>';
                } else if (badges.length > 0) {
                    whatIfHtml = '<div class="nft-lookup-whatif">' +
                        '<div class="nft-lookup-whatif-none">✓ You already have all badges from this NFT</div>' +
                        '</div>';
                }
            }
            
            container.innerHTML = '<div class="nft-lookup-card">' +
                '<div class="nft-lookup-image">' +
                (imgUrl ? '<img src="' + imgUrl + '" alt="GVC #' + tokenId + '">' : '<div style="width:160px;height:160px;background:var(--bg-card);border-radius:12px;display:flex;align-items:center;justify-content:center;border:3px solid var(--accent-cyan);">No Image</div>') +
                '</div>' +
                '<div class="nft-lookup-info">' +
                '<div class="nft-lookup-title">GVC #' + tokenId + '</div>' +
                '<div class="nft-lookup-stats">' +
                '<div class="nft-lookup-stat">🏅 <strong>' + badges.length + '</strong> badges</div>' +
                (badges.length > 0 ? '<div class="nft-lookup-stat">💎 Rarest: <strong>' + getBadgeRarity(badges[0]) + '</strong> NFTs</div>' : '') +
                '</div>' +
                '<div class="nft-lookup-badges-title">Badges on this NFT:</div>' +
                '<div class="nft-lookup-badges">' + badgesHtml + '</div>' +
                whatIfHtml +
                '<div class="nft-lookup-opensea">' +
                '<a href="https://opensea.io/assets/ethereum/0xb8ea78fcacef50d41375e44e6814ebba36bb33c4/' + tokenId + '" target="_blank">View on OpenSea →</a>' +
                '</div>' +
                '</div>' +
                '</div>';
            
            container.classList.add('active');
        }
        
        // Add Enter key support for NFT lookup
        document.addEventListener('DOMContentLoaded', function() {
            const nftInput = document.getElementById('nftLookupInput');
            if (nftInput) {
                nftInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        lookupNFT();
                    }
                });
            }
        });
        
        // ========================================
        // TRADE OFFER BUILDER
        // ========================================
        function showTradeOfferBuilder() {
            // Reset state
            tradeOfferData = {
                yourNfts: [],
                theirNfts: [],
                yourEth: 0,
                theirEth: 0,
                yourCustomImages: [],
                theirCustomImages: []
            };
            
            // Reset inputs
            document.getElementById('tradeYourEth').value = '';
            document.getElementById('tradeTheirEth').value = '';
            
            // Reset custom image grids
            renderCustomImages('yours');
            renderCustomImages('theirs');
            
            // Build NFT pickers with badge analysis
            buildTradeNftPicker('tradeYourPicker', walletNFTs, 'yours');
            buildTradeNftPicker('tradeTheirPicker', compareWalletData.nfts, 'theirs');
            
            // Update selected displays
            updateTradeSelectedDisplay('yours');
            updateTradeSelectedDisplay('theirs');
            
            // Update preview
            updateTradePreview();
            
            // Show modal
            document.getElementById('tradeOfferModal').classList.add('active');
        }
        
        function closeTradeOfferModal(event) {
            if (!event || event.target === document.getElementById('tradeOfferModal')) {
                document.getElementById('tradeOfferModal').classList.remove('active');
            }
        }
        
        // Get badges that the other party needs from an NFT
        // This includes both trait badges AND potential combo badge contributions
        function getNftBadgesTheyNeed(tokenId, theirBadges, theirNfts) {
            const needed = [];
            
            // 1. Check trait badges
            const nftBadges = window.tokenToBadges ? window.tokenToBadges[String(tokenId)] : [];
            if (nftBadges) {
                nftBadges.forEach(badge => {
                    if (!theirBadges[badge]) {
                        needed.push(badge);
                    }
                });
            }
            
            // 2. Check if this NFT would help them earn combo badges
            const nftType = typeData[tokenId] || typeData[String(tokenId)];
            if (nftType && theirNfts) {
                // Get their current types
                const theirTypes = theirNfts.map(id => typeData[id] || typeData[String(id)]).filter(t => t);
                
                // Check hatrick/high five badges
                const prefixes = ['Gradient', 'Plastic', 'Robot'];
                prefixes.forEach(prefix => {
                    if (nftType.startsWith(prefix)) {
                        // Count their unique colors of this type
                        const theirUniqueColors = new Set(theirTypes.filter(t => t && t.startsWith(prefix)));
                        
                        // If adding this NFT gives them a new color
                        if (!theirUniqueColors.has(nftType)) {
                            const newCount = theirUniqueColors.size + 1;
                            
                            // Check hatrick (3 colors)
                            const hatrickBadge = prefix.toLowerCase() + '_hatrick';
                            if (newCount >= 3 && theirUniqueColors.size < 3 && !theirBadges[hatrickBadge]) {
                                needed.push(hatrickBadge);
                            }
                            
                            // Check high five (5 colors)
                            const highFiveBadge = prefix.toLowerCase() + '_high_five';
                            if (newCount >= 5 && theirUniqueColors.size < 5 && !theirBadges[highFiveBadge]) {
                                needed.push(highFiveBadge);
                            }
                        }
                    }
                });
                
                // Check multi_type_master
                if (!theirBadges['multi_type_master']) {
                    const hasPlastic = theirTypes.some(t => t && t.startsWith('Plastic'));
                    const hasGradient = theirTypes.some(t => t && t.startsWith('Gradient'));
                    const hasRobot = theirTypes.some(t => t && t.startsWith('Robot'));
                    
                    const wouldAdd = (nftType.startsWith('Plastic') && !hasPlastic) ||
                                    (nftType.startsWith('Gradient') && !hasGradient) ||
                                    (nftType.startsWith('Robot') && !hasRobot);
                    
                    if (wouldAdd) {
                        const newHasPlastic = hasPlastic || nftType.startsWith('Plastic');
                        const newHasGradient = hasGradient || nftType.startsWith('Gradient');
                        const newHasRobot = hasRobot || nftType.startsWith('Robot');
                        
                        if (newHasPlastic && newHasGradient && newHasRobot) {
                            needed.push('multi_type_master');
                        }
                    }
                }
                
                // Check yin_n_yang
                if (!theirBadges['yin_n_yang']) {
                    const hasGrayscale = theirTypes.some(t => t === 'Grayscale');
                    const hasRainbow = theirTypes.some(t => t === 'Rainbow');
                    
                    if ((nftType === 'Grayscale' && hasRainbow && !hasGrayscale) ||
                        (nftType === 'Rainbow' && hasGrayscale && !hasRainbow)) {
                        needed.push('yin_n_yang');
                    }
                }
                
                // Check power_duo (2 of same type)
                if (!theirBadges['power_duo']) {
                    if (theirTypes.includes(nftType)) {
                        needed.push('power_duo');
                    }
                }
                
                // Check chris_favorite (2 Grayscale)
                if (!theirBadges['chris_favorite'] && nftType === 'Grayscale') {
                    const grayscaleCount = theirTypes.filter(t => t === 'Grayscale').length;
                    if (grayscaleCount >= 1) {
                        needed.push('chris_favorite');
                    }
                }
            }
            
            return needed;
        }
        
        function buildTradeNftPicker(pickerId, nfts, side) {
            const picker = document.getElementById(pickerId);
            
            // Determine which badges the OTHER party needs
            const theirBadges = side === 'yours' ? compareWalletData.badges : walletBadges;
            const theirNfts = side === 'yours' ? compareWalletData.nfts : walletNFTs;
            
            // Categorize NFTs
            const valuableNfts = [];
            const otherNfts = [];
            
            nfts.forEach(function(tokenId) {
                const badgesTheyNeed = getNftBadgesTheyNeed(tokenId, theirBadges, theirNfts);
                if (badgesTheyNeed.length > 0) {
                    valuableNfts.push({ tokenId, badgeCount: badgesTheyNeed.length, badges: badgesTheyNeed });
                } else {
                    otherNfts.push({ tokenId, badgeCount: 0 });
                }
            });
            
            // Sort valuable NFTs by badge count (most valuable first)
            valuableNfts.sort((a, b) => b.badgeCount - a.badgeCount);
            
            let html = '';
            
            // Valuable section
            if (valuableNfts.length > 0) {
                const label = side === 'yours' ? 'Has badges they need' : 'Has badges you need';
                html += '<div class="trade-picker-section">' +
                    '<div class="trade-picker-section-label valuable">⭐ ' + label + ' <span class="badge-count">' + valuableNfts.length + '</span></div>' +
                    '<div class="trade-picker-nfts">';
                
                valuableNfts.forEach(function(item) {
                    const imgUrl = imageData[item.tokenId] || imageData[String(item.tokenId)];
                    const selectedArr = side === 'yours' ? tradeOfferData.yourNfts : tradeOfferData.theirNfts;
                    const selected = selectedArr.includes(String(item.tokenId));
                    
                    html += '<div class="trade-nft-option valuable ' + (selected ? 'selected' : '') + '" onclick="toggleTradeNft(\'' + item.tokenId + '\', \'' + side + '\')" title="GVC #' + item.tokenId + ' - ' + item.badgeCount + ' badge(s)">' +
                        (imgUrl ? '<img src="' + imgUrl + '" alt="#' + item.tokenId + '">' : '<div style="width:100%;height:100%;background:var(--bg-hover);display:flex;align-items:center;justify-content:center;font-size:9px;">#' + item.tokenId + '</div>') +
                        '<span class="badge-indicator">' + item.badgeCount + '</span>' +
                        '</div>';
                });
                
                html += '</div></div>';
            }
            
            // Other NFTs section
            if (otherNfts.length > 0) {
                html += '<div class="trade-picker-section">' +
                    '<div class="trade-picker-section-label">Other NFTs</div>' +
                    '<div class="trade-picker-nfts">';
                
                otherNfts.forEach(function(item) {
                    const imgUrl = imageData[item.tokenId] || imageData[String(item.tokenId)];
                    const selectedArr = side === 'yours' ? tradeOfferData.yourNfts : tradeOfferData.theirNfts;
                    const selected = selectedArr.includes(String(item.tokenId));
                    
                    html += '<div class="trade-nft-option ' + (selected ? 'selected' : '') + '" onclick="toggleTradeNft(\'' + item.tokenId + '\', \'' + side + '\')" title="GVC #' + item.tokenId + '">' +
                        (imgUrl ? '<img src="' + imgUrl + '" alt="#' + item.tokenId + '">' : '<div style="width:100%;height:100%;background:var(--bg-hover);display:flex;align-items:center;justify-content:center;font-size:9px;">#' + item.tokenId + '</div>') +
                        '</div>';
                });
                
                html += '</div></div>';
            }
            
            if (valuableNfts.length === 0 && otherNfts.length === 0) {
                html = '<div style="color: var(--text-secondary); font-size: 12px; padding: 12px;">No NFTs available</div>';
            }
            
            picker.innerHTML = html;
        }
        
        function toggleTradeNft(tokenId, side) {
            const arr = side === 'yours' ? tradeOfferData.yourNfts : tradeOfferData.theirNfts;
            const idx = arr.indexOf(String(tokenId));
            
            if (idx > -1) {
                arr.splice(idx, 1);
            } else {
                arr.push(String(tokenId));
            }
            
            // Rebuild picker to update selection state
            if (side === 'yours') {
                buildTradeNftPicker('tradeYourPicker', walletNFTs, 'yours');
            } else {
                buildTradeNftPicker('tradeTheirPicker', compareWalletData.nfts, 'theirs');
            }
            
            updateTradeSelectedDisplay(side);
            updateTradePreview();
        }
        
        function updateTradeSelectedDisplay(side) {
            const container = document.getElementById(side === 'yours' ? 'tradeYourSelected' : 'tradeTheirSelected');
            const nfts = side === 'yours' ? tradeOfferData.yourNfts : tradeOfferData.theirNfts;
            const customImages = side === 'yours' ? tradeOfferData.yourCustomImages : tradeOfferData.theirCustomImages;
            const selectedCustom = customImages.filter(img => img.selected);
            
            if (nfts.length === 0 && selectedCustom.length === 0) {
                container.innerHTML = '<span style="color: var(--text-secondary); font-size: 12px;">Click NFTs below to add</span>';
                return;
            }
            
            let html = nfts.map(function(tokenId) {
                const imgUrl = imageData[tokenId] || imageData[String(tokenId)];
                return '<div class="trade-selected-nft">' +
                    (imgUrl ? '<img src="' + imgUrl + '" alt="#' + tokenId + '">' : '<div style="width:48px;height:48px;background:var(--bg-card);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:10px;">#' + tokenId + '</div>') +
                    '<span>#' + tokenId + '</span>' +
                    '</div>';
            }).join('');
            
            // Add selected custom images
            selectedCustom.forEach(function(img, idx) {
                html += '<div class="trade-selected-nft">' +
                    '<img src="' + img.dataUrl + '" alt="Custom">' +
                    '<span>Custom</span>' +
                    '</div>';
            });
            
            container.innerHTML = html;
        }
        
        // Custom image upload functions
        function addCustomImage(side) {
            const inputId = side === 'yours' ? 'customImageInputYours' : 'customImageInputTheirs';
            document.getElementById(inputId).click();
        }
        
        function handleCustomImageUpload(event, side) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const customImages = side === 'yours' ? tradeOfferData.yourCustomImages : tradeOfferData.theirCustomImages;
                customImages.push({
                    dataUrl: e.target.result,
                    selected: true,  // Auto-select when added
                    id: Date.now()
                });
                
                renderCustomImages(side);
                updateTradeSelectedDisplay(side);
                updateTradePreview();
            };
            reader.readAsDataURL(file);
            
            // Reset input so same file can be added again
            event.target.value = '';
        }
        
        function renderCustomImages(side) {
            const containerId = side === 'yours' ? 'tradeYourCustom' : 'tradeTheirCustom';
            const container = document.getElementById(containerId);
            const customImages = side === 'yours' ? tradeOfferData.yourCustomImages : tradeOfferData.theirCustomImages;
            
            let html = '';
            
            customImages.forEach(function(img, idx) {
                html += '<div class="trade-custom-img ' + (img.selected ? 'selected' : '') + '" onclick="toggleCustomImage(\'' + side + '\', ' + idx + ')">' +
                    '<img src="' + img.dataUrl + '" alt="Custom NFT">' +
                    '<div class="remove-btn" onclick="event.stopPropagation(); removeCustomImage(\'' + side + '\', ' + idx + ')">×</div>' +
                    '</div>';
            });
            
            // Always add the + button at the end
            html += '<div class="trade-custom-add" onclick="addCustomImage(\'' + side + '\')" title="Add custom NFT image">+</div>';
            
            container.innerHTML = html;
        }
        
        function toggleCustomImage(side, idx) {
            const customImages = side === 'yours' ? tradeOfferData.yourCustomImages : tradeOfferData.theirCustomImages;
            customImages[idx].selected = !customImages[idx].selected;
            
            renderCustomImages(side);
            updateTradeSelectedDisplay(side);
            updateTradePreview();
        }
        
        function removeCustomImage(side, idx) {
            const customImages = side === 'yours' ? tradeOfferData.yourCustomImages : tradeOfferData.theirCustomImages;
            customImages.splice(idx, 1);
            
            renderCustomImages(side);
            updateTradeSelectedDisplay(side);
            updateTradePreview();
        }
        
        function updateTradePreview() {
            // Get ETH values
            tradeOfferData.yourEth = parseFloat(document.getElementById('tradeYourEth').value) || 0;
            tradeOfferData.theirEth = parseFloat(document.getElementById('tradeTheirEth').value) || 0;
            
            // Get selected custom images
            const yourSelectedCustom = tradeOfferData.yourCustomImages.filter(img => img.selected);
            const theirSelectedCustom = tradeOfferData.theirCustomImages.filter(img => img.selected);
            
            // Update your NFTs preview
            const yourNftsPreview = document.getElementById('previewYourNfts');
            if (tradeOfferData.yourNfts.length === 0 && yourSelectedCustom.length === 0) {
                yourNftsPreview.innerHTML = '<span style="color: var(--text-secondary); font-size: 12px;">Select NFTs</span>';
            } else {
                let html = tradeOfferData.yourNfts.map(function(tokenId) {
                    const imgUrl = imageData[tokenId] || imageData[String(tokenId)];
                    return '<div class="trade-preview-nft">' +
                        (imgUrl ? '<img src="' + imgUrl + '" alt="#' + tokenId + '">' : '<div style="width:64px;height:64px;background:var(--bg-card);border-radius:8px;border:2px solid var(--accent-cyan);display:flex;align-items:center;justify-content:center;font-size:11px;">#' + tokenId + '</div>') +
                        '<span>#' + tokenId + '</span>' +
                        '</div>';
                }).join('');
                
                // Add custom images
                yourSelectedCustom.forEach(function(img) {
                    html += '<div class="trade-preview-nft">' +
                        '<img src="' + img.dataUrl + '" alt="Custom" style="border-color: var(--accent-purple);">' +
                        '<span>Custom</span>' +
                        '</div>';
                });
                
                yourNftsPreview.innerHTML = html;
            }
            
            // Update their NFTs preview
            const theirNftsPreview = document.getElementById('previewTheirNfts');
            if (tradeOfferData.theirNfts.length === 0 && theirSelectedCustom.length === 0) {
                theirNftsPreview.innerHTML = '<span style="color: var(--text-secondary); font-size: 12px;">Select NFTs</span>';
            } else {
                let html = tradeOfferData.theirNfts.map(function(tokenId) {
                    const imgUrl = imageData[tokenId] || imageData[String(tokenId)];
                    return '<div class="trade-preview-nft">' +
                        (imgUrl ? '<img src="' + imgUrl + '" alt="#' + tokenId + '">' : '<div style="width:64px;height:64px;background:var(--bg-card);border-radius:8px;border:2px solid var(--accent-gold);display:flex;align-items:center;justify-content:center;font-size:11px;">#' + tokenId + '</div>') +
                        '<span>#' + tokenId + '</span>' +
                        '</div>';
                }).join('');
                
                // Add custom images
                theirSelectedCustom.forEach(function(img) {
                    html += '<div class="trade-preview-nft">' +
                        '<img src="' + img.dataUrl + '" alt="Custom" style="border-color: var(--accent-purple);">' +
                        '<span>Custom</span>' +
                        '</div>';
                });
                
                theirNftsPreview.innerHTML = html;
            }
            
            // Update ETH displays
            const yourEthDisplay = document.getElementById('previewYourEth');
            const theirEthDisplay = document.getElementById('previewTheirEth');
            
            if (tradeOfferData.yourEth > 0) {
                yourEthDisplay.textContent = '+ ' + tradeOfferData.yourEth + ' ETH';
                yourEthDisplay.style.display = 'inline-block';
            } else {
                yourEthDisplay.style.display = 'none';
            }
            
            if (tradeOfferData.theirEth > 0) {
                theirEthDisplay.textContent = '+ ' + tradeOfferData.theirEth + ' ETH';
                theirEthDisplay.style.display = 'inline-block';
            } else {
                theirEthDisplay.style.display = 'none';
            }
            
            // Update trade simulator
            updateTradeSimulator();
        }
        
        // ========================================
        // TRADE SIMULATOR - Badge Impact Analysis
        // ========================================
        
        function calculateBadgesForTokens(tokenIds) {
            // Calculate all badges for a given set of token IDs
            // Returns an object with badge names as keys
            const badges = {};
            
            // 1. Get trait badges from tokenToBadges
            if (window.tokenToBadges) {
                tokenIds.forEach(tokenId => {
                    const tokenBadges = window.tokenToBadges[tokenId] || window.tokenToBadges[String(tokenId)] || [];
                    tokenBadges.forEach(badge => {
                        if (!badges[badge]) {
                            badges[badge] = [];
                        }
                        badges[badge].push(tokenId);
                    });
                });
            } else {
                // Fallback: check each badge's token list
                tokenIds.forEach(tokenId => {
                    Object.entries(badgeData).forEach(([badge, tokens]) => {
                        let tokenList = Array.isArray(tokens) ? tokens : Object.values(tokens);
                        const hasToken = tokenList.some(t => 
                            String(t) === String(tokenId) || parseInt(t) === parseInt(tokenId)
                        );
                        
                        if (hasToken) {
                            if (!badges[badge]) {
                                badges[badge] = [];
                            }
                            badges[badge].push(tokenId);
                        }
                    });
                });
            }
            
            // 2. Calculate combo badges (type-based)
            const types = tokenIds.map(id => typeData[id] || typeData[String(id)]).filter(t => t);
            
            COMBO_BADGES.forEach(combo => {
                if (combo.check(types, tokenIds)) {
                    badges[combo.name] = ['combo'];
                }
            });
            
            // 3. Calculate collection badges (based on total badge count)
            let badgeCount = Object.keys(badges).length;
            COLLECTION_BADGE_THRESHOLDS.forEach(threshold => {
                const badgeName = `collection_${threshold}`;
                if (badgeCount >= threshold) {
                    badges[badgeName] = ['collection'];
                    badgeCount++; // Cascading
                }
            });
            
            return badges;
        }
        
        function updateTradeSimulator() {
            const simulator = document.getElementById('tradeSimulator');
            const gainSection = document.getElementById('tradeSimGain');
            const loseSection = document.getElementById('tradeSimLose');
            const gainBadges = document.getElementById('tradeSimGainBadges');
            const loseBadges = document.getElementById('tradeSimLoseBadges');
            const netDisplay = document.getElementById('tradeSimNet');
            
            console.log('Trade Simulator Update:', {
                yourNfts: tradeOfferData.yourNfts,
                theirNfts: tradeOfferData.theirNfts,
                walletNFTs: walletNFTs.length
            });
            
            // Only show if there are NFTs selected on at least one side
            if (tradeOfferData.yourNfts.length === 0 && tradeOfferData.theirNfts.length === 0) {
                simulator.style.display = 'none';
                return;
            }
            
            simulator.style.display = 'block';
            
            // Calculate current badges
            const currentBadges = calculateBadgesForTokens(walletNFTs);
            const currentBadgeSet = new Set(Object.keys(currentBadges));
            console.log('Current badges:', currentBadgeSet.size);
            
            // Simulate the trade: remove your offered NFTs, add their NFTs
            const simulatedTokens = walletNFTs
                .filter(id => !tradeOfferData.yourNfts.includes(String(id)))
                .concat(tradeOfferData.theirNfts.map(id => String(id)));
            
            console.log('Simulated tokens:', simulatedTokens.length);
            
            // Calculate badges after trade
            const afterBadges = calculateBadgesForTokens(simulatedTokens);
            const afterBadgeSet = new Set(Object.keys(afterBadges));
            console.log('After badges:', afterBadgeSet.size);
            
            // Find gained badges (in after but not in current)
            const gained = [...afterBadgeSet].filter(b => !currentBadgeSet.has(b));
            console.log('Gained:', gained);
            
            // Find lost badges (in current but not in after)
            const lost = [...currentBadgeSet].filter(b => !afterBadgeSet.has(b));
            console.log('Lost:', lost);
            
            // Render gained badges
            if (gained.length > 0) {
                gainSection.style.display = 'block';
                gainBadges.innerHTML = gained.map(badge => {
                    const imgUrl = getBadgeImage(badge);
                    const color = getBadgeColor(badge);
                    const isGradient = color.includes('gradient');
                    const nameStyle = isGradient 
                        ? 'background: ' + color + '; -webkit-background-clip: text; -webkit-text-fill-color: transparent;'
                        : 'color: ' + color + ';';
                    
                    return '<div class="trade-sim-badge gain">' +
                        (imgUrl ? '<img src="' + imgUrl + '" alt="">' : '') +
                        '<span style="' + nameStyle + '">' + formatBadgeName(badge) + '</span>' +
                        '</div>';
                }).join('');
            } else {
                gainSection.style.display = 'block';
                gainBadges.innerHTML = '<span class="trade-sim-empty">No new badges</span>';
            }
            
            // Render lost badges
            if (lost.length > 0) {
                loseSection.style.display = 'block';
                loseBadges.innerHTML = lost.map(badge => {
                    const imgUrl = getBadgeImage(badge);
                    const color = getBadgeColor(badge);
                    const isGradient = color.includes('gradient');
                    const nameStyle = isGradient 
                        ? 'background: ' + color + '; -webkit-background-clip: text; -webkit-text-fill-color: transparent;'
                        : 'color: ' + color + ';';
                    
                    return '<div class="trade-sim-badge lose">' +
                        (imgUrl ? '<img src="' + imgUrl + '" alt="">' : '') +
                        '<span style="' + nameStyle + '">' + formatBadgeName(badge) + '</span>' +
                        '</div>';
                }).join('');
            } else {
                loseSection.style.display = 'block';
                loseBadges.innerHTML = '<span class="trade-sim-empty">No badges lost - you have duplicates! ✓</span>';
            }
            
            // Update net change
            const netChange = gained.length - lost.length;
            if (netChange > 0) {
                netDisplay.textContent = '+' + netChange + ' badges';
                netDisplay.className = 'trade-sim-net positive';
            } else if (netChange < 0) {
                netDisplay.textContent = netChange + ' badges';
                netDisplay.className = 'trade-sim-net negative';
            } else {
                netDisplay.textContent = '±0 badges';
                netDisplay.className = 'trade-sim-net neutral';
            }
        }
        
        function generateTradeOfferCanvas(callback) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Get selected custom images
            const yourSelectedCustom = tradeOfferData.yourCustomImages.filter(img => img.selected);
            const theirSelectedCustom = tradeOfferData.theirCustomImages.filter(img => img.selected);
            
            // Total items per side (GVC NFTs + custom images)
            const yourTotalItems = tradeOfferData.yourNfts.length + yourSelectedCustom.length;
            const theirTotalItems = tradeOfferData.theirNfts.length + theirSelectedCustom.length;
            
            // Calculate NFT size based on count (bigger when fewer)
            const maxNfts = Math.max(yourTotalItems, theirTotalItems, 1);
            let nftSize, nftGap;
            
            if (maxNfts === 1) {
                nftSize = 180;
                nftGap = 0;
            } else if (maxNfts === 2) {
                nftSize = 140;
                nftGap = 16;
            } else if (maxNfts === 3) {
                nftSize = 110;
                nftGap = 12;
            } else {
                nftSize = 85;
                nftGap = 10;
            }
            
            // Canvas sizing
            const sideWidth = Math.max(250, maxNfts * (nftSize + nftGap) + 40);
            canvas.width = sideWidth * 2 + 80;
            canvas.height = Math.max(420, nftSize + 220);
            
            // Draw background gradient
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#0a0a0f');
            gradient.addColorStop(0.5, '#1a1025');
            gradient.addColorStop(1, '#0f1020');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw border
            ctx.strokeStyle = '#2a2a3a';
            ctx.lineWidth = 2;
            ctx.strokeRect(5, 5, canvas.width - 10, canvas.height - 10);
            
            // Draw title
            ctx.font = 'bold 32px Inter, Arial, sans-serif';
            ctx.fillStyle = '#ffffff';
            ctx.textAlign = 'center';
            ctx.fillText('🤝 Trade Offer', canvas.width / 2, 50);
            
            // Draw column headers
            ctx.font = 'bold 18px Inter, Arial, sans-serif';
            ctx.fillStyle = '#00d4ff';
            ctx.fillText('I Give', canvas.width / 4, 85);
            ctx.fillStyle = '#ffd700';
            ctx.fillText('I Get', (canvas.width / 4) * 3, 85);
            
            // Draw middle divider and arrows
            ctx.fillStyle = '#a855f7';
            ctx.font = '40px Arial';
            ctx.fillText('⟷', canvas.width / 2, canvas.height / 2 - 10);
            ctx.font = 'bold 14px Inter, Arial, sans-serif';
            ctx.fillStyle = '#888899';
            ctx.fillText('FOR', canvas.width / 2, canvas.height / 2 + 20);
            
            // Draw footer
            ctx.font = 'bold 14px Inter, Arial, sans-serif';
            ctx.fillStyle = '#00d4ff';
            ctx.fillText('gvcbadges.com', canvas.width / 2, canvas.height - 20);
            
            // Store nftSize for use in drawNft
            const currentNftSize = nftSize;
            const currentNftGap = nftGap;
            
            // Load and draw NFT images
            const imagesToLoad = [];
            
            tradeOfferData.yourNfts.forEach(function(tokenId, i) {
                const imgUrl = imageData[tokenId] || imageData[String(tokenId)];
                if (imgUrl) {
                    imagesToLoad.push({
                        url: imgUrl,
                        tokenId: tokenId,
                        side: 'yours',
                        index: i,
                        isCustom: false
                    });
                }
            });
            
            // Add custom images for yours
            yourSelectedCustom.forEach(function(img, i) {
                imagesToLoad.push({
                    url: img.dataUrl,
                    tokenId: 'Custom',
                    side: 'yours',
                    index: tradeOfferData.yourNfts.length + i,
                    isCustom: true
                });
            });
            
            tradeOfferData.theirNfts.forEach(function(tokenId, i) {
                const imgUrl = imageData[tokenId] || imageData[String(tokenId)];
                if (imgUrl) {
                    imagesToLoad.push({
                        url: imgUrl,
                        tokenId: tokenId,
                        side: 'theirs',
                        index: i,
                        isCustom: false
                    });
                }
            });
            
            // Add custom images for theirs
            theirSelectedCustom.forEach(function(img, i) {
                imagesToLoad.push({
                    url: img.dataUrl,
                    tokenId: 'Custom',
                    side: 'theirs',
                    index: tradeOfferData.theirNfts.length + i,
                    isCustom: true
                });
            });
            
            let loadedCount = 0;
            const totalImages = imagesToLoad.length;
            
            function drawNft(img, tokenId, side, index, isCustom) {
                const startY = 105;
                
                let x, y;
                if (side === 'yours') {
                    const totalWidth = yourTotalItems * currentNftSize + (yourTotalItems - 1) * currentNftGap;
                    const startX = (canvas.width / 4) - (totalWidth / 2);
                    x = startX + index * (currentNftSize + currentNftGap);
                    y = startY;
                } else {
                    const totalWidth = theirTotalItems * currentNftSize + (theirTotalItems - 1) * currentNftGap;
                    const startX = (canvas.width / 4) * 3 - (totalWidth / 2);
                    x = startX + index * (currentNftSize + currentNftGap);
                    y = startY;
                }
                
                // Draw rounded image
                ctx.save();
                ctx.beginPath();
                ctx.roundRect(x, y, currentNftSize, currentNftSize, 12);
                ctx.closePath();
                ctx.clip();
                ctx.drawImage(img, x, y, currentNftSize, currentNftSize);
                ctx.restore();
                
                // Draw border - purple for custom, cyan/gold for GVC
                if (isCustom) {
                    ctx.strokeStyle = '#a855f7';
                } else {
                    ctx.strokeStyle = side === 'yours' ? '#00d4ff' : '#ffd700';
                }
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.roundRect(x, y, currentNftSize, currentNftSize, 12);
                ctx.stroke();
                
                // Draw token ID (or "Custom" for custom images)
                const fontSize = currentNftSize >= 140 ? 16 : (currentNftSize >= 100 ? 14 : 12);
                ctx.font = 'bold ' + fontSize + 'px JetBrains Mono, monospace';
                if (isCustom) {
                    ctx.fillStyle = '#a855f7';
                    ctx.textAlign = 'center';
                    ctx.fillText('Custom', x + currentNftSize / 2, y + currentNftSize + 22);
                } else {
                    ctx.fillStyle = side === 'yours' ? '#00d4ff' : '#ffd700';
                    ctx.textAlign = 'center';
                    ctx.fillText('#' + tokenId, x + currentNftSize / 2, y + currentNftSize + 22);
                }
            }
            
            function finishDrawing() {
                // Draw ETH amounts with Ξ symbol
                const ethY = canvas.height - 70;
                
                if (tradeOfferData.yourEth > 0) {
                    // Draw ETH box
                    const ethText = '+ ' + tradeOfferData.yourEth + ' Ξ ETH';
                    ctx.font = 'bold 20px JetBrains Mono, monospace';
                    const textWidth = ctx.measureText(ethText).width;
                    const boxX = (canvas.width / 4) - (textWidth / 2) - 15;
                    const boxY = ethY - 22;
                    
                    ctx.fillStyle = 'rgba(0, 212, 255, 0.15)';
                    ctx.beginPath();
                    ctx.roundRect(boxX, boxY, textWidth + 30, 36, 8);
                    ctx.fill();
                    ctx.strokeStyle = '#00d4ff';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    
                    ctx.fillStyle = '#00d4ff';
                    ctx.textAlign = 'center';
                    ctx.fillText(ethText, canvas.width / 4, ethY);
                }
                
                if (tradeOfferData.theirEth > 0) {
                    // Draw ETH box
                    const ethText = '+ ' + tradeOfferData.theirEth + ' Ξ ETH';
                    ctx.font = 'bold 20px JetBrains Mono, monospace';
                    const textWidth = ctx.measureText(ethText).width;
                    const boxX = ((canvas.width / 4) * 3) - (textWidth / 2) - 15;
                    const boxY = ethY - 22;
                    
                    ctx.fillStyle = 'rgba(255, 215, 0, 0.15)';
                    ctx.beginPath();
                    ctx.roundRect(boxX, boxY, textWidth + 30, 36, 8);
                    ctx.fill();
                    ctx.strokeStyle = '#ffd700';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    
                    ctx.fillStyle = '#ffd700';
                    ctx.textAlign = 'center';
                    ctx.fillText(ethText, (canvas.width / 4) * 3, ethY);
                }
                
                // Draw placeholder if no NFTs
                ctx.font = '14px Inter, Arial, sans-serif';
                ctx.fillStyle = '#666677';
                if (yourTotalItems === 0) {
                    ctx.fillText('No NFTs selected', canvas.width / 4, 200);
                }
                if (theirTotalItems === 0) {
                    ctx.fillText('No NFTs selected', (canvas.width / 4) * 3, 200);
                }
                
                callback(canvas);
            }
            
            if (totalImages === 0) {
                finishDrawing();
                return;
            }
            
            imagesToLoad.forEach(function(imgData) {
                const img = new Image();
                // Don't set crossOrigin for data URLs (custom images)
                if (!imgData.isCustom) {
                    img.crossOrigin = 'anonymous';
                }
                img.onload = function() {
                    drawNft(img, imgData.tokenId, imgData.side, imgData.index, imgData.isCustom);
                    loadedCount++;
                    if (loadedCount >= totalImages) {
                        finishDrawing();
                    }
                };
                img.onerror = function() {
                    loadedCount++;
                    if (loadedCount >= totalImages) {
                        finishDrawing();
                    }
                };
                img.src = imgData.url;
            });
        }
        
        function copyTradeOfferImage() {
            const btn = document.querySelector('.trade-action-btn.copy-img');
            const originalText = btn.textContent;
            btn.textContent = '⏳ Creating...';
            
            generateTradeOfferCanvas(function(canvas) {
                canvas.toBlob(function(blob) {
                    try {
                        navigator.clipboard.write([
                            new ClipboardItem({ 'image/png': blob })
                        ]).then(function() {
                            btn.textContent = '✓ Copied!';
                            setTimeout(function() {
                                btn.textContent = originalText;
                            }, 2000);
                        }).catch(function(err) {
                            console.error('Failed to copy image:', err);
                            btn.textContent = '❌ Failed';
                            setTimeout(function() {
                                btn.textContent = originalText;
                            }, 2000);
                            alert('Could not copy to clipboard. Try the "Save Image" button instead.');
                        });
                    } catch (err) {
                        btn.textContent = '❌ Not supported';
                        setTimeout(function() {
                            btn.textContent = originalText;
                        }, 2000);
                        alert('Your browser does not support copying images. Try "Save Image" instead.');
                    }
                }, 'image/png');
            });
        }
        
        function downloadTradeOfferImage() {
            const btn = document.querySelector('.trade-action-btn.download');
            const originalText = btn.textContent;
            btn.textContent = '⏳ Creating...';
            
            generateTradeOfferCanvas(function(canvas) {
                const link = document.createElement('a');
                link.download = 'gvc-trade-offer.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                btn.textContent = '✓ Saved!';
                setTimeout(function() {
                    btn.textContent = originalText;
                }, 2000);
            });
        }
        
        // Add Enter key support for compare input
        document.addEventListener('DOMContentLoaded', function() {
            const compareInput = document.getElementById('compareWalletInput');
            if (compareInput) {
                compareInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        runComparison();
                    }
                });
            }
        });
        
        // ========================================
        // DYNAMIC FLOATING NFTs
        // ========================================
        function updateFloatingNFTs(tokenIds) {
            const container = document.getElementById('floatingNftsContainer');
            container.innerHTML = '';
            
            if (tokenIds.length === 0) return;
            
            // Shuffle and take up to 16 NFTs (8 per side)
            const shuffled = tokenIds.slice().sort(function() { return Math.random() - 0.5; });
            const leftNFTs = shuffled.slice(0, Math.min(8, Math.ceil(shuffled.length / 2)));
            const rightNFTs = shuffled.slice(Math.min(8, Math.ceil(shuffled.length / 2)), Math.min(16, shuffled.length));
            
            // Create left side NFTs
            leftNFTs.forEach(function(tokenId, i) {
                const imgUrl = imageData[tokenId] || imageData[String(tokenId)];
                if (imgUrl) {
                    const div = document.createElement('div');
                    div.className = 'floating-nft left-' + i;
                    div.innerHTML = '<img src="' + imgUrl + '" alt="GVC #' + tokenId + '">';
                    container.appendChild(div);
                }
            });
            
            // Create right side NFTs
            rightNFTs.forEach(function(tokenId, i) {
                const imgUrl = imageData[tokenId] || imageData[String(tokenId)];
                if (imgUrl) {
                    const div = document.createElement('div');
                    div.className = 'floating-nft right-' + i;
                    div.innerHTML = '<img src="' + imgUrl + '" alt="GVC #' + tokenId + '">';
                    container.appendChild(div);
                }
            });
        }
    </script>
</body>
</html>
